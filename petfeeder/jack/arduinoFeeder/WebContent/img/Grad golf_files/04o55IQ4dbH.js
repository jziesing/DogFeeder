/*!CK:1190239833!*//*1401161646,178179405*/

if (self.CavalryLogger) { CavalryLogger.start_js(["dfIHW"]); }

__d("ProfileChooser",["AsyncRequest","AsyncResponse","CSS","DOM","Input","ProfileBrowser","arrayContains","copyProperties","createObjectFrom","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){for(var q in l)if(l.hasOwnProperty(q))s[q]=l[q];var r=l===null?null:l.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=l;function s(t,u,v,w){"use strict";this.checkedItems={};this.cache=v||{};this.suggested=w||{};this.activeCache=null;this.index=0;this._bootstrapped=false;this._pendingLists=0;l.call(this,t,u);for(var x in this.cache)this.sortSuggested(x);}s.prototype.subscribeListView=function(){"use strict";this.listView.subscribe('scrollTrigger',function(){if(this.typeahead.getCore().getValue())return;var t=this.index,u=t+this.NUM_PER_PAGE,v=this.cache[this.activeCache].slice(t,u);if(v.length){this.index=u;this.appendToView(v);this.listView.resetScroll();}}.bind(this));this.listView.subscribe('clickedCheckable',function(t,u){var v=i.hasClass(u.item,'selectedCheckable'),w=j.find(u.item,'.checkbox'),x=this.listView.getRoot();if(!v&&i.hasClass(x,'limitReached')){w.checked=false;return;}var y=w.value;this.listView.toggleCheckableItem(u.item,!v);this.setUidValue(y,!v);if(!v){this.appendToCache([y],this.VALUE_SELECTED);}else this.removeFromCache([y],this.VALUE_SELECTED);}.bind(this));};s.prototype.setUidValue=function(t,u){"use strict";this.setItemValue(t,u);this.typeahead.getCore().hiddenInput.value=JSON.stringify(this.checkedItems);this.updateCheckableCount();var v=this.typeahead.getData().getEntry(t);this.inform('clickedCheckable',{uid:t,entry:v,new_value:u});};s.prototype.getDataEntries=function(t,u,v){"use strict";var w=[],x=this.cache[t];for(var y=0;y<x.length&&y<u;y++)if(x[y]!==v)w.push(this.typeahead.getData().getEntry(x[y]));return w;};s.prototype.subscribeSelector=function(){"use strict";this.selector.subscribe('changeListEndpoint',function(t,u){this._currentValue=u.value;u.anchor.removeAttribute('data-listendpoint');this.resetTypeahead(u.showTypeahead,u.value);var v=this.queryListEndpoint.bind(this,u.endpoint,u.value);this._pendingLists++;if(this._bootstrapped){v();}else var w=this.typeahead.getData(),x=w.subscribe('bootstrap',function(y,z){if(z.bootstrapping===false){w.unsubscribe(x);v();}});}.bind(this));this.selector.subscribe('changeValue',function(t,u){this._currentValue=u.value;this.resetTypeahead(u.showTypeahead,u.value);if(u.value==this.VALUE_SELECTED){var v=[];for(var w in this.checkedItems)this.checkedItems[w]&&v.push(w);this.cache[u.value]=this.filterInvalidEntries(v);}this.resetView(u.value);}.bind(this));};s.prototype.subscribeTypeahead=function(){"use strict";var t=this.typeahead.getData();this.typeahead.subscribe('loading',function(u,v){i.conditionClass(this.listView.getRoot(),'queryActive',v.loading);}.bind(this));t.subscribe('preload',function(u,v){if(v.data_length){this.listView.swapList(this.typeahead.getView().element);this.listView.resetScroll();}}.bind(this));t.subscribe('bootstrap',function(u,v){if(v.bootstrapping){this.listView.setLoadingState(true);this.listView.swapList(this.typeahead.getView().element);return;}this._bootstrapped=true;this.listView.setLoadingState(this._pendingLists>0);}.bind(this));t.subscribe('fillCache',function(u,v){for(var w in this.cache)this.cache[w]=this.filterInvalidEntries(this.cache[w]);this.cache[this.VALUE_DEFAULT]=v.alluids;this.sortSuggested(this.VALUE_DEFAULT);this.cache[this.VALUE_DISABLED]=this.filterInvalidEntries(Object.keys(v.disabled));this.cache[this.VALUE_SELECTED]=this.filterInvalidEntries(Object.keys(v.selected));var x=this.VALUE_DEFAULT;if(this.selector){var y=this.selector.getSelectedAnchor();x=this.selector.getSelectedValue();this._currentValue=x;this.typeahead.getView().setIsViewingSelectedItems(x==this.VALUE_SELECTED);if(this.cache[x]){this.resetView(x);}else{var z=y.getAttribute('data-listendpoint');if(z){this._pendingLists++;this.queryListEndpoint(z,x);y.removeAttribute('data-listendpoint');}}}this.checkedItems=v.selected;this.typeahead.getCore().hiddenInput.value=JSON.stringify(this.checkedItems);this.activeCache=x;this.updateCheckableCount();this.inform('bootstrapped');}.bind(this));this.typeahead.subscribe('render',function(u,v){if(!this.typeahead.getCore().getValue()){this.listView.resetScroll();this.index=v.length;}}.bind(this));this.typeahead.subscribe('reset',function(){this.resetView(this.activeCache);}.bind(this));};s.prototype.queryListEndpoint=function(t,u){"use strict";this.listView.setLoadingState(true);var v=this.typeahead.getData();new g(t).setHandler(function(w){var x=w.getPayload();if(x.additional_datasource_entries)v.addEntries(p(x.additional_datasource_entries));this.cache[u]=this.filterInvalidEntries(x.ids);this.suggested[u]=x.suggested;this.sortSuggested(u);}.bind(this)).setErrorHandler(function(w){this.cache[u]=[];this.suggested[u]=[];h.defaultErrorHandler(w);}.bind(this)).setFinallyHandler(function(){this.resetView(this._currentValue);this._pendingLists--;this.listView.setLoadingState(this._pendingLists>0);}.bind(this)).send();};s.prototype.filterInvalidEntries=function(t){"use strict";var u=this.typeahead.getData();return t.filter(function(v){return !!u.getEntry(v);});};s.prototype.resetTypeahead=function(t,u){"use strict";i.conditionShow(this.typeahead.getElement(),t);var v=this.typeahead.getCore();k.reset(v.getElement());t&&v.getElement().focus();v.hiddenInput.value=JSON.stringify(this.checkedItems);if(u==this.VALUE_SELECTED){this.typeahead.getView().setIsViewingSelectedItems(true);}else this.typeahead.getView().setIsViewingSelectedItems(false);};s.prototype.sortSuggested=function(t){"use strict";var u=this.suggested[t];if(!u)return;var v=this.cache[t],w=o(v),x=u.filter(function(y){if(y in w){v.splice(v.indexOf(y),1);return true;}return false;});this.cache[t]=x.concat(v);};s.prototype.resetView=function(t){"use strict";this.activeCache=t||this.activeCache;var u=this.typeahead.getData(),v=this.cache[this.activeCache];u.setSuggestedUids(this.suggested[t]||[]);var w,x;if(t===this.VALUE_SELECTED)v=v.sort(function(y,z){w=u.getEntry(y);x=u.getEntry(z);if(!w||!x)return 0;return w.index-x.index;});u.setPrimaryUids(v);u.respond('',v,true);};s.prototype.appendToView=function(t){"use strict";var u=this.typeahead.getData().buildData(t);this.typeahead.getView().appendResults(u);};s.prototype.appendToCache=function(t,u){"use strict";var v=this.cache[u];for(var w=0;w<t.length;w++){var x=t[w];m(v,x)||v.push(x);}};s.prototype.removeFromCache=function(t,u){"use strict";var v=this.cache[u],w;for(var x=0;x<t.length;x++){w=v.indexOf(t[x]);if(w!==-1)v.splice(w,1);}};s.prototype.getCheckedCount=function(){"use strict";var t=0;for(var u in this.checkedItems)if(this.checkedItems[u])t++;return t;};s.prototype.updateCheckableCount=function(){"use strict";var t=this.listView.getRoot(),u=this.getCheckedCount();i.conditionClass(t,'limitReached',u>=this.getSelectionLimit());this.inform('updateCheckableCount',{listview:t.id,count:u});};s.prototype.setItemValue=function(t,u){"use strict";var v=this.typeahead.getData().getEntry(t);if(v){v.selected=u;this.checkedItems[t]=u?1:0;}};s.prototype.addExclusion=function(t){"use strict";var u=this.typeahead.getData().getExclusions();u.push(t);this.typeahead.getData().setExclusions(u);};s.prototype.removeEntry=function(t){"use strict";this.setUidValue(t,false);this.addExclusion(t);for(var u in this.cache){var v=this.cache[u];this.cache[u]=v.filter(function(w){return (w!=t);});}};n(s.prototype,{VALUE_DEFAULT:'default',VALUE_SELECTED:'selected',VALUE_DISABLED:'disabled',NUM_PER_PAGE:50});e.exports=s;},null);
__d("ProfileChooserSelector",["Button","CSS","DOM","ProfileBrowserSelector","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k){for(var l in j)if(j.hasOwnProperty(l))n[l]=j[l];var m=j===null?null:j.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=j;function n(o,p){"use strict";j.call(this,o,p);this._menu.forEachItem(function(q){if(q.getRoot().getAttribute('data-showmore'))q.hasAction=k.thatReturnsFalse;});this._menu.subscribe('itemclick',function(q,r){this.handleItemClick(r);}.bind(this));}n.prototype.handleItemClick=function(o){"use strict";if(o.item.getRoot().getAttribute('data-showmore')){var p=o.item.getRoot().getAttribute('data-optiongroup');this._menu.forEachItem(function(q){var r=q.getRoot();if(r.getAttribute('data-optiongroup')===p)if(r.getAttribute('data-showmore')){h.hide(r);}else h.show(r);});}};n.prototype.handle=function(o){"use strict";this._handle(o.item,o.value);};n.prototype._handle=function(o,p){"use strict";g.setLabel(this._buttonElem,o.getLabel());this._selectedItem=o;var q=o.getRoot(),r=q.getAttribute('data-listendpoint'),s=q.getAttribute('data-typeahead');if(r){this.inform('changeListEndpoint',{anchor:i.find(q,'a'),endpoint:r,value:p,showTypeahead:s});return;}this.inform('changeValue',{value:p,showTypeahead:s});};n.prototype.setSelectedValue=function(o){"use strict";for(var p=0;p<this._menu._items.length;++p)if(this._menu._items[p]._data.value===o){this._handle(this._menu._items[p],o);break;}};e.exports=n;},null);
__d("ProfileChooserDataSource",["DataSource","arrayContains","createObjectFrom"],function(a,b,c,d,e,f,g,h,i){for(var j in g)if(g.hasOwnProperty(j))l[j]=g[j];var k=g===null?null:g.prototype;l.prototype=Object.create(k);l.prototype.constructor=l;l.__superConstructor__=g;function l(m,n,o){"use strict";g.call(this,m);this.preloadData=m.preloadData||[];this.selectedEntries=n||{};this.disabledEntries=o||{};this.suggestedUids={};this.primaryUids=[];this.exclusionsObj=i(this.getExclusions());}l.prototype.dirty=function(){"use strict";k.dirty.call(this);this._preloaded=false;};l.prototype.bootstrap=function(){"use strict";if(this._bootstrapped)return;this.preload();if(!this.bootstrapEndpoint){this._bootstrapped=true;return;}this.fetch(this.bootstrapEndpoint,this.bootstrapData,{value:'',token:this.token});this._bootstrapped=true;this._bootstrapping=true;this.inform('bootstrap',{bootstrapping:true});};l.prototype.preload=function(){"use strict";if(this._preloaded)return;this.preloadData.length&&this.addEntries(this.preloadData);this.inform('preload',{data_length:this.preloadData.length});this._preloaded=true;};l.prototype.processEntries=function(m,n){"use strict";var o=k.processEntries.call(this,m,n);o=this.removeExclusions(o);o.forEach(function(q){var r=this.getEntry(q);r.selected=q in this.selectedEntries;r.disabled=q in this.disabledEntries;},this);if(!n){var p=this.concatWithoutDuplicates(this.primaryUids,o);this.setPrimaryUids(p);}return o;};l.prototype.setPrimaryUids=function(m){"use strict";this.primaryUids=m;var n=this.getAllEntries();for(var o in n)n[o].primary=false;m.forEach(function(p){this.getEntry(p).primary=true;},this);return this;};l.prototype.buildUids=function(m,n,o){"use strict";if(!m&&this.primaryUids)return this.primaryUids;return k.buildUids.call(this,m,n,o);};l.prototype.buildData=function(m){"use strict";var n=k.buildData.call(this,m),o=this.suggestedUids,p=[];n.forEach(function(q){if(q){p.push(q);q.suggested=(q.uid in o);}});return p;};l.prototype.removeExclusions=function(m){"use strict";return m.filter(function(n){return !(n in this.exclusionsObj);}.bind(this));};l.prototype.concatWithoutDuplicates=function(m,n){"use strict";return m.concat(n.filter(function(o){return !h(m,o);}));};l.prototype.setSuggestedUids=function(m){"use strict";this.suggestedUids=i(m);};l.prototype.fillCache=function(m){"use strict";m=this.removeExclusions(m);k.fillCache.call(this,m);this.inform('fillCache',{alluids:m,selected:this.selectedEntries,disabled:this.disabledEntries});};e.exports=l;},null);
__d("ProfileChooserTypeaheadCore",["TypeaheadCore","copyProperties","emptyFunction"],function(a,b,c,d,e,f,g,h,i){for(var j in g)if(g.hasOwnProperty(j))l[j]=g[j];var k=g===null?null:g.prototype;l.prototype=Object.create(k);l.prototype.constructor=l;l.__superConstructor__=g;function l(){"use strict";if(g!==null)g.apply(this,arguments);}l.prototype.keyup=function(){"use strict";this.checkValue();};h(l.prototype,{keepFocused:false,initToggle:i,initView:i,select:i,unselect:i});e.exports=l;},null);
__d("ProfileChooserTypeaheadView",["CSS","DOM","TypeaheadView","cx","htmlSpecialChars","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l){for(var m in i)if(i.hasOwnProperty(m))o[m]=i[m];var n=i===null?null:i.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=i;function o(){"use strict";if(i!==null)i.apply(this,arguments);}o.prototype.render=function(p,q,r){"use strict";var s=this.results[this.index],t=this.autoSelect?0:-1,u=[],v=[],w=[];q.forEach(function(aa){if(aa.suggested){u.push(aa);}else if(aa.primary){v.push(aa);}else w.push(aa);});this.userIsSearching=!!p;var x;if(!q.length){x=this.buildNullstate(p);}else x=this.buildMarkup(p,u,v,w);this.results=q;g.conditionClass(this.element,'hideSummary',!p);h.setContent(this.element,x);this.items=this.getItems();if(s&&r)for(var y=0,z=q.length;y<z;++y)if(s.uid==q[y].uid){t=y;break;}this.highlight(t,false);this.inform('render',q);};o.prototype.buildNullstate=function(p){"use strict";return h.create('div',{className:'nullstate'},[h.create('span',{className:'nothingFound'},p?l._("No results for \"{value}\"",{value:p}):"No results"),h.create('div',{className:'searching'},[h.create('div',null,"Searching..."),h.create('div',{className:'queryThrobber'})])]);};o.prototype.buildMarkup=function(p,q,r,s){"use strict";var t=[];if(this.userIsSearching){var u=this.getIsViewingSelectedItems()?r.length:(q.length+r.length+s.length),v;if(u===0){v=l._("No results for: {search}",{search:p});}else if(u==1){v=l._("Top result for: {search}",{search:p});}else v=l._("Top {count} results for: {search}",{count:u,search:p});t.push(h.create('div',{className:'ptm pbs phs mhs'},[v]));}var w=[];if(q.length){w.push(this.buildDivider("Suggested"));w.push(this.buildSection(q));}if(r.length){if(q.length||(p&&!this.getIsViewingSelectedItems())){var x=this.userIsSearching?"Top Results":"More results";w.push(this.buildDivider(x));}var y=this.buildSection(r);w.push(y);}if(s.length&&!this.getIsViewingSelectedItems()){var z=r.length?"More results":"Top Results";w.push(this.buildDivider(z),this.buildSection(s));}t.push(h.create('div',{className:'fbProfileBrowserListContainer'},w));return t;};o.prototype.buildSection=function(p){"use strict";if(!p.length)return null;return h.create('div',{className:'listSection clearfix'},this.buildResults(p));};o.prototype.buildDivider=function(p){"use strict";return h.create('div',{className:'suggestedDivider clearfix mts'},h.create('span',{className:'fss fcg fwb phs dividerText'},p));};o.prototype.renderer=function(p,q){"use strict";if(!p)return null;var r=null;if(this._shouldShowPresence())r=this.renderPresence(p);var s=this.renderItem(p,r);g.conditionClass(s,'disabledCheckable',p.disabled);g.conditionClass(s,'selectedCheckable',p.selected);g.conditionClass(s,'presenceIncluded',this._shouldShowPresence());return s;};o.prototype.renderItem=function(p,q){"use strict";var r=h.create('li',{className:'multiColumnCheckable checkableListItem','aria-label':p.text},[this.renderInput(p),h.create('a',{className:'anchor',href:'#',tabIndex:-1},[h.create('div',{className:'clearfix'},[this.renderImageBlock(p),h.create('div',{className:"content _42ef"},[h.create('div',{className:"_6a _6b spacer"}),h.create('div',{className:"_6a _6b"},this.renderTextBlock(p)),q])])])]);return r;};o.prototype.renderInput=function(p){"use strict";var q=h.create('input',{type:'checkbox',className:'checkbox',name:'checkableitems[]',value:k(p.uid),checked:!!p.selected,disabled:!!p.disabled});return q;};o.prototype._shouldShowPresence=function(){"use strict";return !!(this.showpresence&&a.AvailableList&&a.AvailableListConstants);};o.prototype.renderPresence=function(p){"use strict";if(!this._shouldShowPresence())return null;var q=h.create('img',{className:'presenceImg rfloat',src:'/images/spacer.gif'}),r=a.AvailableList.get(p.uid);if(r==a.AvailableListConstants.ACTIVE||r==a.AvailableListConstants.IDLE){g.addClass(q,'active');}else if(r==a.AvailableListConstants.MOBILE)g.addClass(q,'mobile');return q;};o.prototype.renderImageBlock=function(p){"use strict";var q=null;if(p.photo){q=h.create('img',{src:p.photo,className:"photo _8o img lfloat"});}else if(p.photo_css)q=h.create('span',{},[h.create('i',{className:'img photo',style:{cssText:p.photo_css}})]);return q;};o.prototype.renderTextBlock=function(p){"use strict";var q=h.create('div',{className:'fcb fwb text'},[p.text]),r='';if(p.subtitle){r=p.subtitle;}else if(p.category)r=p.category;var s=h.create('div',{className:'fcg text subtitle'},[r]);if(p.text.length>17)g.addClass(q,'long');return [q,s];};o.prototype.highlight=function(p,q){"use strict";if(p>this.items.length-1){p=-1;}else if(p<-1)p=this.items.length-1;if(p>=0&&this.results[p]&&!this.results[p].disabled){this.selected=this.items[p];}else this.selected=null;this.index=p;if(q!==false)this.inform('highlight',{index:p,selected:this.results[p]});};o.prototype.appendResults=function(p){"use strict";var q=h.scry(this.element,'.listSection'),r=q[q.length-1];h.appendContent(r,this.buildResults(p));};e.exports=o;},null);