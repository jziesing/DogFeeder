/*!CK:3849932316!*//*1401578071,178198813*/

if (self.CavalryLogger) { CavalryLogger.start_js(["o3Oem"]); }

__d("NotificationCounter",["Arbiter","DocumentTitle","JSLogger"],function(a,b,c,d,e,f,g,h,i){var j={messages:0,notifications:0,requests:0},k={init:function(l){g.subscribe('update_title',this._handleUpdate.bind(this));g.subscribe('jewel/count-updated',this._handleCountUpdate.bind(this));},getCount:function(){var l=0;for(var m in j){var n=Number(j[m]);if(typeof j[m]=='string'&&isNaN(n))return j[m];if(isNaN(n)||n<0){i.create('jewels').error('bad_count',{jewel:m,count:j[m]});continue;}l+=n;}return l;},updateTitle:function(){var l=this.getCount(),m=h.get();m=l?'('+l+') '+m:m;h.set(m,true);},_handleCountUpdate:function(l,m){j[m.jewel]=m.count;this.updateTitle();},_handleUpdate:function(l,m){this.updateTitle();}};e.exports=k;},null);
__d("NotificationJewelController",["Arbiter","DOM","Event","CommunityNotificationFilter","NotificationConstants","NotificationCounter","NotificationSeenState","NotificationStore","NotificationUpdates","NotificationUserActions","URI","createObjectFrom","curry"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(w){return n.getFilteredIDs(m.getUnseenIDs(),function(x){return n.filterNotification(x,w);});}function u(w,x){g.inform('jewel/count-updated',{jewel:x,count:t(w).length},g.BEHAVIOR_STATE);}function v(w,x,y,z,aa,ba,ca){var da=h.find(ba,'.seeMore');aa.subscribe('tabselected',function(event,ha){var ia=q('/notifications').setSubdomain('www').addQueryData('filter',ha.filter);da.href=ia;x.setFilter(ha.filter);setTimeout(ga,0);var ja=t(ha.filter);if(ja.length)p.markNotificationsAsSeen(ja);});l.init();var ea=i.listen(w.getRoot(),'mouseover',function(){ea.remove();ea=null;x.open();});if(w.isOpen()){x.open();}else var fa=w.subscribe('opened',function(){fa.unsubscribe();fa=null;x.open();});var ga=x.pause.bind(x);w.subscribe('opened',function(){setTimeout(ga,0);var ha=t(aa.getFilter());if(ha.length)p.markNotificationsAsSeen(ha);});w.subscribe('closed',function(){x.unpause();u(z,w.name);});o.subscribe('seen-state-updated',s(u,z,w.name));o.handleUpdate(k.PayloadSourceType.INITIAL_LOAD,{seenState:r(y,false),readState:r(ca,false),isCommunity:z==j.WORK});}e.exports=v;},null);
__d("NotificationTab.react",["CommunityNotificationFilter","React","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j){var k={};k[g.ALL]='All';k[g.SOCIAL]='Social';k[g.WORK]='Work';var l=h.createClass({displayName:'NotificationTab',handleOnClick:function(){this.props.onClick(this.props.filter);},render:function(){var m=(("_5ysi")+(this.props.isActive?' '+"_5ysh":'')),n=null;if(this.props.count>0&&!this.props.isActive){n=j._({"All":"All ({count})","Social":"Social ({count})","Work":"Work ({count})"},[j['enum'](k[this.props.filter],{All:"All",Social:"Social",Work:"Work"}),j.param("count",this.props.count)]);}else n=j._({"All":"All","Social":"Social","Work":"Work"},[j['enum'](k[this.props.filter],{All:"All",Social:"Social",Work:"Work"})]);return (h.DOM.a({className:m,onClick:this.handleOnClick},n));}});e.exports=l;},null);
__d("NotificationTabs.react",["CommunityNotificationFilter","NotificationStore","NotificationTab.react","React"],function(a,b,c,d,e,f,g,h,i,j){var k=j.createClass({displayName:'NotificationTabs',getInitialState:function(){return {activeTab:g.SOCIAL};},handleOnClick:function(l){this.setState({activeTab:l});this.props.onTabSelect(l);},getFilteredCount:function(l){return h.getFilteredIDs(this.props.unseenIDs,function(m){return h.filterNotification(m,l);}).length;},render:function(){return (j.DOM.div(null,i({count:this.getFilteredCount(g.SOCIAL),filter:g.SOCIAL,isActive:this.state.activeTab===g.SOCIAL,onClick:this.handleOnClick}),i({count:this.getFilteredCount(g.WORK),filter:g.WORK,isActive:this.state.activeTab===g.WORK,onClick:this.handleOnClick})));}});e.exports=k;},null);
__d("NotificationJewelHeaderController",["Arbiter","ArbiterMixin","DOM","Event","NotificationTabs.react","NotificationSeenState","NotificationStore","NotificationUserActions","NotificationUpdates","React","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=q(h);for(var s in r)if(r.hasOwnProperty(s))u[s]=r[s];var t=r===null?null:r.prototype;u.prototype=Object.create(t);u.prototype.constructor=u;u.__superConstructor__=r;function u(v,w,x,y){"use strict";this.$NotificationJewelHeaderController0=w;if(x){this.renderTabs(x,w);g.subscribe('jewel/count-updated',function(){this.renderTabs(x,w);}.bind(this));}if(v)j.listen(v,'click',function(){var z=l.getUnreadIDs();z=m.getFilteredIDs(z,function(aa){return m.filterNotification(aa,this.$NotificationJewelHeaderController0);}.bind(this));if(z.length)n.markNotificationsAsRead(z);}.bind(this));o.subscribe('read-state-updated',function(){if(y)i.setContent(y,l.getUnreadCount());});}u.prototype.renderTabs=function(v,w){"use strict";var x=k({defaultTab:w,onTabSelect:this.$NotificationJewelHeaderController1.bind(this),unseenIDs:l.getUnseenIDs()});p.renderComponent(x,v);};u.prototype.getFilter=function(){"use strict";return this.$NotificationJewelHeaderController0;};u.prototype.$NotificationJewelHeaderController1=function(v){"use strict";this.$NotificationJewelHeaderController0=v;this.inform('tabselected',{filter:v});};e.exports=u;},null);
__d("NotificationHiddenState",["NotificationUpdates","copyProperties"],function(a,b,c,d,e,f,g,h){var i={};g.subscribe('update-hidden',function(k,l){if(l.hiddenState){i=h(i,l.hiddenState);g.didUpdateHiddenState(Object.keys(l.hiddenState));}});var j={isHidden:function(k){if(i[k])return i[k];return false;}};e.exports=j;},null);
__d("InlineStoryFlyout",["Arbiter","AsyncRequest","csx","DOM","ScrollableArea","Style","Vector","XNotificationInlineStoryControllerURIBuilder","XNotificationInlineStoryDialogControllerURIBuilder"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=450,q=25,r=160,s=120,t=[],u=null,v={},w={init:function(x){t.push(x);},setDialog:function(x){if(!u){u=x;u.subscribe('hide',w._onDialogHide);t.forEach(function(y){y.subscribe('closed',function(){u.hide();});});}g.inform('inlineStory/dialogLoaded');},reuseDialog:function(x,y){if(!u){var z=g.subscribe('inlineStory/dialogLoaded',function(){u.setInnerContent(x);w.showDialog(y);w.setupCommentArbiter(x);w.updatePosition();g.inform('inlineStory/flyoutLoaded');g.subscribe('inlineStory/ufiLoaded',w.updatePosition);z.unsubscribe();}.bind(this)),aa=new o().setString('flyout_id',y).getURI();new h().setURI(aa).send();g.inform('inlineStory/flyoutLoaded');}else{if(u.getContent()!=x)u.setInnerContent(x);w.showDialog(y);w.setupCommentArbiter(x);g.inform('inlineStory/flyoutLoaded');}},_onDialogHide:function(){var x=u.getContext().id,y=u.getContent();v[x]=y;},requestStory:function(x,y){if(y in v){w.reuseDialog(v[y],y);}else{var z=new n().setString('notif_id',x).setString('flyout_id',y).getURI();new h().setURI(z).send();}},setCommentFocus:function(){var x=j.scry(u.getContentRoot(),"._5vpa textarea");if(x.length>0)x[0].focus();},setupCommentArbiter:function(x){g.subscribe('ufi/comment',function(y,z){var aa=j.scry(x,"._5vp9");if(!aa)return;var ba=j.scry(aa[0],'.uiScrollableAreaWrap')[0];ba=ba&&k.getInstance(ba);ba&&ba.scrollToBottom();});},showDialog:function(x){var y=false;for(var z=0;z<t.length;z++)if(t[z]&&t[z].isOpen()){y=true;break;}if(!y||!u){if(u)u.hide();return;}u.setContext(j.find(document,'#'+x));u.show();},updatePosition:function(){if(!u)return;var x=u.getContentRoot(),y=j.scry(x,"._5vp9")[0],z=j.scry(x,"._53ij")[0];if(!y||!z)return;var aa=m.getViewportDimensions().y,ba=aa-r,ca=Math.min(p,ba),da=ca-q,ea=j.scry(y,'.uiScrollableAreaContent')[0];if(!ea)return;var fa=m.getElementDimensions(ea),ga=Math.min(da,fa.y);l.set(y,'height',ga+'px');var ha=m.getElementPosition(y).y,ia=m.getScrollPosition('document').y,ja=ga+ha-aa-ia+s;if(ja>0)l.set(z,'margin-top',-ja+'px');ja=ia-ha+q;if(ja>0)l.set(z,'margin-top',ja+'px');w.setCommentFocus();}};e.exports=w;},null);
__d("PageLikeButton.react",["AsyncResponse","Image.react","PageFanning","React","XUIButton.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=j.createClass({displayName:'PageLikeButton',propTypes:{pageID:j.PropTypes.number.isRequired,ref:j.PropTypes.string.isRequired},getInitialState:function(){return {liked:false};},_onClick:function(o){o.preventDefault();if(!this.state.liked){this.setState({liked:true});i.setFanStatus(this.refs.likeButton.getDOMNode(),this.props.pageID,true,false,this._onSuccess,this._onFailure,{fan_origin:this.props.ref,fan_source:this.props.ref});}},_onSuccess:function(){this.setState({liked:true});},_onFailure:function(o){this.setState({liked:false});g.defaultErrorHandler(o);},render:function(){var o=this.state.liked?"Liked":"Like",p=h({src:"/images/litestand/glyph/like.png"});return (k({className:"_19nd",disabled:this.state.liked,image:p,label:o,onClick:this._onClick,ref:"likeButton",suppressed:false,size:"medium",use:"default"}));}});e.exports=n;},null);
__d("XNotificationInlineStoryLoggingControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f,g){e.exports=g.create("\/desktop_notifications\/inline_story_logging\/",{screen_wide_enough:{type:"Bool"},is_snowlift:{type:"Bool"},is_vault_set:{type:"Bool"},is_aggregated_story:{type:"Bool"},should_fallback:{type:"Bool"}});},null);
__d("NotificationJewelItem.react",["Arbiter","AsyncRequest","AsyncResponse","BizSiteIdentifier.brands","CloseButton.react","DOM","Event","FlexibleBlock.react","ImageBlock.react","InlineStoryFlyout","Keys","NotificationPhotoThumbnail","NotificationURI","NotificationUserActions","PageLikeButton.react","React","TextWithEntities.react","Timestamp.react","VaultBoxURI","Vector","XNotificationInlineStoryLoggingControllerURIBuilder","XUIButton.react","XUISpinner.react","cx","emptyFunction","invariant","mergeObjects","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){var ia=950,ja={group_activity:true};function ka(na,oa){return v.DOM.span({className:"fwb"},na);}function la(na){return !!(na&&na.id&&!na.is_facebook_app);}var ma=v.createClass({displayName:'NotificationJewelItem',getInitialState:function(){return {showingOptions:false,negativeFeedbackConfirmation:null,canReportAsSpam:false,spamReportConfirmation:null,sendingFeedback:false,mayUndoHide:false,firstReceiptHandled:false,showLoadingIndicator:false,isBizSite:j.isBizSite()};},_onKeyDownItem:function(na){if(m.getKeyCode(na.nativeEvent)==q.RETURN)this._markItemRead();},_markItemRead:function(){t.markNotificationsAsRead([this.props.alert_id]);},_onFeedbackError:function(na){i.defaultErrorHandler(na);this.setState({sendingFeedback:false});},_onHideSuccess:function(na){var oa=na.getPayload();fa(oa.confirmation);this.setState({negativeFeedbackConfirmation:oa.confirmation,canReportAsSpam:oa.canReportAsSpam,sendingFeedback:false});},_onHideAppSuccess:function(na){var oa=na.getPayload(),pa=oa.confirmation,qa=oa.canReportAsSpam;fa(pa);this.setState({negativeFeedbackConfirmation:pa,canReportAsSpam:qa,mayUndoHide:true,sendingFeedback:false,showingOptions:true});},_onSpamReportSuccess:function(na){var oa=na.getPayload().spamReportConfirmation;this.setState({negativeFeedbackConfirmation:null,spamReportConfirmation:oa,sendingFeedback:false});},_onHide:function(){t.markNotificationAsHidden(this.props.alert_id,this._onHideSuccess,this._onFeedbackError);this.setState({sendingFeedback:true,mayUndoHide:true});},_onShow:function(){var na=this.props.negative?this.props.negative.subscription_level:null;t.markNotificationAsVisible(this.props.alert_id,na,function(){this.setState({negativeFeedbackConfirmation:null,sendingFeedback:false,showingOptions:false});}.bind(this),this._onFeedbackError);this.setState({sendingFeedback:true});},_onReportSpam:function(){t.markNotificationAsSpam(this.props.alert_id,this._onSpamReportSuccess,this._onFeedbackError);this.setState({sendingFeedback:true});},_markAppAsHidden:function(){t.markAppAsHidden(this.props.alert_id,this.props.application.id,this._onHideAppSuccess,this._onFeedbackError);this.setState({sendingFeedback:true});},_markAppAsVisible:function(){t.markAppAsVisible(this.props.alert_id,this.props.application.id,function(){this.setState({negativeFeedbackConfirmation:null,sendingFeedback:false,showingOptions:false,mayUndoHide:false});}.bind(this),this._onFeedbackError);this.setState({sendingFeedback:true});},_onFirstReceiptYes:function(){t.markFirstReceiptYes(this.props.alert_id,function(){this.props.onHandleFirstReceipt(this.props.application.id);this.setState({firstReceiptHandled:true});}.bind(this),ea);},_onFirstReceiptNo:function(){t.markFirstReceiptNo(this.props.alert_id,function(){this._markAppAsHidden();this.props.onHandleFirstReceipt(this.props.application.id);this.setState({firstReceiptHandled:true});}.bind(this),this._onFeedbackError);this.setState({sendingFeedback:true});},_renderAttachedItem:function(na){if(na)return (v.DOM.img({src:na.uri,className:"_42td",'aria-hidden':true}));if(this.props.showLikeButton&&(this.props.notif_type==='fbpage_fan_invite'||this.props.notif_type==='fbpage_ci_invite'))return (u({pageID:this.props.contextID,ref:this.props.notif_type+'_jewel'}));return v.DOM.span(null);},_getModifiedTrackingString:function(na){return JSON.stringify(ga(JSON.parse(this.props.tracking),na));},_onClickCloseButton:function(){this.setState({showingOptions:true});},_onCancelNegativeFeedback:function(){this.setState({showingOptions:false});},shouldComponentUpdate:function(na,oa){return (this.props.visible!==na.visible||this.props.isRead!==na.isRead||this.props.timestamp!==na.timestamp||this.state.showingOptions!==oa.showingOptions||this.state.sendingFeedback!==oa.sendingFeedback||this.state.canReportAsSpam!==oa.canReportAsSpam||this.state.spamReportConfirmation!==oa.spamReportConfirmation||this.state.showLoadingIndicator!==oa.showLoadingIndicator);},render:function(){if(!this.props.visible&&!this.state.mayUndoHide)return v.DOM.li({className:"_4_62"});var na=this.props.negative,oa=this.props.negativeTracking,pa=(("_33c")+(!this.props.isRead?' '+"_4af":'')+(this.state.showingOptions?' '+"_4ag":'')+(this.state.sendingFeedback?' '+"_4m8s":''));if(this.state.negativeFeedbackConfirmation){var qa=this.state.negativeFeedbackConfirmation,ra;if(this.state.canReportAsSpam)ra=v.DOM.span(null,v.DOM.span({className:"mhs"},"Â·"),v.DOM.a({href:"#",onClick:this._onReportSpam},"Report app for spam"));var sa=la(this.props.application)?this._markAppAsVisible:this._onShow;return (v.DOM.li({className:pa,'data-gt':this.props.tracking},v.DOM.div({className:"_4ai"},w({interpolator:ka,ranges:qa.ranges,aggregatedranges:qa.aggregated_ranges,text:qa.text}),v.DOM.a({href:"#",onClick:sa,className:"mls"},"Undo"),ra)));}var ta=this.state.spamReportConfirmation;if(ta)return (v.DOM.li({className:pa,'data-gt':this.props.tracking},v.DOM.div({className:"_4ai"},w({interpolator:ka,ranges:ta.ranges,aggregatedranges:ta.aggregated_ranges,text:ta.text}))));if(this.state.showingOptions){var ua=la(this.props.application)?this._markAppAsHidden:this._onHide;return (v.DOM.li({className:pa,'data-gt':this.props.tracking},v.DOM.div({className:"_4ai"},v.DOM.div(null,w({interpolator:ka,ranges:na.confirm_question.ranges,aggregatedranges:na.confirm_question.aggregated_ranges,text:na.confirm_question.text})),v.DOM.div({className:"mts"},ba({'data-gt':this._getModifiedTrackingString(oa.confirm),href:{url:'#'},label:na.turn_off,use:"confirm",onClick:ua,disabled:this.state.sendingFeedback}),ba({'data-gt':this._getModifiedTrackingString(oa.cancel),href:{url:'#'},label:"Keep On",onClick:this._onCancelNegativeFeedback,disabled:this.state.sendingFeedback})))));}var va=null;if(this.props.title)va=w({interpolator:ka,ranges:this.props.title.ranges,aggregatedranges:this.props.title.aggregated_ranges,text:this.props.title.text,renderEmoji:true,renderEmoticons:true});var wa=null,xa=null,ya=null;if(na){var za=this._onClickCloseButton,ab;if(this.props.isFirstReceipt){xa=v.DOM.span({className:"_540_"},"NEW");za=this._onFirstReceiptNo;ya=this._onFirstReceiptYes;ab=this._getModifiedTrackingString(oa.firstReceiptNo);}else ab=this._getModifiedTrackingString(oa.click);var bb=(("_4ah")+(' '+"_55m9"));wa=k({className:bb,'data-gt':ab,size:"medium",tooltip:na.button_tooltip,onClick:za,ref:"closeButton"});}var cb=s.localize(this.props.url),db=r.getThumbnail(this.props.attachments,this.props.attached_story,this.props.feedback_context),eb=db&&s.snowliftable(cb),fb=s.isVaultSetURI(cb),gb=(("_55m9")+(!this.props.isRead?' '+"_5c9q":'')+(this.props.isRead?' '+"_5c9_":'')),hb=v.DOM.a({href:"#",className:gb,role:"button",'aria-label':this.props.isRead?"Read":"Mark as Read",'data-hover':"tooltip",'data-tooltip-alignh':"center",onClick:this.props.isRead?null:this._markItemRead}),ib=(eb||fb)?cb:this.props.ajaxify_url,jb=null,kb=null,lb=fb?y.getSyncedTabURI().toString():cb;if(eb){jb='theater';}else if(fb||ib)jb='dialog';var mb=null,nb=this.props.actors[0];if(nb)mb={backgroundImage:'url('+nb.profile_picture.uri+')'};var ob='notif_flyout_'+this.props.alert_id,pb=null,qb=this.props.substory_count>0,rb=false;this.props.attachments.forEach(function(vb){if(rb)return;rb=vb.style_list.indexOf("notification_target")>=0||vb.style_list.indexOf("question")>=0;if(rb)return;});var sb=false;if(this.props.storyInline){var tb=z.getViewportDimensions().x>ia,ub=ja[this.props.notif_type]&&this.props.excludeGroup;if(tb&&!eb&&!fb&&!qb&&!ub&&!rb)sb=true;kb=this._openItemFlyout(cb,ob,tb,eb,fb,qb,rb);if(tb&&!eb&&!fb&&!rb&&!qb){jb=null;if(this.state.showLoadingIndicator)pb=ca({color:"white",background:"light",className:"_5vp8",size:"large"});}}return (v.DOM.li({className:pa,'data-gt':this.props.tracking,onMouseLeave:ya},v.DOM.div({className:"anchorContainer"},v.DOM.a({id:ob,href:lb,ajaxify:ib,className:"_33e",rel:jb,onClick:kb,onMouseDown:this._markItemRead,onKeyDown:this._onKeyDownItem},o(null,v.DOM.span({style:mb,className:"_33h"},v.DOM.img({src:"/images/notif_flyout_indicator.png",className:(("flyoutNoIndicator")+(sb?' '+"flyoutShowIndicator":''))})),n({flex:n.FLEX.left},v.DOM.div({className:"_4l_v"},va,xa,o({className:(("_33f")+(this.state.isBizSite?' '+"_2g48":''))},v.DOM.img({className:"_10cu",src:this.props.icon.uri}),v.DOM.span(null,x({shorten:this.props.shortenTimestamp,time:this.props.timestamp.time,text:this.props.timestamp.text,verbose:this.props.timestamp.verbose,className:"_33g"})))),this._renderAttachedItem(db))),pb),hb,wa)));},_openItemFlyout:function(na,oa,pa,qa,ra,sa,ta){return function(event){if(event.type==='click'&&(event.button!==0||event.altKey||event.ctrlKey||event.shiftKey||event.metaKey))return true;if(this.state.showLoadingIndicator)return false;var ua=ja[this.props.notif_type]&&this.props.excludeGroup,va=new aa().setBool('screen_wide_enough',pa).setBool('is_snowlift',qa).setBool('is_vault_set',ra).setBool('is_aggregated_story',sa).setBool('should_fallback',ta).getURI();new h().setURI(va).send();if(!pa||qa||ra||sa||ua||ta)return;event.preventDefault();g.subscribeOnce('inlineStory/flyoutLoaded',function(){this.setState({showLoadingIndicator:false});}.bind(this));setTimeout(function(){this.state.showLoadingIndicator&&window.open(l.find(document,'#'+oa).href,'_self');}.bind(this),3000);this.setState({showLoadingIndicator:true});p.requestStory(this.props.id,oa);}.bind(this);}});e.exports=ma;},null);
__d("filterObject",[],function(a,b,c,d,e,f){"use strict";function g(h,i,j){if(!h)return null;var k={};for(var l in h)if(h.hasOwnProperty(l)&&i.call(j,h[l],l))k[l]=h[l];return k;}e.exports=g;},null);
__d("NotificationJewelList.react",["Animation","Event","NotificationConstants","NotificationHiddenState","NotificationJewelItem.react","NotificationSeenState","NotificationStore","NotificationUpdates","React","LegacyScrollableArea.react","Vector","copyProperties","createObjectFrom","cx","debounce","filterObject","getObjectValues","isEmpty","mapObject","merge","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){var ba=o.PropTypes,ca=5,da=160,ea=530,fa=40,ga=332,ha=430,ia=i.PayloadSourceType.LIVE_SEND;function ja(la){return !!(la.application&&la.application.id&&la.negative&&la.negative.show_first_receipt&&!la.application.is_facebook_app);}var ka=o.createClass({displayName:'NotificationJewelList',propTypes:{businessID:ba.string,excludeGroup:ba.bool,filter:ba.number,hasEverBeenOpened:ba.bool,maxHeight:ba.number,negativeTracking:ba.object,paused:ba.bool,staticNotifs:ba.object,storyInline:ba.bool,tracking:ba.string,useWideList:ba.bool},getInitialState:function(){this._currentlyFetching=false;this._pendingNotifs={};this._shouldScroll=false;var la=y(this.props.staticNotifs,function(ma){return ma.seen_state==='SEEN_AND_READ';});return {canFetchMore:!this.props.staticNotifs,notifs:this.props.staticNotifs||{},hiddenState:{},readState:la||{},firstReceiptsHandled:{}};},componentWillMount:function(){this._filter=function(la){return m.filterNotification(la,this.props.filter);}.bind(this);if(this.props.staticNotifs)return;m.setBusinessID(this.props.businessID);this._subscriptions=[n.subscribe('notifications-updated',function(la,ma){if(ma.source==ia&&!x(ma.updates)){this._shouldScroll=true;if(this.props.paused)this._pendingNotifs=z(this._pendingNotifs,ma.updates);return;}this._fetchAndUpdate(m.getCount(this._filter));}.bind(this)),n.subscribe(['hidden-state-updated','read-state-updated'],function(la,ma){if(la=='hidden-state-updated'){var na={};Object.keys(ma.updates).forEach(function(pa){na[pa]=j.isHidden(pa);});this.setState({hiddenState:z(this.state.hiddenState,na)});}else{var oa={};Object.keys(ma.updates).forEach(function(pa){oa[pa]=l.isRead(pa);});this.setState({readState:z(this.state.readState,oa)});}}.bind(this))];},componentWillUnmount:function(){if(this._subscriptions){while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();this._subscriptions=null;}},_fetchAndUpdate:function(la){if(this.props.staticNotifs)return;this._currentlyFetching=true;m.getNotifications(la,this.props.filter,function(ma,na){if(na!==this.props.filter)return;var oa=v(ma,this._filter),pa=x(this._pendingNotifs)?oa:this._getNotifsWithCurrentOrder(oa);this._currentlyFetching=false;this.setState({notifs:pa,canFetchMore:m.canFetchMore(this.props.filter)});}.bind(this));},_getNotifsWithCurrentOrder:function(la){var ma=Object.keys(this.state.notifs),na=Object.keys(la).filter(function(pa){return !this.state.notifs[pa];}.bind(this));ma=ma.concat(na);var oa={};ma.forEach(function(pa){if(this._pendingNotifs[pa]){var qa=this.state.notifs[pa];if(qa)oa[pa]=qa;}else oa[pa]=la[pa];}.bind(this));return oa;},_fetchAndUpdateAll:function(){this._pendingNotifs={};this._fetchAndUpdate(m.getCount(this._filter));},_fetchNextSet:function(){if(!this._currentlyFetching){var la=Object.keys(this.state.notifs).length;this._fetchAndUpdate(la+ca);}},_onScroll:function(){if(this._currentlyFetching||!this.state.canFetchMore)return;if(this._isLoadingIndicatorVisible())this._fetchNextSet();},_isLoadingIndicatorVisible:function(){var la=this.refs.loading;if(!la)return false;var ma=this.refs.scrollable.getDOMNode(),na=q.getElementDimensions(ma).y;if(na===0)return false;var oa=q.getElementPosition(ma).y+na,pa=q.getElementPosition(la.getDOMNode()).y;pa-=fa;return pa<oa;},_calculateHeight:function(){var la=q.getViewportDimensions().y;return Math.min(this.props.maxHeight||ea,la-da);},_onHandleFirstReceipt:function(la){if(!(la in this.state.firstReceiptsHandled)){var ma=z(this.state.firstReceiptsHandled,s([la]));this.setState({firstReceiptsHandled:ma});this._fetchNextSet();}},_renderItems:function(){var la={},ma={};w(this.state.notifs).forEach(function(na){var oa=false,pa=ja(na);if(pa){var qa=na.application.id;oa=(!this.state.firstReceiptsHandled[qa]&&!ma[qa]);if(oa)ma[qa]=oa;}var ra=na.alert_id;la[ra]=k(r({visible:!this.state.hiddenState[ra],isRead:this.state.readState[ra],negativeTracking:this.props.negativeTracking,isFirstReceipt:oa,onHandleFirstReceipt:this._onHandleFirstReceipt,shortenTimestamp:this.props.shortenTimestamp,storyInline:this.props.storyInline,excludeGroup:this.props.excludeGroup},na));}.bind(this));return la;},componentDidMount:function(){var la=this.refs.scrollable.getDOMNode();h.listen(window,'resize',u(function(){if(!x(this.state.notifs))new g(la).to('height',this._calculateHeight()+'px').duration(100).go();}.bind(this)));},componentDidUpdate:function(la){if(!la.hasEverBeenOpened&&this.props.hasEverBeenOpened){var ma=m.getFilteredIDs(l.getUnseenIDs(),this._filter).length;if(ma>ca){this._fetchAndUpdate(ma);}else this._fetchNextSet();return;}if(la.paused&&!this.props.paused){setTimeout(this._fetchAndUpdateAll,0);return;}if(this.props.paused&&!la.paused){if(this._shouldScroll&&this.refs.scrollable)this.refs.scrollable.getArea().scrollToTop(false);this._shouldScroll=false;}if(!this._currentlyFetching&&this._isLoadingIndicatorVisible())setTimeout(this._fetchNextSet,0);if(la.filter!=this.props.filter)setTimeout(this._fetchAndUpdateAll,0);},render:function(){var la=this.state.notifs,ma=null,na=null,oa=this.props.useWideList?ha:ga,pa=null;if(!x(la)){ma=o.DOM.ul({'data-gt':this.props.tracking},this._renderItems());na=this._calculateHeight();}else if(!this.state.canFetchMore)ma=o.DOM.div({className:"_572e"},"No new notifications");if(this.state.canFetchMore)pa=o.DOM.img({ref:"loading",src:"/images/loaders/indicator_blue_small.gif",className:"_33i"});return (o.DOM.div({className:"_50-t"},p({ref:"scrollable",width:oa,height:na,fade:true,persistent:true,onScroll:u(this._onScroll)},ma,pa)));}});e.exports=ka;},null);
__d("NotificationJewelListController",["NotificationJewelList.react","React","copyProperties"],function(a,b,c,d,e,f,g,h,i){function j(k,l){this._root=k;this._config=l;this._filter=this._config.filter;this._hasEverBeenOpened=false;this._paused=false;this._render();}i(j.prototype,{open:function(){this._hasEverBeenOpened=true;this._render();},pause:function(){this._paused=true;this._render();},unpause:function(){this._paused=false;this._render();},setFilter:function(k){this._filter=k;this._render();},_render:function(){var k=g({filter:this._filter,hasEverBeenOpened:this._hasEverBeenOpened,paused:this._paused,initialNotifs:this._config.initialNotifs||{},useWideList:this._config.useWideList,tracking:this._config.tracking,negativeTracking:this._config.negativeTracking,shortenTimestamp:this._config.shortenTimestamp,storyInline:this._config.storyInline,excludeGroup:this._config.excludeGroup,businessID:this._config.businessID,maxHeight:this._config.maxHeight});h.renderComponent(k,this._root);}});e.exports=j;},null);
__d("legacy:cookie",["Cookie"],function(a,b,c,d,e,f,g){a.getCookie=g.get;a.setCookie=g.set;a.clearCookie=g.clear;},3);
__d("HashtagParser",["URLMatcher","getHashtagRegex"],function(a,b,c,d,e,f,g,h){var i=100,j=30,k=/@\[([0-9]+):([0-9]+):((?:[^\\\]]*(?:\\.)*)*)\]/g;function l(da){var ea=y(da),fa=0,ga=0;return n(da).map(function(ha){while(fa<ea.length){var ia=ea[fa],ja=ia.offset-ga;if(ja<ha.offset){ga+=ia.token.length-ia.name.length;fa++;}else break;}return {marker:ha.marker,tag:ha.hashtag,rawOffset:ha.offset+ga,offset:ha.offset};});}function m(da){return o(da,t(da));}function n(da){var ea=aa(da);return o(ea,p(da,ea));}function o(da,ea){return r(da).slice(0,j).filter(function(fa){var ga=v(fa.offset,fa.hashtag.length,ea);return !ga&&fa.hashtag.length<=i;});}function p(da,ea){return u(s(da),t(ea));}var q=h();function r(da){var ea=[];da.replace(q,function(fa,ga,ha,ia,ja){ea.push({marker:ha,hashtag:ia,offset:ja+ga.length});});return ea;}function s(da){return ba(da).map(function(ea){return [ea.offset,ea.name.length];});}function t(da){var ea=[],fa,ga=0;while((fa=g.permissiveMatch(da))){var ha=da.indexOf(fa);ea.push([ga+ha,fa.length]);da=da.substring(ha+fa.length);ga+=ha+fa.length;}return ea;}function u(da,ea){var fa=[],ga=0,ha=0,ia=0;while(ga<da.length&&ha<ea.length)if(da[ga][0]>ea[ha][0]){fa[ia++]=ea[ha++];}else fa[ia++]=da[ga++];return fa.concat(da.slice(ga),ea.slice(ha));}function v(da,ea,fa){if(!fa)return false;var ga=x(fa,da);return w(da,ea,fa,ga)||w(da,ea,fa,ga+1);}function w(da,ea,fa,ga){if(!fa[ga])return false;var ha=fa[ga][0],ia=fa[ga][1];return !((da+ea-1<ha)||(da>ha+ia-1));}function x(da,ea){var fa=0,ga=da.length-1;while(fa<=ga){var ha=Math.floor((fa+ga)/2),ia=da[ha][0];if(ia==ea){return ha;}else if(ia<ea){fa=ha+1;}else ga=ha-1;}return ga;}function y(da){var ea=[];da.replace(k,function(fa,ga,ha,ia,ja){ea.push({token:fa,id:ga,type:ha,name:ia,offset:ja});});return ea;}function z(da){return da?da.replace(/\\([^\\])/g,'$1').replace(/\\\\/g,'\\'):null;}function aa(da){return da.replace(k,function(ea,fa,ga,ha,ia){return z(ha);});}function ba(da){var ea=0,fa=0;return y(da).map(function(ga){var ha=da.indexOf(ga.token,fa);fa=ha+1;ha-=ea;var ia=z(ga.name);ea+=ga.token.length-ia.length;if(ha>=0)return {id:ga.id,name:ia,type:ga.type,offset:ha};});}var ca={};ca.parse=l;ca.parseWithoutMentions=m;e.exports=ca;},null);
__d("FacebarResultStoreUtils",[],function(a,b,c,d,e,f){var g={processEntityResult:function(h,i,j,k){var l={semantic:i.toString(),structure:[{type:'ent:'+h,text:j,uid:i}],type:h,cost:k,cache_id_length:0};l.tuid=JSON.stringify({semantic:l.semantic,structure:l.structure});return l;},getRawTextFromStructured:function(h){var i=h.map(function(j){return j.getText();});return i.join('');}};e.exports=g;},null);
__d("HashtagSearchResultUtils",["FacebarResultStoreUtils","HashtagParser","HashtagSearchResultConfig","URI","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){var l={getHashtagFromQuery:function(m){var n=h.parse(m);if(n&&n.length===1&&n[0].offset===0)return n[0].tag;return false;},makeTypeaheadResult:function(m){var n="Hashtag";return {category:n,path:j('/hashtag/'+m).toString(),photo:i.image_url,rankType:null,replace_results:i.boost_result?true:false,scaled_score:1,score:0,text:'#'+m,type:'hashtag_exact',uid:'hashtag:'+m};},makeFacebarEntry:function(m){var n="Hashtag";return {category:n,path:j('/hashtag/'+m).toString(),photo:i.image_url,replace_results:i.boost_result?true:false,text:'#'+m,type:'hashtag_exact',uid:'hashtag:'+m};},makeFacebarResult:function(m){var n=g.processEntityResult('hashtag_exact','hashtag:'+m,'#'+m,i.hashtag_cost);n.parse={display:[{type:'ent:hashtag_exact',uid:'hashtag:'+m}],remTokens:[],suffix:''};n.tags={hashtag:'hashtag'};return n;}};e.exports=l;},null);
__d("ContextualHelpSearchController",["Event","AsyncRequest","DOM","CSS","Focus","Input","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=400;function o(){this._token=null;this._timerID=0;this._lastQuery=null;this.typing_listener=null;this.clear_listener=null;this.async_request=null;}m(o.prototype,{init:function(p,q,r,s,t,u){this.loader=p;this.search_box=q;this.topics_area=r;this.results_area=s;this.clear_button=t;this.typing_listener=g.listen(this.search_box,'keyup',this.setTimer.bind(this));this.clear_listener=g.listen(this.clear_button,'click',this.clearResults.bind(this));if(u==null||u.focusSearchBox==null||u.focusSearchBox)k.set(this.search_box);},source:'contextual_help',clearResults:function(){this.show(this.topics_area);this._lastQuery='';l.reset(this.search_box);k.set(this.search_box);if(this.async_request!==null){this.async_request.abort();this.async_request=null;}j.addClass(this.clear_button,'hidden_elem');},update:function(){var p=l.getValue(this.search_box);if(p===this._lastQuery)return;this._lastQuery=p;if(p===''){this.clearResults();return;}this.show(this.loader);var q={query:p,width:this._width||n,source:this.source};this.async_request=new h('/help/ajax/search/').setData(q).setHandler(function(r){this._update(r);}.bind(this));this.async_request.send();},_update:function(p){this.async_request=null;var q=p.getPayload().results;i.setContent(this.results_area,q);this.show(this.results_area);if(l.getValue(this.search_box)===''){this.clearResults();}else j.removeClass(this.clear_button,'hidden_elem');},setTimer:function(){if(this._timerID!==0)clearTimeout(this._timerID);this._timerID=setTimeout(this.update.bind(this),300);if(this.async_request!=null){this.async_request.abort();this.async_request=null;}},show:function(p){var q=[this.loader,this.topics_area,this.results_area];for(var r=0;r<q.length;r++)j.addClass(q[r],'hidden_elem');j.removeClass(p,'hidden_elem');}});e.exports=o;},null);
__d("RequestsJewel",["AccessibilityLogger","Arbiter","AsyncRequest","AsyncSignal","ChannelConstants","CSS","DOM","Event","FriendBrowserCheckboxController","LinkController","Parent","ScrollableArea","Vector","copyProperties","ge","shield","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){function x(y,z,aa){if(y)this.init(y,z,aa);}t(x,{instance:null,getInstance:function(){return this.instance;}});t(x.prototype,{init:function(y,z,aa){x.instance=this;this.countNew=0;this.jewel=y;this.jewelFlyoutCase=y.getRoot();this.jewelFlyout=u('fbRequestsFlyout');this.newCountSpan=u('newRequestCount');this.folder=z;this.doNewMarkRead=aa;this.openTimestamp=0;this._requestList={};this._egoData={};this._requestCount=0;this.egoPredictedCount=0;this.pendingCount=0;this.shouldLogEgoClick=false;this.shouldClearPredictionAssocOnClick=false;var ba=u('requestsMarkReadButton');if(ba)n.listen(ba,'click',v(this._markRead,this));this.jewel.subscribe('marked-seen',v(this._markSeenCallback,this));this.jewel.subscribe('closed',v(this._clearNewItems,this));this.jewel.subscribe('updated',this._updateCount.bind(this));this.jewel.subscribe('opened',this._openHandler.bind(this));p.registerHandler(this._handleLink.bind(this));h.subscribe(k.getArbiterType('jewel_requests_add'),this._addRequest.bind(this));h.subscribe(k.getArbiterType('jewel_friending_notifs'),this._addNotif.bind(this));h.subscribe(k.getArbiterType('jewel_requests_remove_old'),this._removeOldRequest.bind(this));h.subscribe(k.getArbiterType('friend_requests_seen'),this._markSeenFromMessage.bind(this));h.subscribe('jewel/ego_predicted_count',function(da,ea){this.egoPredictedCount=ea.ego_predicted_count;this.pendingCount=ea.pending_count;this.egoUnseenTimestamp=ea.unseen_timestamp;this.shouldLogEgoClick=ea.should_log_ego_click;this.actionContext=ea.action_context;}.bind(this));n.listen(this.jewelFlyout,'submit',function(da){var ea=q.byClass(da.getTarget(),'objectListItem');if(ea){l.removeClass(ea,'jewelItemNew');l.addClass(ea,'jewelItemResponded');this.pageInCollapsedRequests();}}.bind(this));var ca=m.find(u('fbRequestsJewel'),'a[rel="toggle"]');n.listen(ca,'focus',function(da){g.logFocusIn();}.bind(this));this.setupScroll();return this;},setupScroll:function(){var y=m.scry(this.jewelFlyout,'.uiScrollableAreaWrap')[0];if(y){this._scrollableWrap=y;this._lastLinkPosition=0;this._scrollListener=n.listen(y,'scroll',this._handleScroll.bind(this),n.Priority._BUBBLE);}},fromDom:function(){m.scry(this.jewelFlyout,'.jewelItemList li.objectListItem').forEach(function(y){var z=y.getAttribute('id');if(z){var aa=u(z+'_status'),ba=this._parseIDToInts(z),ca=aa.getAttribute('data-ego');if(ba.requester){this._requestList[ba.requester]=z;if(ca)this._egoData[ca]=ca;}++this._requestCount;}}.bind(this));this._conditionShowEmptyMessage();},_parseID:function(y){var z=y.match(/^(\d+)_(\d+)/);return (z)?{requester:z[1],type:z[2]}:undefined;},_parseIDToInts:function(y){var z=y?this._parseID(y):undefined,aa;if(z&&z.requester){aa=parseInt(z.requester,10);if(isNaN(aa))aa=undefined;}var ba;if(z&&z.type){ba=parseInt(z.type,10);if(isNaN(ba))ba=undefined;}return {requester:aa,type:ba};},_decrementCountNewIfPositive:function(){if(this.countNew>0)this.countNew-=1;},_handleLink:function(y,event){var z=q.byClass(y,'jewelItemNew');if(z&&q.byClass(z,'fbRequestList')&&q.byClass(z,'beeperEnabled')){var aa=this._parseID(z.id);aa&&this._markSeenCallback(aa.requester,aa.type);this._decrementCountNewIfPositive();h.inform('jewel/count-updated',{jewel:'requests',count:this.countNew});l.removeClass(z,'jewelItemNew');}return true;},_handleScroll:function(){var y=m.scry(this._scrollableWrap,'.uiMorePager');if(!y||(u('fbRequestsJewelManualPager')&&y.length<2))return;var z=y.pop();if(z){var aa=s.getElementPosition(z,'viewport').y;if(aa>0)l.addClass(q.byClass(this._scrollableWrap,'uiScrollableArea'),'contentAfter');var ba=m.find(z,'a');if(!ba)return;var ca=s.getElementPosition(ba,'viewport').y;if(ca==this._lastLinkPosition)return;var da=s.getElementPosition(this._scrollableWrap,'viewport').y+s.getElementDimensions(this._scrollableWrap).y;if(ca-300<da&&ca>0){this._lastLinkPosition=ca;var ea=ba.getAttribute('ajaxify');if(ea){new i(ea).setRelativeTo(ba).setStatusElement(q.byClass(ba,'stat_elem')).send();}else o.getInstance('jewel').showMore();}}},_addNotif:function(y,z){if(!z||this.jewel.isOpen())return;if(z.obj.notif_type!=='friend_confirmed')return;if(u('fbRequestsJewelLoading')){new i().setURI('/ajax/requests/loader/').send();return;}var aa={};aa.reloadcontent=true;new i().setURI('/ajax/requests/loader/').setData(aa).send();},_addRequest:function(y,z){if(!z)return;var aa=z.obj.from,ba=z.obj.suggester,ca=this._parseIDToInts(this._requestList[aa]).type,da=ca===19&&!ba;if(!da&&(ca||this.jewel.isOpen()))return;if(u('fbRequestsJewelLoading')){new i().setURI('/ajax/requests/loader/').send();}else{var ea={};ea.reloadcontent=true;new i().setURI('/ajax/requests/loader/').setData(ea).send();}},_removeOldRequest:function(y,z){if(!z||this.jewel.isOpen()||u('fbRequestsJewelLoading')!==null)return;var aa=this._requestList[z.obj.from],ba=aa&&u(aa);if(ba){if(l.hasClass(ba,'jewelItemNew')){this._decrementCountNewIfPositive();h.inform('jewel/count-updated',{jewel:'requests',count:this.countNew});}if(!l.hasClass(ba,'jewelItemResponded')){m.remove(ba);delete this._requestList[z.obj.from];--this._requestCount;this._conditionShowEmptyMessage();}}},pageInCollapsedRequests:function(){var y=u('fbRequestsJewelManualPager');if(y){var z=m.scry(y,'.uiMorePagerPrimary')[0];if(z.style&&z.style.display!='none')setTimeout(function(){z.click();},100);}},_markRead:function(){this.jewel.markSeen();this._clearNewItems();},_markSeenCallback:function(y,z){h.inform('friend-confirmed-notifs-seen');var aa=m.scry(this.jewelFlyout,'li');new j('/ajax/gigaboxx/endpoint/UpdateLastSeenTime.php',{folder:this.folder,first_item:aa[0].id}).send();new i().setURI('/ajax/friends/jewel/predicted_count_logging').setData({ego_predicted_count:this.egoPredictedCount,pending_count:this.pendingCount,unseen_timestamp:this.egoUnseenTimestamp,action_context:this.actionContext,should_log_ego_click:this.shouldLogEgoClick}).send();var ba=typeof y!='undefined'&&typeof z!='undefined'?{requester:y,type:z}:{};this.doNewMarkRead&&new j('/ajax/requests/mark_read/',ba).send();},_markSeenFromMessage:function(y,z){h.inform('jewel/count-updated',{jewel:'requests',count:0});},_clearNewItems:function(y,z){m.scry(this.jewel.root,'li.jewelItemNew').forEach(function(aa){l.removeClass(aa,'jewelItemNew');});},_updateCount:function(y,z){this.countNew=z.count;l.conditionClass(this.jewelFlyout,'beeperUnread',this.countNew>0);l.conditionClass(this.jewelFlyoutCase,'showRequests',this.countNew>0);if(this.newCountSpan){var aa=this.countNew==1?w._("{num} NEW REQUEST",{num:this.countNew}):w._("{num} NEW REQUESTS",{num:this.countNew});m.setContent(this.newCountSpan,aa);}},_conditionShowEmptyMessage:function(){m.scry(this.jewelFlyout,'li.empty').forEach(function(y){l.conditionShow(y,this._requestCount<=0);}.bind(this));},_openHandler:function(){var y=m.scry(this.jewelFlyout,'.uiScrollableArea')[0];if(u('fbRequestsJewelLoading')){var z=Date.now();if(this.openTimestamp+5000<z){this.openTimestamp=z;new i().setURI('/ajax/requests/loader/').setData({log_impressions:true}).send();}}else{var aa=Object.keys(this._requestList);if(aa.length>0){new i().setURI('/friends/requests/log_impressions').setData({ids:aa.join(','),ref:'jewel'}).send();var ba=Object.keys(this._egoData);if(ba.length>0)new i().setURI('/growth/jewel/impression_logging.php').setData({egodata:ba}).send();}}y&&r.poke(y);}});e.exports=x;},null);
__d("legacy:RequestsJewel",["RequestsJewel"],function(a,b,c,d){a.RequestsJewel=b('RequestsJewel');},3);
__d("JewelX",["Event","Arbiter","ArbiterMixin","CSS","DOM","HTML","Keys","TabIsolation","Toggler","copyProperties","emptyFunction","reportData","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=function(u,v){u&&v&&this.init(u,v);};p(t,{_instancesByName:{},_resizeListener:null});p(t.prototype,i,{init:function(u,v){this.name=v.name;this.root=u;this.badge=v.badge;this.countNew=0;this.initialCount=0;this.escHandler=null;this.togglerInstance=o.createInstance(u).setSticky(false);if(v.keepOpenForSnowlift)this.togglerInstance.setPrePageTransitionCallback(this._onPrePageTransition.bind(this));t._instancesByName[this.name]=this;var w=k.find(u,'.fbJewelFlyout'),x=new n(w);o.createInstance(w).setSticky(false);o.listen('show',this.root,function(y){this._logFirstClick();this.hasNew()&&this.markSeen();this.reset();this.inform('opened');h.inform('layer_shown',{type:'Jewel'});x.enable();this.setupEvents();}.bind(this));o.listen('hide',this.root,function(y,z){this.hasNew()&&this.markSeen();this.reset();this.inform('closed');h.inform('layer_hidden',{type:'Jewel'});x.disable();this.removeEvents();}.bind(this));h.subscribe('jewel/count-updated',function(y,z){z.jewel==this.name&&this.update(z);}.bind(this));h.subscribe('jewel/count-initial',function(y,z){z.jewel==this.name&&this.setInitial(z);}.bind(this));h.subscribe('jewel/reset',function(y,z){z.jewel==this.name&&this.reset();}.bind(this));t._resizeListener=t._resizeListener||(function(){var y=null;return g.listen(window,'resize',function(){clearTimeout(y);y=s(h.inform.bind(h,'jewel/resize'),100);});})();},getRoot:function(){return this.root;},hasNew:function(){return j.hasClass(this.root,'hasNew');},isOpen:function(){return j.hasClass(this.root,'openToggler');},reset:function(){j.removeClass(this.root,'hasNew');},setContent:function(u){var v=k.find(this.root,'ul.jewelItemList');k.setContent(v,l(u));},update:function(u){this.countNew=u.count;if(typeof this.countNew==='number'&&this.countNew<0)this.countNew=0;this.badge.setLegacyContent(this.countNew);var v=isNaN(this.countNew)||this.countNew>0;j.conditionClass(this.root,'hasNew',v);this.inform('updated',u);},setInitial:function(u){this.initialCount=u;},setupEvents:function(){this.escHandler=g.listen(document.documentElement,'keydown',function(u){if(u.keyCode===m.ESC&&this.isOpen())o.hide(this.root);}.bind(this));},removeEvents:function(){if(this.escHandler)this.escHandler.remove();},markSeen:function(){h.inform('jewel/count-updated',{jewel:this.name,count:0},h.BEHAVIOR_STATE);this.inform('marked-seen');},_onPrePageTransition:function(u,v){if(!this._isSnowliftURI(v.from)&&!this._isSnowliftURI(v.to))this.togglerInstance&&this.togglerInstance.hide();},_isSnowliftURI:function(u){return u&&u.getQueryData().hasOwnProperty('theater');},_logFirstClick:function(){this._logFirstClick=q;r('jewel_click',{gt:{count:this.countNew,initial:this.initialCount,jewel:this.name}});}});e.exports=t;},null);
__d("LitestandNewsfeedCountUpdater",["Arbiter","AsyncRequest","LitestandMessages","LitestandSidebarBookmarkConfig","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k){var l,m;function n(){m&&clearTimeout(m);if(l)return;m=setTimeout(o,j.nf_count_query_interval_ms);}function o(){if(l)return;new h().setURI('/ajax/litestand/newsfeed_count').setHandler(function(r){if(l)return;p(r.getPayload());n();}).setAllowCrossPageTransition(true).send();}function p(r){g.inform(i.UPDATE_HOME_COUNT,{count:r,onHome:l},g.BEHAVIOR_STATE);}var q={init:function(){q.init=k;g.subscribe(i.NEWSFEED_LOAD,function(){l=true;p(0);});g.subscribe(i.LEAVE_HOME,function(){l=false;n();});n();}};e.exports=q;},null);
__d("LitestandChromeHomeCount",["Arbiter","CSS","DOM","Event","LitestandMessages","LitestandNewsfeedCountUpdater","Parent","UserAgent","$","csx","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=20,s,t,u,v,w,x={init:function(y){w=y;t=i.find(o('pageHead'),"._5ahz");s=t.parentNode;u=m.byClass(s,'navLink');v=false;g.subscribe(k.UPDATE_HOME_COUNT,function(z,aa){x.updateBadge(aa.onHome?0:aa.count);});j.listen(u,'click',function(event){var z=event.getModifiers();if(z.shift||(n.osx()&&z.meta)||(n.windows()&&z.control))x.updateBadge(0);});l.init();x.updateBadge(w);},updateBadge:function(y){w=y;var z=y>0;x.toggleBadge(z);if(z){var aa=y>r?r+'+':y;i.setContent(t,aa);}},toggleBadge:function(y){if(v===y)return;v=y;h.conditionClass(s,"_5ahy",!y);}};e.exports=x;},null);
__d("MercuryJewelCountControl",["Arbiter","DOM","copyProperties","shield","MercuryServerRequests","MercuryThreadInformer","MercuryUnseenState"],function(a,b,c,d,e,f,g,h,i,j){var k=b('MercuryServerRequests').get(),l=b('MercuryThreadInformer').get(),m=b('MercuryUnseenState').get(),n,o,p,q=function(s){if(s||p.isOpen())m.markAsSeen();},r=function(s,t){n=s;o=h.find(n,'#mercurymessagesCountValue');p=t;this.render();k.subscribe('model-update-completed',function(u,v){q(false);});l.subscribe('unseen-updated',this.render.bind(this));p.subscribe('marked-seen',j(q,this,true));};i(r.prototype,{render:function(){g.inform('jewel/count-updated',{jewel:'mercurymessages',count:m.getUnseenCount()},g.BEHAVIOR_STATE);}});e.exports=r;},null);
__d("MercuryJewelThreadlistControl",["ArbiterMixin","ChatOpenTab","CurrentUser","MercuryConfig","CSS","DOM","Event","HighlanderFinchGating","JSLogger","JSXDOM","MercuryAPIArgsSource","MercuryIDs","MercuryThreadlistConstants","MessagingTag","MessageThreadViewSource","Parent","MercuryPresence","MercuryJewelTemplates","Tooltip","URI","copyProperties","csx","cx","throttle","tx","MercuryServerRequests","MercuryOrderedThreadlist","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads","MercuryUnreadState"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea){var fa=b('MercuryServerRequests').get(),ga=b('MercuryOrderedThreadlist').get(),ha=b('MercuryThreadInformer').get(),ia=b('MercuryThreadMetadataRenderer').get(),ja=b('MercuryThreads').get(),ka=b('MercuryUnreadState').get(),la=o.create('mercury_jewel');function ma(ua,va){this._contentArea=l.scry(ua,'.scrollable')[0]||ua;this._contentElement=l.find(this._contentArea,'.jewelContent');this._loadingElement=l.find(this._contentArea,'.jewelLoading');this._loadMoreButton=l.find(this._contentArea,"._8y5");this._loadMoreLink=l.find(this._contentArea,"a._8y6");this._currentFolder=t.INBOX;this._jewelFolderLinks=[];this._jewelFolderLinks[t.INBOX]=l.find(va,"._1sde");this._jewelFolderLinks[t.OTHER]=l.find(va,"._1sdf");this._jewelFolderCounts=[];this._jewelFolderCounts[t.INBOX]=l.find(va,"._1sdg");this._jewelFolderCounts[t.OTHER]=l.find(va,"._1sdh");ra.bind(this)();m.listen(this._jewelFolderLinks[t.INBOX],'click',qa.bind(this,t.INBOX));m.listen(this._jewelFolderLinks[t.OTHER],'click',qa.bind(this,t.OTHER));this._curCount=[];this._curCount[t.INBOX]=s.JEWEL_THREAD_COUNT+1;this._curCount[t.OTHER]=s.JEWEL_THREAD_COUNT+1;this._isFolderLoaded=[];this._isFolderLoaded[t.INBOX]=false;this._isFolderLoaded[t.OTHER]=false;this._folderIsLoading=[];this._folderIsLoading[t.INBOX]=false;this._folderIsLoading[t.OTHER]=false;ha.subscribe('threadlist-updated',this.render.bind(this));ha.subscribe('unread-updated',ra.bind(this));this.render();la.bump('opened_threadlist_'+this._currentFolder);m.listen(this._contentArea,'scroll',da(na,50,this));m.listen(this._loadMoreLink,'click',this.renderMoreThreads.bind(this));}aa(ma,{EVENT_THREADS_LOADED:'threads-loaded',EVENT_THREADS_RENDERED:'threads-rendered'});aa(ma.prototype,g);aa(ma.prototype,{render:function(){l.empty(this._contentElement);k.show(this._loadingElement);k.hide(this._loadMoreButton);var ua=l.create('div');l.appendContent(this._contentElement,ua);ga.getThreadlist(s.RECENT_THREAD_OFFSET,this._curCount[this._currentFolder],this._currentFolder,this.renderThreads.bind(this,ua),true);},renderThreads:function(ua,va){this.inform(ma.EVENT_THREADS_LOADED);if(va.length){va.forEach(function(wa){var xa=x[':fb:mercury:jewel:threadlist-row'].build();ja.getThreadMeta(wa,function(ya){ia.renderCoreThreadlist(ya,xa,this.renderSingleThread.bind(this),{show_unread_count:true});}.bind(this));l.appendContent(ua,xa.getRoot());}.bind(this));}else l.setContent(this._contentElement,this.renderEmptyThreadlist());k.hide(this._loadingElement);k.conditionShow(this._loadMoreButton,!this._isFolderLoaded[this._currentFolder]);this.inform(ma.EVENT_THREADS_RENDERED);},renderSingleThread:function(ua,va){var wa=va.unread_count>0;if(wa)k.addClass(ua.getRoot(),'jewelItemNew');var xa=p.div({className:"x_div"}),ya=p.div({className:"_5c9q"}),za="Mark as Unread";if(wa)za="Mark as Read";y.set(ya,za,'above','right');m.listen(ya,'click',function(event){ja.changeThreadReadStatus(va.thread_id,va.unread_count>0);return false;});xa.appendChild(ya);ua.getNode('link').appendChild(xa);if(h.canOpenTab()){var ab=ua.getNode('presenceIndicator'),bb=va.is_canonical&&va.canonical_fbid?va.canonical_fbid:va.thread_id;ta(bb,ab);}if(n.HIGHLANDER_FINCH_GATING){fa.getServerThreadID(va.thread_id,function(cb){var db=z('/ajax/pages/messages/load_message_thread.php').setQueryData({pageid:i.getID(),threadid:va.thread_id,threadElementID:cb,folder:this._currentFolder,source:u.REFRESH_HIGHLANDER_JEWEL}),eb=ua.getNode('link');eb.setAttribute('rel','dialog');eb.setAttribute('ajaxify',db.toString());}.bind(this));}else ia.renderWebMessengerLink(va.thread_id,ua.getNode('link'),null,this._currentFolder);if(j.MessagesJewelOpenInChat)m.listen(ua.getRoot(),'click',function(cb){var db=h.canOpenTab()&&!cb.isDefaultRequested();if(db&&cb.prevent())h.openThread(va.thread_id,'jewel');});m.listen(ua.getRoot(),'mouseover',function(event){var cb=ua.getRoot();if(!v.byClass(cb,'notifNegativeBase'))k.addClass(cb,'selected');});m.listen(ua.getRoot(),'mouseout',function(event){k.removeClass(ua.getRoot(),'selected');});},renderMoreThreads:function(){k.addClass(this._loadMoreButton,'async_saving');this._folderIsLoading[this._currentFolder]=true;var ua=this._curCount[this._currentFolder]+s.JEWEL_MORE_COUNT;ga.getThreadlist(s.RECENT_THREAD_OFFSET,ua+1,this._currentFolder,pa.bind(this,ua,this._currentFolder),true,q.JEWEL);},renderEmptyThreadlist:function(){return l.create('li',{className:'empty'},"No messages");}});function na(){if(!this._isFolderLoaded[this._currentFolder]&&!this._folderIsLoading[this._currentFolder]&&oa.bind(this)())this.renderMoreThreads();}function oa(){return this._contentArea.scrollTop+this._contentArea.clientHeight>=this._contentArea.scrollHeight-1;}function pa(ua,va,wa){this._curCount[va]=ua;if(!this._isFolderLoaded[va]&&wa.length<this._curCount[va]+1)this._isFolderLoaded[va]=true;this._folderIsLoading[va]=false;k.removeClass(this._loadMoreButton,'async_saving');this.render();}function qa(ua){if(this._currentFolder!=ua){la.bump('opened_threadlist_'+ua);k.addClass(this._jewelFolderLinks[ua],"_1sdd");k.removeClass(this._jewelFolderLinks[this._currentFolder],"_1sdd");this._currentFolder=ua;this.render();}}function ra(){sa.bind(this)(t.INBOX);sa.bind(this)(t.OTHER);}function sa(ua){var va;if(ka.exceedsMaxCount(ua)){va=s.MAX_UNREAD_COUNT;}else va=ka.getUnreadCount(ua);var wa=this._jewelFolderCounts[ua];if(va>0){if(va==s.MAX_UNREAD_COUNT)va+='+';l.setContent(wa,ea._("({unread_count})",{unread_count:va}));}else l.setContent(wa,'');}function ta(ua,va){var wa=r.isValid(ua)&&r.isMultichat(ua);if(wa){k.addClass(va,'groupThread');}else w.updateOnPresenceChanges(ua,va);}e.exports=ma;},null);
__d("MercuryJewel",["MercuryJewelCountControl","DOM","MercuryJewelThreadlistControl","userAction","MercuryChannelHandler","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j){b('MercuryChannelHandler');var k=b('MercuryServerRequests').get(),l=false;function m(q,r,s,t){k.handleUpdate(t);var u=new g(r,s),v=h.find(q,'#MercuryJewelThreadList');if(s.getRoot()&&s.isOpen()){n.call(this,v,q);}else s.subscribe('opened',n.bind(this,v,q));}e.exports=m;function n(q,r){this._ua=j('messages').uai('click','jewel');this._listenForLoad=this._listenForRender=true;if(!l){var s=new i(q,r);s.subscribe(i.EVENT_THREADS_LOADED,o.bind(this));s.subscribe(i.EVENT_THREADS_RENDERED,p.bind(this));l=true;}}function o(){if(this._listenForLoad){this._ua.add_event('loaded');this._listenForLoad=false;}}function p(){if(this._listenForRender){this._ua.add_event('rendered');this._listenForRender=false;}}},null);
__d("AccessibilityShortcut",["AccessibilityLogger","Event","Focus","ge","onEnclosingPageletDestroy","warning"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m={init:function(n,o){var p=h.listen(n,'click',function(q){q.preventDefault();var r=j(o);if(r){i.set(r);g.logSRKey();}else l(r,'Failed to set focus on element with ID: %s',o);});k(n,function(){return p.remove();});}};e.exports=m;},null);
__d("AccessibleMenu",["Event","CSS","DOM","Keys","TabbableElements","Toggler"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m,n,o;function p(){var x=i.scry(m,'a[rel="toggle"]')[0];x&&x.focus();l.getInstance(m).hide();}function q(x){if(!x)return false;h.removeClass(x,'selected');x.setAttribute('aria-selected','false');}function r(x){if(!x)return false;h.addClass(x,'selected');x.setAttribute('aria-selected','true');var y=k.find(x);if(y[0])y[0].focus();}function s(x){var y=i.scry(m,'.selected')[0],z=n.indexOf(y)+x,aa=n[z];if(!aa)return false;q(y);r(aa);}function t(x){if(!l.isShown()||l.getActive()!==m||h.hasClass(m,w.MENU_HIDDEN))return true;var y=g.getKeyCode(x);switch(y){case j.TAB:s(x.shiftKey?-1:1);g.prevent(x);break;case j.ESC:p();g.prevent(x);break;case j.UP:case j.DOWN:s(y===j.UP?-1:1);g.prevent(x);break;}}function u(x,y){m=y.getActive();n=i.scry(m,'[role="menuitem"]');if(!o)o=g.listen(document.documentElement,'keydown',t);}function v(){if(l.getActive()==m)q(i.scry(m,'.selected')[0]);}var w={init:function(x){l.listen('show',x,u);l.listen('hide',x,v);},MENU_HIDDEN:'menu_hidden'};e.exports=w;},null);
__d("isEmail",[],function(a,b,c,d,e,f){var g=/^[\w!#\$%&'\*\+\/\=\?\^`\{\|\}~\-]+(:?\.[\w!#\$%&`\*\+\/\=\?\^`\{\|\}~\-]+)*@(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?$/i;function h(i){return g.test(i);}e.exports=h;},null);
__d("NotificationJewelReminder",["Arbiter","ContextualDialog","ContextualDialogXUITheme","DOM","Event","ImageBlock.react","LayerFadeOnHide","LayerFadeOnShow","NotificationConstants","NotificationStore","NotificationUpdates","React","SubscriptionsHandler","Toggler","$","cx","fbt","intlList"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){var y=2;z.init=function(aa){"use strict";new z(aa);};function z(aa){"use strict";this.$NotificationJewelReminder0=aa;this.$NotificationJewelReminder1=aa.filter;this.$NotificationJewelReminder2=function(ba){return p.filterNotification(ba,this.$NotificationJewelReminder1);}.bind(this);if(p.getCount(this.$NotificationJewelReminder2)){this.$NotificationJewelReminder3();return;}q.subscribeOnce('update-notifications',function(ba,ca){if(ca.payloadsource===o.PayloadSourceType.INITIAL_LOAD)this.$NotificationJewelReminder3();}.bind(this));}z.prototype.$NotificationJewelReminder3=function(){"use strict";p.getNotifications(p.getCount(this.$NotificationJewelReminder2),this.$NotificationJewelReminder1,this.$NotificationJewelReminder5.bind(this));};z.prototype.$NotificationJewelReminder5=function(aa){"use strict";var ba=t.getInstance(u('fbNotificationsJewel'));if(ba&&ba.isShown())return;var ca=[],da,ea=Object.keys(aa);for(var fa=0;fa<ea.length;fa++){var ga=aa[ea[fa]].actors;if(ga.length===0)continue;for(var ha=0;ha<ga.length;ha++){da=da||ga[ha].profile_picture.uri;if(ca.length<y&&ga[ha].name&&ca.indexOf(ga[ha].name)===-1)ca.push(ga[ha].name);}if(ca.length===y)break;}if(ca.length===0||!da)return;var ia=r.DOM.div({className:"_5bov"},l(null,r.DOM.img({className:"_5bow",src:da}),r.DOM.div(null,this.$NotificationJewelReminder6(ea.length,ca)))),ja=j.create('div');r.renderComponent(ia,ja);var ka=new h({alignment:'right',contextSelector:'#fbNotificationsJewel',offsetY:-10,position:'below',theme:i,width:210},ja);ka.enableBehaviors([n,m]);this.$NotificationJewelReminder7(ka);};z.prototype.$NotificationJewelReminder6=function(aa,ba){"use strict";ba=ba.map(function(ca){return r.DOM.b(null,ca);});return (w._({"notifications":"{number} notifications from {notification senders}","notification":"{number} notification from {notification senders}"},[w.param("number",aa),w['enum'](aa>1?'notifications':'notification',{notifications:"notifications",notification:"notification"}),w.param("notification senders",x(ba))]));};z.prototype.$NotificationJewelReminder7=function(aa){"use strict";aa.show();this.$NotificationJewelReminder8=aa;var ba=aa.getRoot();this.$NotificationJewelReminder9=setTimeout(this.$NotificationJewelRemindera.bind(this),this.$NotificationJewelReminder0.show_time);this.$NotificationJewelReminderb=new s();this.$NotificationJewelReminderb.addSubscriptions(g.subscribe('layer_shown',function(ca,da){if(da&&da.type==='Jewel')this.$NotificationJewelRemindera();}.bind(this)),k.listen(ba,'mouseenter',function(){clearTimeout(this.$NotificationJewelReminder9);}.bind(this)),k.listen(ba,'mouseleave',this.$NotificationJewelRemindera.bind(this)),k.listen(ba,'click',function(){this.$NotificationJewelRemindera();t.show(u('fbNotificationsJewel'));}.bind(this)));};z.prototype.$NotificationJewelRemindera=function(){"use strict";clearTimeout(this.$NotificationJewelReminder9);this.$NotificationJewelReminder8.hide();this.$NotificationJewelReminderb.release();};e.exports=z;},null);
__d("PrivacyLiteFlyout",["Animation","Arbiter","ArbiterMixin","AsyncRequest","CSS","DOM","Ease","Event","Parent","PrivacyConst","SelectorDeprecated","Style","Toggler","copyProperties","csx","cx","ge","XPrivacyRemindersDismissControllerURIBuilder"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){var y='PrivacyLiteFlyout/expandingSection',z={},aa={};function ba(ja,ka,la){var ma=ka?0:ja.offsetHeight;r.set(ja,'height',ma+'px');r.set(ja,'overflow','hidden');k.show(ja);var na=ka?ja.scrollHeight:0,oa=l.getID(ja);z[oa]&&z[oa].stop();z[oa]=new g(ja).to('height',na).ondone(function(){z[oa]=null;r.set(ja,'height','');r.set(ja,'overflow','');na||k.hide(ja);la();}).duration(Math.abs(na-ma)*1.5).ease(m.sineOut).go();}function ca(ja){return new j().setURI(ja).send();}function da(){return ca('/ajax/privacy/privacy_lite/increment_masher_tip_count');}function ea(){return ca('/ajax/privacy/privacy_lite/dismiss_masher_tip');}var fa=null,ga=false,ha=false,ia=t({loadBody:function(){this._loadBody(false);},loadBodyFromMegaphone:function(){this._loadBody(true);},_loadBody:function(ja){if(!ga&&w('fbPrivacyLiteFlyoutLoading')){ga=true;new j('/ajax/privacy/privacy_lite/loader').setData({from_megaphone:ja}).send();}},renderBody:function(ja,ka){var la=w('fbPrivacyLiteFlyoutLoading');if(la){l.replace(la,ja);ia.registerCallback(function(){ia.inform('load',null,h.BEHAVIOR_STATE);},ka);}},hideCleanup:function(ja){h.inform(y);var ka=l.scry(ja,"._2va0").forEach(function(la){k.removeClass(la,"_2va0");});},registerFlyoutToggler:function(ja,ka){fa=ka;var la=s.createInstance(ja);la.setSticky(false);s.listen(['show','hide'],ka,function(ma){ia.inform(ma);ha=ma==='show';if(!ha){ia.hideCleanup(ja);la.hide();h.inform('layer_hidden',{type:'PrivacyShortcutsFlyout'});}else h.inform('layer_shown',{type:'PrivacyShortcutsFlyout'});});},isFlyoutVisible:function(){return fa&&s.getActive()===fa;},exists:function(){return !!l.scry(document.body,"._59fc")[0];},setFlyoutVisible:function(ja){ja?s.show(fa):s.hide(fa);},showSection:function(ja){var ka=aa[ja],la=ka.chevron,ma=ka.sublist_container;h.inform(y,la);if(ia.inform('expand',ja)!==false){k.removeClass(la,"_9or");k.addClass(la,"_9os");ba(ma,true,function(){ia.inform('expanded',ja);});}},hideSection:function(ja,ka,la){var ma=aa[ja],na=ma.chevron,oa=ma.sublist_container;if(la===na)return;if(ia.inform('collapse',ja)!==false){k.addClass(na,"_9or");k.removeClass(na,"_9os");ba(oa,false,function(){ia.inform('collapsed',ja);});}},toggleSection:function(ja){var ka=aa[ja].chevron;s.getInstance(ka).hide();if(k.hasClass(ka,"_9or")){ia.showSection(ja);new j('/ajax/privacy/privacy_lite/log_section_expand').setData({section:ja}).send();}else ia.hideSection(ja);},registerSection:function(ja,ka){aa[ja]=ka;h.subscribe(y,ia.hideSection.bind(null,ja));n.listen(ka.section_block,'click',ia.toggleSection.bind(null,ja));ia.inform(ja);},registerInlineHelpOnAudienceChangeOldSelector:function(ja,ka,la,ma){q.subscribe('select',function(na,oa){if(oa.selector!=ja)return;this._registerInlineHelpOnAudienceChange(ka,la,ma,oa.value);}.bind(this));},registerInlineHelpOnAudienceChangeNewSelector:function(ja,ka,la,ma){ja=ja.getInstance();ja.subscribe('changed',function(na){this._registerInlineHelpOnAudienceChange(ka,la,ma,ja.getSelectedBaseValue());}.bind(this));},_registerInlineHelpOnAudienceChange:function(ja,ka,la,ma){var na=l.find(ja,"._9o_"),oa=l.find(ja,"._2v9_");if(la){var pa=l.find(ja,"._5n9w"),qa=(ma==p.BaseValue.EVERYONE);k.conditionShow(pa,qa);k.conditionShow(na,!qa);if(pa&&qa){var ra=(new x()).setString('type','delta_everyone').setBool('log_plite',true).getURI();new j(ra).send();}}else k.show(na);k.hide(oa);if(ka)new j('/ajax/privacy/privacy_lite/kill_intro').send();},registerInlineHelpXOutOnClick:function(ja,ka,la){n.listen(ja,'click',function(){k.addClass(ka,"_9p0");});},registerBlockUnhideOnFocus:function(ja,ka){n.listen(ja,'focus',k.show.bind(null,ka));},registerMessageFilterSettingOnClick:function(ja,ka){var la=l.find(ja,"._fv0");n.listen(ja,'click',function(){if(la.checked)new j('/ajax/mercury/change_filtering_type.php').setData({filtering_type:ka,source:'privacy_lite'}).send();});},registerMasher:function(ja,ka){var la=false;h.subscribe(y,function(ma,na){var oa=true;if(na)oa=!!l.scry(o.byTag(na,'li'),"._571t").length;if(la||!oa)return;la=!!(da());});n.listen(ka,'click',function(){l.remove(ja);ea();});}},i);e.exports=ia;},null);
__d("PrivacyLiteFlyoutHelp",["Event","Arbiter","AsyncRequest","ContextualHelpSearchController","CSS","DOM","Parent","copyProperties","csx","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q,r;function s(t,u,v,w,x){this._width=315;r=l.find(u,'input');var y=l.create('div');this.init(t,r,y,v,w,{focusSearchBox:false});q=m.byClass(u,"_8-a");g.listen(x,'click',this._hideSearch.bind(this));h.subscribe('PrivacyLiteFlyout/expandingSection',this._hideSearch.bind(this));var z=l.scry(q,"._d1r")[0];z&&g.listen(z,'click',function(){k.addClass(q,"_aw6");r.focus();if(!this.suggestedResults)new i('/ajax/privacy/privacy_lite/help_suggestions').setHandler(function(aa){var ba=aa.getPayload().searchSuggestions,ca=l.find(q,"._4_8m");l.setContent(ca,ba);k.addClass(q,"_4_8l");}.bind(this)).send();}.bind(this));}n(s.prototype,new j(),{source:'privacy_shortcuts',_hideSearch:function(){this.clearResults();k.removeClass(q,"_aw6");},show:function(t){if(t===this.topics_area){k.removeClass(q,"_aw7");return;}else if(t===this.loader){k.addClass(q,"_aw7");k.hide(this.results_area);}else k.hide(this.loader);k.show(t);}});e.exports=s;},null);
__d("SearchDataSource",["Event","Arbiter","AsyncResponse","DataSource","HashtagSearchResultUtils","copyProperties","createArrayFrom","BingScalingCommon","PageTransitions","SearchSingleState","UnicodeCJK"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r='/typeahead/search/facebar/nullstate/';for(var s in j)if(j.hasOwnProperty(s))u[s]=j[s];var t=j===null?null:j.prototype;u.prototype=Object.create(t);u.prototype.constructor=u;u.__superConstructor__=j;function u(v){"use strict";this._token=v.token||'';this._lazyonload=v.lazyonload===false?false:true;this._extraTypes=v.extraTypes;this._buckets=v.buckets;this._noMultiFetch=v.noMultiFetch||false;this._maxWebSuggToCountFetchMore=v.maxWebSuggToCountFetchMore||0;this._nullStateConfig=v.nullStateConfig||{};var w=v.maxResults||8;j.call(this,v);this._numResults={min:3,max:w};this.recordingRoute=v.recordingRoute||'non_banzai';this._enabledHashtag=v.enabledHashtag||false;this.logBackendQueriesWindow=v.logBackendQueriesWindow||25;this._minWebSugg=v.minWebSugg||2;this._queryToWebSuggState={};this._genTime=v.genTime;this.cacheUnicodeMatch.setConfigs({prefix_hangul_conjoining_jamo:true,prefix_kana_drop_trailing_latin:v.cjkDropLatinInCjTokens,prefix_kana_hiragana_to_katakana:v.cjkUiCacheHiraganaToKatakana});this.backendUnicodeMatch.setConfigs({prefix_kana_drop_trailing_latin:v.cjkDropLatinInCjTokens});}u.prototype.init=function(){"use strict";t.init.call(this);this._leanPayload=null;this._bootstrapRequestsPending=0;this._criticalOnly=true;this._updateMaxResults();g.listen(window,'resize',this._updateMaxResults.bind(this));if(this._nullStateConfig.singleState){o.registerHandler(this.handlePageTransition.bind(this));h.subscribe('search/updateNullState',this.updateNullState.bind(this));}if(this._nullStateConfig.recent)h.subscribe('search/refreshRecentSearchesNullstate',this.refreshRecentSearches.bind(this));};u.prototype.refreshRecentSearches=function(){"use strict";this.nullStateData=null;};u.prototype.handlePageTransition=function(){"use strict";this.nullStateParams={};};u.prototype.updateNullState=function(event,v){"use strict";this.nullStateParams=v;this.fetchNullState();};u.prototype.fetchNullState=function(){"use strict";if(!this._nullStateConfig.hasNullState)return;var v=null;if(this.nullStateParams&&this.nullStateParams.uid){v=this._fetchDataForSingleState();}else v=this._fetchDataForNullState();if(v)this.inform('respond',{value:'',results:v,isAsync:false});};u.prototype._fetchDataForSingleState=function(){"use strict";if(this.nullStateDataWithProfile&&this.nullStateParams.uid===this.nullStateDataWithProfile.profileID)return this.nullStateDataWithProfile.data;if(this.nullStateParams.type==='ent:app'||this.nullStateParams.type==='ent:group'||this.nullStateParams.type==='ent:page'){this.fetch(r,{profile_id:this.nullStateParams.uid,ent_type:this.nullStateParams.type},{singleState:true});this.nullStateDataWithProfile={profileID:this.nullStateParams.uid};return;}var v=p.getSuggestions(this.nullStateParams.uid,this.nullStateParams.text,this.nullStateParams.type);if(!v)return this._fetchDataForNullState();this.nullStateDataWithProfile={data:v,profileID:this.nullStateParams.uid};return v;};u.prototype._shouldRefreshNullState=function(){"use strict";if(!this._nullStateConfig.recent)return false;var v=window.location.href;if(!v)return false;if(v.indexOf('allactivity')&&v.indexOf('log_filter=search'))return true;return false;};u.prototype._fetchDataForNullState=function(){"use strict";if(this.nullStateData&&!this._shouldRefreshNullState())return this.nullStateData;this.fetch(r,{value:""},{nullState:true,value:''});return null;};u.prototype.dirty=function(){"use strict";t.dirty.call(this);this._fetchOnUseRequests=[];};u.prototype.asyncErrorHandler=function(v){"use strict";if(window.Dialog&&window.Dialog.getCurrent()==null&&v.getError()==1400003)i.verboseErrorHandler(v);};u.prototype.fetch=function(v,w,x){"use strict";x=x||{};x.fetch_start=Date.now();var y=o.getMostRecentURI().path;w=l(w,{path:y});t.fetch.call(this,v,w,x);};u.prototype.fetchHandler=function(v,w){"use strict";if(w.nullState){this.nullStateData=v.getPayload().entries;this.inform('respond',{value:'',results:v.getPayload().entries,isAsync:true});return;}if(w.singleState){this.nullStateDataWithProfile.data=v.getPayload().entries;this.inform('respond',{value:'',results:v.getPayload().entries,isAsync:true});return;}var x=v.getPayload(),y=l({fetch_end:Date.now()},w),z=y.value?h.BEHAVIOR_EVENT:h.BEHAVIOR_PERSISTENT;this.inform('beginFetchHandler',{response:v});if(w.type=='lean'){this._leanPayload=x;this._processLean();}else{if(x.coeff2_ts)y.coeff2_ts=x.coeff2_ts;var aa={limit:typeof x.webSuggLimit!=='undefined'?x.webSuggLimit:6,showOnTop:typeof x.webSuggOnTop!=='undefined'?x.webSuggOnTop:false};this._queryToWebSuggState[w.value]=aa;t.fetchHandler.call(this,v,w);if(w.bootstrap&&!v.getRequest().getData().no_cache)y.browserCacheHit=(x.timestamp<this._genTime);if(w.bootstrap&&!x.no_data&&this._bootstrapRequestsPending>0){w.bootstrap=false;--this._bootstrapRequestsPending;!this._bootstrapRequestsPending&&this._bootstrapPostProcess();}if(x.no_data||x.stale||x.token!==this._token){var ba=l({},v.getRequest().getData());if(ba.lazy){delete ba.lazy;ba.token=this._token;this._fetchOnUse(ba,w);}}}this.inform('endpointStats',y,z);if(w&&!!w.value)this.inform('completeFetch',{response:v,stats:y});};u.prototype.respond=function(v,w,x){"use strict";this.inform('respondValidUids',w);this.inform('reorderResults',w);var y=this.buildData(w,v);y.forEach(function(z,aa){z.origIndex=aa;});this.inform('respond',{value:v,results:y,isAsync:!!x});return y;};u.prototype.buildData=function(v,w){"use strict";if(!v||v.length===0)return [];var x=this.getWebSuggState(w),y=x.showOnTop,z=n.integrateWebsuggestions(v.map(this.getEntry.bind(this)),Boolean(y),this._maxResults,x.limit);z.length=Math.min(z.length,this._maxResults);return z;};u.prototype.getWebSuggState=function(v){"use strict";while(v){var w=this._queryToWebSuggState[v];if(typeof w!=='undefined')return w;v=v.slice(0,v.length-1);}return {limit:0,showOnTop:false};};u.prototype.fetchLean=function(){"use strict";this._fetchLean();};u.prototype._isQueryTooShort=function(v){"use strict";return v.length<this._minQueryLength&&!q.hasIdeoOrSyll(v);};u.prototype.shouldFetchMoreResults=function(v){"use strict";var w=0,x=0;v.forEach(function(y){if(y.type!=='websuggestion'||x++<this._maxWebSuggToCountFetchMore)w++;}.bind(this));return w<this._maxResults;};u.prototype._bootstrapPostProcess=function(){"use strict";var v={time:Date.now()};this.inform('bootstrapped',v,h.BEHAVIOR_PERSISTENT);this._processLean();};u.prototype._processLean=function(){"use strict";if(this._leanPayload){var v,w=this._leanPayload.entries;for(var x in w){v=this.getEntry(x);v&&(v.index=w[x]);}this.setExclusions(this._leanPayload.blocked);this._leanPayload=null;}};u.prototype._updateMaxResults=function(){"use strict";var v=window.innerHeight||document.documentElement.clientHeight;this.setMaxResults(Math.max(this._numResults.min,Math.min(this._numResults.max,Math.ceil(2+((v-370)/56)))));};u.prototype._bootstrapFetch=function(v,w){"use strict";var x=l(w,this.bootstrapData);if(this._criticalOnly&&this._lazyonload)x.lazy=1;this.fetch(this.bootstrapEndpoint,x,{bootstrap:true,type:v});++this._bootstrapRequestsPending;};u.prototype._fetchOnUse=function(v,w){"use strict";for(var x in this.bootstrapData)!v.hasOwnProperty(x)&&(v[x]=this.bootstrapData[x]);if(this._criticalOnly){this._fetchOnUseRequests.push({args:v,ctx:w});}else this.fetch(this.bootstrapEndpoint,v,w);};u.prototype._fetchLean=function(){"use strict";var v={no_cache:1};v.options=m(v.options);v.options.push('lean');this._fetchOnUse(v,{type:'lean'});};u.prototype.bootstrap=function(v){"use strict";if(!v){this._criticalOnly=false;this._flushFetchOnUseRequests();}if(this._bootstrapped)return;var w={filter:['event'],no_cache:1};this._fetchOnUse(w,{type:'event'});var x=['app','page','group','friendlist'];x=x.concat(this._extraTypes||[]);if(this._noMultiFetch){x.push('user');this._bootstrapFetch('user',{filter:x});}else{this._bootstrapFetch('other',{filter:x});if(this._buckets){for(var y=0;y<this._buckets.length;++y){var z={filter:['user'],buckets:this._buckets[y]};this._bootstrapFetch('user',z);}}else this._bootstrapFetch('user',{filter:['user']});}this._fetchLean();this._bootstrapped=true;};u.prototype._flushFetchOnUseRequests=function(){"use strict";var v=this._fetchOnUseRequests.length;for(var w=0;w<v;++w){var x=this._fetchOnUseRequests[w];this.fetch(this.bootstrapEndpoint,x.args,x.ctx);}if(v>0)this.inform('extra_bootstrap',{time:Date.now()},h.BEHAVIOR_PERSISTENT);this._fetchOnUseRequests=[];};u.prototype.onLoad=function(v,w){"use strict";this.inform('onload',{time:Date.now()},h.BEHAVIOR_PERSISTENT);if(v)setTimeout(this.bootstrap.bind(this,w),0);};u.prototype.mergeUids=function(v,w,x,y){"use strict";var z=this.getDynamicHashtagResult(y);if(y&&z&&w.indexOf(z)<=0)w.unshift(z);var aa=x[0]?this.getEntry(x[0]):null,ba=w[0]?this.getEntry(w[0]):null,ca=(aa&&aa.replace_results)?aa:null;ca=(!ca&&ba&&ba.replace_results)?ba:ca;var da=t.mergeUids.call(this,v,w,x,y);if(ca){this.inform('backend_topreplace',{});return this.deduplicateByKey([ca.uid].concat(da));}return da;};u.prototype.getTextToIndexFromFields=function(v,w){"use strict";var x=[],y=v.tokenVersion==="v2";for(var z=0;z<w.length;++z){if(y&&(w[z]==="text"||w[z]==="alias"))continue;var aa=v[w[z]];if(aa)x.push(aa.join?aa.join(' '):aa);}return x.join(' ');};u.prototype.getDynamicHashtagResult=function(v){"use strict";if(!v||!this._enabledHashtag)return;var w=k.getHashtagFromQuery(v);if(!w)return;var x='hashtag:'+w,y=this.getEntry(x);if(!y)this.processEntries([k.makeTypeaheadResult(w)],v);return x;};e.exports=u;},null);
__d("legacy:SearchDataSource",["SearchDataSource"],function(a,b,c,d){a.SearchDataSource=b('SearchDataSource');},3);
__d("SearchTypeaheadCore",["Arbiter","DOM","Event","Input","Parent","TypeaheadCore","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){for(var n in l)if(l.hasOwnProperty(n))p[n]=l[n];var o=l===null?null:l.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=l;function p(q){"use strict";l.call(this,q);}p.prototype.init=function(q,r,s){"use strict";o.init.call(this,q,r,s);var t=k.byTag(s,'form'),u=this.reset.bind(this);g.subscribe('pre_page_transition',function(event,w){var x=/^\/search/,y=x.test(w.from.path),z=x.test(w.to.path);if(y&&!z)setTimeout(u,0);});if(t){var v=h.find(t,'input.search_sid_input');i.listen(t,'submit',function(){if(this.data&&this.data.queryData)v.value=this.data.queryData.sid;setTimeout(u,0);}.bind(this),i.Priority.URGENT);}};p.prototype.select=function(){"use strict";this.reset();this.element.focus();setTimeout((function(){this.element.blur();}).bind(this),0);};p.prototype.handleTab=function(event){"use strict";var q=this.view.getQuerySuggestion(this.value);if(q){j.setValue(this.element,q);this.checkValue();event.kill();}else o.handleTab.call(this,event);};p.prototype.getSearchType=function(){"use strict";return 'regular';};p.prototype.focus=function(){"use strict";o.focus.call(this);if(this.getValue().length===0)this.data.fetchNullState();};p.prototype.keyup=function(){"use strict";o.keyup.call(this);if(this.getValue().length===0)this.data.fetchNullState();};e.exports=p;},null);
__d("legacy:SearchTypeaheadCore",["SearchTypeaheadCore"],function(a,b,c,d){a.SearchTypeaheadCore=b('SearchTypeaheadCore');},3);
__d("SearchPeopleSeeMore",["fbt","TokenizeUtil","URI"],function(a,b,c,d,e,f,g,h,i){var j=3;function k(l,m){"use strict";this.results=l;this.seeMoreUri=m;}k.prototype.addResult=function(){"use strict";var l=null,m=0,n=[];for(var o=0;o<this.results.length;o++){var p=this.results[o];if(p.type!='user')break;m++;if(!l){l=p.text;}else l=this.findCommonTokens(l,p.text);if(!l)break;n.push(p);}if(l&&m>=j)n.push(this.createFindAllPeopleResult(l));for(;o<this.results.length;o++)n.push(this.results[o]);return n;};k.prototype.createFindAllPeopleResult=function(l){"use strict";var m=g._("Find all people named \"{query}\"",[g.param("query",l.toLowerCase())]),n=i(this.seeMoreUri).addQueryData({q:l,init:'psm'}).toString();return {type:'user',text:m,classNames:'seeAllUser',photo:'/images/search_typeahead/people_see_more.png',logType:'grammar',path:n};};k.prototype.findCommonTokens=function(l,m){"use strict";if(!l||!m)return;var n=h.tokenize(l),o=h.tokenize(m),p=0;for(var q=0;q<n.length&&q<o.length;q++)if(n[q]===o[q]){p++;}else break;if(!p)return null;if(p===n.length)return l;if(p===o.length)return m;var r='';for(var s=0;s<p;s++)r=n[s]+'';return r.trim();};e.exports=k;},null);
__d("SearchTypeaheadView",["Arbiter","ContextualTypeaheadView","ContextualLayerUpdateOnScroll","copyProperties","DOM","goURI","MusicConstants","MusicEvents","tx","URI","isEmail","fbt","SearchPeopleSeeMore"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){for(var t in h)if(h.hasOwnProperty(t))v[t]=h[t];var u=h===null?null:h.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=h;function v(x,y){"use strict";h.call(this,x,y);}v.prototype.initializeLayer=function(){"use strict";u.initializeLayer.call(this);this.layer.setOffsetY(-1);this.layer.enableBehavior(i);};v.prototype.ignoreClick=function(event){"use strict";event.prevent();};v.prototype.render=function(x,y,z){"use strict";if(!y||!y.length)return;if(this._bucketize)y=w(y);if(this.showPeopleSeeMore&&x){var aa=new s(y,this.getSeeMoreEndpoint('',true));y=aa.addResult();}var ba={results:y,value:x};this.inform('finalResultsReordering',ba);return u.render.call(this,x,ba.results,z);};v.prototype.disableBucketization=function(){"use strict";this._bucketize=false;};v.prototype.buildBuckets=function(x,y){"use strict";var z=y.length,aa=0,ba;for(ba=0;ba<z;++ba)if(y[ba].type=='user')aa++;this._redirectToUsersResultsPage=this.showFilterResults&&aa===z;this.setWebSuggLoggingParams(x,y);if(this._bucketize)y=u.buildBuckets.call(this,x,y);if(x&&this._shouldShowSeeMore){y.push(this.buildSeeMore(x,z));if(q(x)&&(aa<1))y.push(this.buildInvite(x));}return y;};v.prototype.buildSeeMore=function(x,y){"use strict";var z=this.getSeeMoreText(x,y),aa=y==1?"Displaying top result":o._("Displaying top {number} results",{number:y}),ba=k.create('li',{className:'calltoaction'},[k.create('a',{href:this.getSeeMoreEndpoint(x),rel:'ignore'},[k.create('span',{className:'text'},[k.create('span',{className:'seeMore'},[z,k.create('span',{className:'arrow'})]),k.create('span',{className:'subtext'},[aa])])])]);ba.setAttribute('aria-label',z);return {uid:'search',node:ba,search:true};};v.prototype.getSeeMoreText=function(x,y){"use strict";if(this.showKeywordResultsPage)return r._("Search for {query}",[r.param("query",x)]);if(y<=0)return o._("See results for {query}",{query:x});if(this._redirectToUsersResultsPage)return r._("Filter results for {query}",[r.param("query",x)]);return o._("See more results for {query}",{query:x});};v.prototype.buildInvite=function(x){"use strict";var y=o._("Invite {query} to Facebook",{query:x}),z=k.create('li',{className:'calltoaction'},[k.create('a',{href:this.getInviteEndpoint(x),rel:'ignore'},[k.create('span',{className:'text'},[k.create('span',{className:'invite'},[y])])])]);z.setAttribute('aria-label',y);return {uid:'invite',node:z,search:true};};v.prototype.searchPageQueryData=function(x){"use strict";return j({q:x},this.queryData||{});};v.prototype.searchPageTypeData=function(x){"use strict";return this._redirectToUsersResultsPage||x?{type:"users"}:{};};v.prototype.select=function(x){"use strict";var y=this.index,z=this.results[y];if(!z||z.type=='header')return;var aa=this.items[y],ba=k.scry(aa,'a')[0];if(z.song){if(ba)n.inform(m.MUSIC_BUTTON.ACTIVATE,ba);x&&this.inform('highlight',{index:y,selected:z});}else{u.select.call(this,x);if(ba&&ba.href)if(ba.target=='_blank'){window.open(ba.href);}else l(ba.href);}};v.prototype.setSid=function(x){"use strict";this.queryData.tas=x;};v.prototype.getSeeMoreEndpoint=function(x,y){"use strict";return p(this.seeMoreEndpoint).addQueryData(this.searchPageQueryData(x)).addQueryData(this.searchPageTypeData(y)).toString();};v.prototype.getInviteEndpoint=function(x){"use strict";return p('/invite.php').addQueryData({email_list:x});};v.prototype.show=function(){"use strict";if(!this.isVisible()){g.inform('layer_shown',{type:'SearchTypeahead'});u.show.call(this);}};v.prototype.hide=function(){"use strict";if(this.isVisible()){g.inform('layer_hidden',{type:'SearchTypeahead'});u.hide.call(this);}};v.prototype.getQuerySuggestion=function(x){"use strict";var y=this.results[this.index],z=y&&y.type!='header'?y.text.toLowerCase():'';return z==x.toLowerCase()?'':z;};v.prototype.setWebSuggLoggingParams=function(x,y){"use strict";var z=0,aa=0;for(var ba=0;ba<y.length;ba++)if(y[ba].type==='websuggestion'){if(aa===0)aa=ba+1;var ca='FR'+(ba-z)+'AS'+z,da=ba+1;y[ba].path+='&wssk='+ca+'&wssp='+da+'&wspq='+encodeURIComponent(x);y[ba].path+='&wssrc='+y[ba].websuggestion_source;z++;}var ea='&wssc='+y.length+'-'+x.length+'&wsbp='+z+'-'+aa;for(ba=0;ba<y.length;ba++)if(y[ba].type==='websuggestion')y[ba].path+=ea;};function w(x){var y,z,aa,ba,ca=[],da={};z=x.length;for(y=0;y<z;y++){aa=x[y];ba=aa.render_type||aa.type;if(!da.hasOwnProperty(ba)){da[ba]=ca.length;ca.push([]);}ca[da[ba]].push(aa);}var ea=[];z=ca.length;for(y=0;y<z;++y){aa=ca[y][0];ba=aa.render_type||aa.type;ea=ea.concat(ca[y]);}return ea;}j(v.prototype,{_shouldShowSeeMore:true,_bucketize:true,queryData:{init:'quick'}});e.exports=v;},null);
__d("legacy:SearchTypeaheadView",["SearchTypeaheadView"],function(a,b,c,d){a.SearchTypeaheadView=b('SearchTypeaheadView');},3);
__d("legacy:Typeahead",["Typeahead"],function(a,b,c,d){a.Typeahead=b('Typeahead');},3);
__d("SearchTypeaheadRecorder",["AsyncRequest","Banzai","CurrentUser","Event","Keys","BanzaiScuba","TokenizeUtil","Vector","clickRefAction","copyProperties","ge","userAction","FacebarGlobalOptions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(v){"use strict";this.init(v);this.initEvents();}t.prototype.init=function(v){"use strict";this.core=v.getCore();this.data=v.getData();this.view=v.getView();this.element=this.core.getElement();this.initTime=Date.now();this._onloadTime=0;this._extraRecorder=[];this.performanceTimings={};var w=q('search_first_focus');this.initStartTime=w&&w.value;this.bootstrapStats={bootstrapped:0};this.type="legacy_search";this._reset();};t.prototype._reset=function(){"use strict";this.stats={};this.avgStats={};this.appendStats={};this._backspacing=false;this.backendQueries=[];this._topreplace=false;this._inflightRequests={};var v=Math.random().toString();this.data.setQueryData({sid:v});this.view.setSid(v);this.recordStat('sid',v);this.recordStat('keypressed',0);};t.prototype.initEvents=function(){"use strict";this.core.subscribe('focus',function(event){if(!this.stats.session_start_time){this.recordStat('session_start_time',Date.now());var v=new Date(),w=v.getTimezoneOffset(),x=Date.now()-w*60*1000;this.recordStat('session_start_time_user_timezone',x);}}.bind(this));this.core.subscribe('blur',function(event){var v=Date.now();for(var w in this._inflightRequests){var x=this._inflightRequests[w],y=v-x;this.recordAvgStat('search_endpoint_ms_from_js',y);}this.recordStat('session_end_time',v);this.submit();}.bind(this));this.view.subscribe('select',function(v,w){this.recordSelectInfo(w);}.bind(this));this.view.subscribe('render',function(v,w){this.recordRender(w);}.bind(this));this.data.subscribe('activity',function(v,w){this.recordStat('pending_request',w.activity);}.bind(this));this.data.subscribe('respondValidUids',function(v,w){this.validUids=w.slice(0);}.bind(this));this.data.subscribe('beforeQuery',function(v,w){if(!w.value){this.query='';this.results=[];return;}if(!this.stats.first_query_time)this.recordStat('first_query_time',Date.now());this.query=w.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('queryEndpoint',function(v,w){this.recordCountStat('num_search_ajax_requests');this.recordAvgStat('endpoint_query_length',w.value.length);this._inflightRequests[w.value]=Date.now();}.bind(this));this.data.subscribe('onload',function(v,w){this._onloadTime=w.time;}.bind(this));this.data.subscribe('bootstrapped',function(v,w){this.bootstrapStats.endTime=w.time;this.bootstrapStats.bootstrapped=1;}.bind(this));this.core.subscribe('recordFunction',function(v,w){this._extraRecorder.push(w);}.bind(this));this.data.subscribe('endpointStats',function(v,w){var x=w.fetch_end-w.fetch_start;if(w.value){this.recordAvgStat('search_endpoint_ms_from_js',x);}else this.bootstrapStats[w.type]=x;if(w.coeff2_ts)this.bootstrapStats.coeff2_ts=w.coeff2_ts;if(typeof w.browserCacheHit!='undefined')this.recordCountStat(w.browserCacheHit?'bootstrap_cachehits':'bootstrap_cachemisses');if(this._inflightRequests[w.value])delete this._inflightRequests[w.value];}.bind(this));this.data.subscribe('query',function(v,w){this.recordAvgStat('num_results_from_cache',w.results.length);}.bind(this));this.data.subscribe('backend_topreplace',function(v,w){if(false===this._topreplace){this.recordStat("backend_topreplace",1);this._topreplace=true;}}.bind(this));this.data.subscribe('completeFetch',function(v,w){if(this.core.scubaInfo){var x=w.response,y={recv:w.stats.fetch_end-w.stats.fetch_start,render:Date.now()-w.stats.fetch_start,payload_size:JSON.stringify(x).length};if(!x.payload.entities)x.payload.entities=this.buildResults();this.logToScuba(x,y,this.core.scubaInfo,this.query,this.type);}}.bind(this));j.listen(this.element,'keydown',function(event){this.recordStat('keypressed',1);this.recordCountStat('count_keys_pressed');if(j.getKeyCode(event)==k.BACKSPACE){if(!this._backspacing&&this.query){this._backspacing=true;this.recordAppendStat('before_backspace_queries',this.query);}}else this._backspacing=false;}.bind(this));this.data.subscribe('beforeFetch',function(v,w){var x=w.request.data.value;if(!x)return;this.backendQueries.push(x);}.bind(this));};t.prototype.recordStat=function(v,w){"use strict";this.stats[v]=w;};t.prototype.recordCountStat=function(v){"use strict";var w=this.stats[v];this.stats[v]=w?w+1:1;};t.prototype.recordAvgStat=function(v,w){"use strict";if(this.avgStats[v]){this.avgStats[v][0]+=w;++this.avgStats[v][1];}else this.avgStats[v]=[w,1];};t.prototype.recordAppendStat=function(v,w){"use strict";if(!this.appendStats.hasOwnProperty(v))this.appendStats[v]=[];this.appendStats[v].push(w);};t.prototype.recordRender=function(v){"use strict";this.results=v.filter(function(x){return (x.uid!='search'&&x.type!='disabled_result'&&x.type!='header');}).map(function(x){return p(null,x);});var w=n.getViewportDimensions();this.recordStat('window_size_width',w.x);this.recordStat('window_size_height',w.y);if(this.results.length>0&&!this.stats.first_result_time)this.recordStat('first_result_time',Date.now());};t.prototype.recordSelectInfo=function(v){"use strict";var w=v.selected,x=v.index;if(w.groupIndex!==undefined)x=v.index-w.groupIndex-1;var y={href:w.path},z=w.dataGT?{gt:JSON.parse(w.dataGT)}:{};o('click',y,null,null,z);r('search').uai('click');if(w.uid=='search'){this.recordStat('selected_search',1);}else if(w.uid=='invite'){this.recordStat('selected_invite',1);}else{var aa=w.log_type||w.rankType||w.render_type||w.type,ba=(aa=='friend'?'user':aa);this.recordStat('selected_'+ba,1);this.recordStat('selected_position',x);this.recordStat('selected_type',aa);this.recordStat('selected_name_length',w.text.length);this.recordStat('selected_id',w.uid);this.recordStat('selected_degree',w.bootstrapped?1:2);this.recordStat('selected_recent_search',w.recent_search);var ca=m.parse(this.data.getTextToIndex(w)).tokens,da=u(ca,this.query);if(da)this.recordStat('matched_terms',da);}var ea={};this._extraRecorder.forEach(function(fa){fa(v,this.results,ea);}.bind(this));this.recordStat('extra_select_info',JSON.stringify(ea));if(w.type==='websuggestion'){this.recordStat('selected_memcached_websuggestion',w.fromMemcache);this.recordStat('selected_websuggestion_source',w.websuggestion_source);}this.recordStat('selected_with_mouse',v.clicked?1:0);};t.prototype._dataToSubmit=function(){"use strict";this.recordStat('candidate_results',this.buildResults());this.recordStat('query',this.query);this.recordStat('init_time',this.initTime);if(this.initStartTime){this.recordStat('init_start_time',this.initStartTime);this.recordStat('onload_time',this._onloadTime);this.initStartTime=0;}this.recordStat('bootstrapped',this.bootstrapStats.bootstrapped);if(this.bootstrapStats.endTime){this.recordStat('bootstrapped_time',this.bootstrapStats.endTime);this.recordStat('user_bootstrap_ms',this.bootstrapStats.user);this.recordStat('other_bootstrap_ms',this.bootstrapStats.other);this.bootstrapStats.endTime=0;}this.recordStat('coeff2_ts',this.bootstrapStats.coeff2_ts);this.recordStat('max_results',this.data._maxResults);if(this.backendQueries.length>0){if(this.backendQueries.length>this.data.logBackendQueriesWindow)this.backendQueries=this.backendQueries.slice(this.backendQueries.length-this.data.logBackendQueriesWindow);this.recordStat('backend_queries',this.backendQueries);}if(s.taSessionLoggingSample){var v=[];this.results.forEach(function(aa){v.push([aa.text||'',aa.category||'',aa.subtext||'']);});this.recordStat('raw_suggestions_text',v);}var w=this.stats;for(var x in this.avgStats){var y=this.avgStats[x];w[x]=y[0]/y[1];}for(var z in this.appendStats)w[z]=JSON.stringify(this.appendStats[z]);return w;};t.prototype.buildResults=function(){"use strict";var v=(this.results||[]).map(function(w,x){var y=m.parse(this.data.getTextToIndex(w)).tokens,z=w.rankType||w.render_type||w.type,aa=w.bootstrapped?1:0,ba=w.s_token||'',ca=(typeof w.index=='undefined')?100:w.index,da=u(y,this.query)||this.query,ea=w.index_rank,fa=w.match_type,ga=w.l_type,ha=w.vertical_type,ia=w.prefix_match,ja=w.prefix_length,ka=w.text,la=w.category,ma=w.subtext;if(typeof w.groupIndex=='number')return [w.groupIndex,w.indexInGroup,w.uid,z,aa,ba,da,ea,fa,ia,ja,w.origIndex,ga,ha,ka,la,ma,ca];return [0,x,w.uid,z,aa,ba,da,ea,fa,ia,ja,w.origIndex,ga,ha,ka,la,ma,ca];}.bind(this));return JSON.stringify(v);};t.prototype.submit=function(){"use strict";var v=this._dataToSubmit();switch(this.data.recordingRoute){case 'double_recording':if(Math.random()>.5){v.recorded_first='legacy';setTimeout(this.submitThroughAsyncRequest.bind(this,v),0);h.post(this._banzaiRoute,v,{delay:0,retry:true});}else{v.recorded_first='banzai';h.post(this._banzaiRoute,v,{delay:0,retry:true});setTimeout(this.submitThroughAsyncRequest.bind(this,v),0);}break;case 'random_recording':if(Math.random()>.5){this.submitThroughAsyncRequest(v);}else h.post(this._banzaiRoute,v,{delay:0,retry:true});break;case 'banzai_basic':h.post(this._banzaiRoute,v);break;case 'banzai_vital':h.post(this._banzaiRoute,v,{delay:0,retry:true});break;default:this.submitThroughAsyncRequest(v);}this._reset();};t.prototype.addLatencyToSample=function(v,w,x){"use strict";v.addInteger(x+'query_start',w.queryStart);v.addInteger(x+'query_end',w.queryEnd);v.addInteger(x+'keypress_query_end',w.keyPressToQueryEnd);v.addInteger(x+'render',w.render);v.addInteger(x+'keypress_render',w.keyPressToRender);};t.prototype.logToScuba=function(v,w,x,y,z){"use strict";var aa=new l('search_facebar_js',null,{addBrowserFields:true,addPredictedGeographyFields:true,addUser:true,addSearchVersion:true,addGatekeepers:{facebarGKs:true}});aa.addInteger('sample_rate',x.sample_rate);aa.addNormal('site',x.site);aa.addDenorm('query',y);var ba=v.payload;ba.entities&&aa.addInteger('num_entities',ba.entities.length);Object.keys(this.performanceTimings).forEach(function(ca){aa.addInteger(ca,this.performanceTimings[ca]);}.bind(this),this);if(ba.results||ba.entries)aa.addInteger('num_results',(ba.results||ba.entries).length);if(ba.gzipped_payload_size!==undefined)aa.addInteger('gzipped_payload_size',ba.gzipped_payload_size);if(w.recv&&w.render>w.recv){aa.addInteger('time_render',w.render-w.recv);aa.addInteger('time_js_async',w.recv);}if(w.payload_size)aa.addInteger('payload_size',w.payload_size);aa.addInteger('query_id',v.queryId);aa.addDenorm('user_id',i.getID());aa.addDenorm('session_id',this.stats.sid);aa.addNormal('typeahead_type',z);if(w.remoteQueryLatencies){this.addLatencyToSample(aa,w.remoteQueryLatencies,'remote_');aa.addInteger('remote_keypress_query_dispatch',w.remoteQueryLatencies.keyPressToQueryDispatch);aa.addInteger('remote_keypress_query_start',w.remoteQueryLatencies.keyPressToQueryStart);aa.addNormal('inflight_requests',w.remoteQueryLatencies.inflightRequests);aa.addInteger('inflight_requests',w.remoteQueryLatencies.inflightRequests);aa.addNormal('waiting_queries',w.remoteQueryLatencies.waitingQueries);aa.addInteger('waiting_queries',w.remoteQueryLatencies.waitingQueries);}if(w.cacheQueryLatencies)this.addLatencyToSample(aa,w.cacheQueryLatencies,'cache_');aa.post();};t.prototype.submitThroughAsyncRequest=function(v){"use strict";if(Object.keys(v).length>0)new g().setURI(this._endPoint).setMethod('POST').setData({stats:v}).setOption('handleErrorAfterUnload',true).setErrorHandler(function(w){v.retry=true;new g().setURI(this._endPoint).setMethod('POST').setData({stats:v}).setOption('asynchronous',false).send();}.bind(this)).send();};var u=function(v,w){if(!v||!w)return;var x=m.parse(w);if(x.flatValue[x.flatValue.length-1]===' ')return x.flatValue;var y=x.tokens[x.tokens.length-1],z={};v.forEach(function(ea){z[ea]=(z[ea]||0)+1;});var aa={},ba=x.tokens.slice(0,x.tokens.length-1);ba.forEach(function(ea){aa[ea]=(aa[ea]||0)+1;});for(var ca=0;ca<v.length;++ca){var da=v[ca];if(da.indexOf(y)===0&&(z[da]-(aa[da]||0)>0)){ba.push(da);return ba.join(' ');}}return undefined;};p(t.prototype,{_endPoint:'/ajax/typeahead/record_metrics.php',_banzaiRoute:'search'});e.exports=t;},null);
__d("TypeaheadSearchRecorderBasic",["SearchTypeaheadRecorder","copyProperties","emptyFunction"],function(a,b,c,d,e,f,g,h,i){function j(k){"use strict";this._typeahead=k;}j.prototype.enable=function(){"use strict";new g(this._typeahead);};h(j.prototype,{disable:i});e.exports=j;},null);
__d("legacy:SearchRecorderBasicTypeaheadBehavior",["TypeaheadSearchRecorderBasic"],function(a,b,c,d,e,f,g){if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.searchRecorderBasic=function(h){h.enableBehavior(g);};},3);
__d("SearchTypeaheadRenderer",["BadgeHelper","DOM","fbt","MusicButtonManager","TokenizeUtil","TypeaheadFacepile","URI","WWWBase"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(p,q){var r=[],s=p.photos||p.photo;if(s){if(s instanceof Array){s=l.render(s);}else s=h.create('img',{alt:'',src:s});r.push(s);if(p.song){r.push(h.create('span',{className:'playButton'}));r.push(h.create('span',{className:'playLoader'}));}}var t;if(p.text){var u=p.alias,v=this.value,w=p.text;t=[w];if(u&&k.isQueryMatch(v,u)&&!k.isQueryMatch(v,w))t.push(h.create('span',{className:'alias'},[' \xB7 '+u]));if(p.is_verified)t.push(g.renderBadge('xsmall','verified'));r.push(h.create('span',{className:'text'},t));}if(p.category){var x=[p.category];if(p.is_external)x.push(h.create('span',{className:'arrow'}));var y=p.message?'preCategory':'category';r.push(h.create('span',{className:y},x));}if(p.message)r.push(h.create('span',{className:'category'},[p.message]));var z=p.subtextOverride||p.subtext;if(z)r.push(h.create('span',{className:'subtext'},[z]));var aa=p.classNames||p.type||'',ba=p.is_external?'_blank':'',ca=!p.song&&p.path||'';if(ca){if(!(/^https?\:\/\//).test(ca))ca=n.uri+ca.substr(1);ca+=(ca.indexOf('?')>0?'&':'?')+'ref=ts&fref=ts';}var da=h.create('a',{href:ca,rel:'ignore',target:ba},r);if(p.song){da.id='mb_'+(Math.random()*1e+06|0);setTimeout(j.addButton.bind(null,p.song.provider,da.id,p.song.url,p.song.context,p.song.media_type),0);da.onclick=this.ignoreClick;}var ea=null;if(p.uid==='recent'&&p.type==='header'){var fa=new m('/profile.php');fa.setQueryData({sk:'allactivity',log_filter:'search'});ea=h.create('a',{href:fa,className:'recentSearchEditLink'},"EDIT");da.setAttribute('class','recentSearchHeaderLink');}var ga=h.create('li',{className:aa},[da,ea]);if(p.text)ga.setAttribute('aria-label',p.text);return ga;}o.className='search';e.exports=o;},null);
__d("legacy:SearchTypeaheadRenderer",["SearchTypeaheadRenderer"],function(a,b,c,d){if(!a.TypeaheadRenderers)a.TypeaheadRenderers={};a.TypeaheadRenderers.search=b('SearchTypeaheadRenderer');},3);
void(0);
__d("TypeaheadSearchFilter",["Arbiter","copyProperties"],function(a,b,c,d,e,f,g,h){function i(j){"use strict";this._typeahead=j;}i.prototype.enable=function(){"use strict";var j=this._typeahead,k=j.getView().seeMoreEndpoint;this._subscriptions=[g.subscribe('search/typeahead/updateFilter',function(l,m){if(m.filter_type=='web')j.getView().queryData.form='FBKBFR';j.getView().queryData.type=m.filter_type;}),g.subscribe('search/typeahead/updateSeeMoreEndpoint',function(l,m){j.getView().seeMoreEndpoint=m;}),g.subscribe('page_transition',function(l,m){if(j.getView().queryData.form)delete j.getView().queryData.form;delete j.getView().queryData.type;j.getView().seeMoreEndpoint=k;},g.SUBSCRIBE_NEW)];};i.prototype.disable=function(){"use strict";this._subscriptions.forEach(function(j){j.unsubscribe();});this._subscriptions=null;};h(i.prototype,{_subscription:null});e.exports=i;},null);
__d("legacy:SearchFilterTypeaheadBehavior",["TypeaheadSearchFilter"],function(a,b,c,d,e,f,g){if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.initFilters=function(h){h.enableBehavior(g);};},3);
__d("TypeaheadDetectQueryLocale",[],function(a,b,c,d,e,f){function g(h){"use strict";this._typeahead=h;this._data=h.getData();this._queryCache={'':this._data.queryCache,ja_JP:{},zh_TW:{}};}g.prototype.enable=function(){"use strict";this._previousLocale='';this._reset=this._typeahead.subscribe('reset',this._swapQueryCache.bind(this,''));this._beforeQuery=this._data.subscribe('beforeQuery',function(h,i){var j=i.value;if(j===''){this._swapQueryCache('');return;}var k=null,l=j.charCodeAt(j.length-1);if(12352<=l&&l<=12543){k='ja_JP';}else if(12544<=l&&l<=12735)k='zh_TW';this._swapQueryCache(k);}.bind(this));};g.prototype.disable=function(){"use strict";this._swapQueryCache('');this._data.unsubscribe(this._beforeQuery);this._typeahead.ubsubscribe(this._reset);};g.prototype._swapQueryCache=function(h){"use strict";if(h===null||h===this._previousLocale)return;this._data.queryCache=this._queryCache[h];this._data.setQueryData({query_locale:h});this._previousLocale=h;};e.exports=g;},null);
__d("TypeaheadExcludeBootstrapFromQueryCache",[],function(a,b,c,d,e,f){function g(h){"use strict";this._data=h.getData();}g.prototype.enable=function(){"use strict";this._buildingQueryCache=false;this._buildQueryCache=this._data.subscribe('buildQueryCache',function(){this._buildingQueryCache=true;}.bind(this));this._mergeUids=this._data.subscribe('mergeUids',function(h,i){if(this._buildingQueryCache)i.local_uids.splice(0,i.local_uids.length);}.bind(this));this._fetchComplete=this._data.subscribe('fetchComplete',function(){this._buildingQueryCache=false;}.bind(this));};g.prototype.disable=function(){"use strict";this._data.unsubscribe(this._buildQueryCache);this._data.unsubscribe(this._mergeUids);this._data.unsubscribe(this._fetchComplete);};e.exports=g;},null);