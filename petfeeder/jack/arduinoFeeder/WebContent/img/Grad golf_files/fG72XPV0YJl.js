/*!CK:1002306583!*//*1402088912,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ydVwm"]); }

__d("TimelineProfilePictureLoggerEnums",[],function(a,b,c,d,e,f){e.exports={actions:{EDIT_THUMBNAIL:"edit_thumbnail",FROM_PHOTOS:"from_photos",MAKE_PROFILE:"make_profile",SILHOUETTE:"silhouette",SUGGESTION:"suggestion",SUGGESTION_UPLOAD:"suggestion_upload",SYNCED_PHOTO:"synced_photo",TAKE_PHOTO:"take_photo",UPLOAD:"upload_photo",USE_PREVIOUS:"use_previous"},flows:{PERMALINK:"permalink",SNOWLIFT:"snowlift",SPOTLIGHT:"spotlight",ZOOMCROP:"zoomcrop"},steps:{INIT:"init",CANCEL:"cancel",CROP:"crop",CROP_FAIL:"crop_fail",CROP_SAVING:"crop_saving",CROP_SUCCESS:"crop_success",FAIL:"fail",LOADING:"loading",PREVIOUS_PIC_FAIL:"previous_pic_fail",PREVIOUS_PIC_INIT:"previous_pic_init",PREVIOUS_PIC_SAVING:"previous_pic_saving",PREVIOUS_PIC_SUCCESS:"previous_pic_success",SUCCESS:"success",UPLOAD_SELECT:"upload_select",UPLOAD_SUCCESS:"upload_success",VIEWER_INIT:"viewer_init"}};},null);
__d("AbstractRangeInput.react",["Event","React","UserAgent","cx"],function(a,b,c,d,e,f,g,h,i,j){var k={BLOCK:'block',PUSH:'push',FREE:'free'},l=h.createClass({displayName:'AbstractRangeInput',propTypes:{name:h.PropTypes.string,min:h.PropTypes.number,max:h.PropTypes.number,step:h.PropTypes.number,disabled:h.PropTypes.bool,values:h.PropTypes.array,behavior:h.PropTypes.oneOf([k.BLOCK,k.PUSH,k.FREE]),onChange:h.PropTypes.func},getDefaultProps:function(){return {name:'',min:0,max:1,step:.01,disabled:false,values:[.5],behavior:k.FREE};},componentWillReceiveProps:function(m){this.setState({values:m.values});},componentWillUnmount:function(){for(var m in this._listeners){this._listeners[m]&&this._listeners[m].remove();this._listeners[m]=null;}},getInitialState:function(){var m=i.ie()<9?document.documentElement:window;this._listeners=g.listen(m,{selectstart:function(o){this.state.draggingIdx!==null&&g.prevent(o);}.bind(this),mousemove:this._onMouseMove,mouseup:this._onMouseUp});var n=this.props.values;if(this.props.behavior!==k.FREE)n.sort();return {values:n,draggingIdx:null};},_onMouseDown:function(event){g.prevent(event);var m=parseInt(event.target.getAttribute('data-value'),10);this.setState({draggingIdx:m,dragStartValue:this.state.values[m],dragStartX:event.nativeEvent.clientX,scale:event.nativeEvent.getTarget().parentNode.clientWidth});},_onMouseMove:function(event){if(this.state.draggingIdx!==null){var m=(event.clientX-this.state.dragStartX),n=(this.props.max-this.props.min)/this.state.scale,o=this.state.dragStartValue+(m*n),p=this.state.values,q=p.length,r=this.state.draggingIdx;if(this.props.step){var s=1/this.props.step;o=Math.round(o*s)/s;}var t=this.props.min,u=this.props.max;if(this.props.behavior===k.BLOCK){t=r>0?p[r-1]:t;u=r<q-1?p[r+1]:u;}o=o<t?t:o;o=o>u?u:o;p[r]=o;if(this.props.behavior===k.PUSH){for(var v=r+1,w=p.length;v<w;v++){if(p[v]>=o)break;p[v]=o;}for(v=r-1;v>=0;v--){if(p[v]<=o)break;p[v]=o;}}this.setState({values:p});this.props.onChange&&this.props.onChange(p);}},_onMouseUp:function(event){if(this.state.draggingIdx!==null)this.setState({draggingIdx:null});},render:function(){var m=this.state.values,n=this.props.max-this.props.min,o=[];for(var p=0,q=m.length;p<q;p++){var r=(m[p]-this.props.min)/n,s=this.props.name+(q>1?'['+p+']':'');o.push(h.DOM.div({className:(("_4qwr")+(this.props.disabled?' '+"_4qws":'')),'data-value':p,key:'thumb-'+p,onDragStart:g.prevent,onMouseDown:this.props.disabled?null:this._onMouseDown,style:{left:(r*100)+'%'}},h.DOM.input({onChange:this.props.onChange,name:s,value:m[p],type:"hidden"})));}return this.transferPropsTo(h.DOM.div({className:"_4qwt"},h.DOM.div({className:"_4qwu"}),o));}});e.exports=l;},null);
__d("clamp",[],function(a,b,c,d,e,f){function g(h,i,j){if(i<h)return h;if(i>j)return j;return i;}e.exports=g;},null);
__d("ManagedError",[],function(a,b,c,d,e,f){function g(h,i){Error.prototype.constructor.call(this,h);this.message=h;this.innerError=i;}g.prototype=new Error();g.prototype.constructor=g;e.exports=g;},null);
__d("ImageUtils",["UserAgent"],function(a,b,c,d,e,f,g){var h={hasLoaded:function(i){if(i.naturalWidth!==undefined){return i.complete&&i.width!==0;}else if(i.height==20&&i.width==20&&i.complete){return false;}else if(i.complete===undefined&&g.webkit()<500){var j=new Image();j.src=i.src;return j.complete;}return i.complete;}};e.exports=h;},null);
__d("SpotlightViewerInit",["DOM","React"],function(a,b,c,d,e,f,g,h){var i={render:function(j,k){var l=g.create('div');j=h.renderComponent(j,l);g.appendContent(document.body,l);j.subscribeOnce('close',function(){j.unmountComponent();g.remove(l);k&&k();});return j;}};e.exports=i;},null);
__d("PhotoEverstoreLogger",["Event","AsyncRequest","copyProperties","ImageUtils"],function(a,b,c,d,e,f,g,h,i,j){var k={BATCH_WINDOW_MS:500,storedLog:[]};function l(){}i(l,{_log:function(n){k.storedLog.push(n);if(k.storedLog.length==1)setTimeout(m,k.BATCH_WINDOW_MS);},logImmediately:function(n){l._log(n);},registerForLogging:function(n){var o=document.getElementById(n);if(o!=null)if(j.hasLoaded(o)){l._log(o.src);}else g.listen(o,'load',function(event){l._log(o.src);});}});function m(){var n=k.storedLog;k.storedLog=[];var o=JSON.stringify(n);new h().setURI('/ajax/photos/logging/everstore_logging.php').setData({loggedUrls:o}).setMethod('POST').setOption('suppressErrorHandlerWarning',true).setOption('suppressErrorAlerts',true).send();}e.exports=l;},null);
__d("PhotoSessionLog",["AsyncRequest","Run","Vector","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){function k(){}j(k,{UNKNOWN:0,ESC:1,X:2,OUTSIDE:3,UNLOAD:4,NAVIGATE:5,AGGREGATE:6,LEAVE:7,PERMALINK:0,SNOWLIFT:6,SNOWDOWN:13,AGGREGATION_COUNT:20,set:null,time:null,views:0,fbidList:[],details:{},width:0,height:0,first:false,last:false,logIds:false,version:null,source:null,buttonLikes:0,pagingAction:'',cycle:false,endOfRelevant:false,relevantCount:0,initLogging:function(l){this.set=null;this.time=new Date();this.views=0;this.hiResLoads=0;this.fullScreenViews={};this.first=true;this.last=false;this.logIds=false;this.version=l;this.buttonLikes=0;this.pagingAction='';this.cycle=false;this.endOfRelevant=false;this.relevantCount=0;if(l===k.SNOWLIFT){var m=i.getViewportDimensions();this.width=m.x;this.height=m.y;}},setLogFbids:function(l){this.logIds=l;},setPhotoSet:function(l){this.set=l;},addButtonLike:function(){this.buttonLikes++;},setPagingAction:function(l){this.pagingAction=l;},setCycle:function(l){this.cycle=l;},setEndOfRelevant:function(l){this.endOfRelevant=l;},setRelevantCount:function(l){this.relevantCount=l;},setEndMetrics:function(l){this.endMetrics=l;},setSource:function(l){this.source=l;},addPhotoView:function(l,m,n){if(this.logIds&&this.views>=this.AGGREGATION_COUNT)this.logPhotoViews(this.AGGREGATE);this.views++;if(l)this.fbidList.push([l.fbid,l.owner,Date.now()]);if(m)this.hiResLoads++;if(n)this.fullScreenViews[l.fbid]=true;},logEnterFullScreen:function(l){this.fullScreenViews[l]=true;},addDetailData:function(l,m){if(!this.details[l])this.details[l]={t:m.num_tags,l:m.has_location,c:m.has_caption,cm:m.comment_count,lk:m.like_count,w:m.width,h:m.height,ad:'{}',p:this.pagingAction};},updateAdData:function(l,m){if(this.details[l])this.details[l].ad=JSON.stringify(m);},logPhotoViews:function(l){if(!this.views)return;if(l!=this.AGGREGATE)this.last=true;var m={set:this.set,time:new Date()-this.time,fbids:this.logIds?this.fbidList:[],details:this.logIds?this.details:{},first:this.first,last:this.last,close:l?l:this.UNKNOWN,button_likes:this.buttonLikes,version:this.version,endmetric:this.endMetrics,cycle:this.cycle,end_relev:this.endOfRelevant,relev_count:this.relevantCount,source:this.source};if(this.version===k.SNOWLIFT){var n=i.getViewportDimensions();m.width=n.x||this.width;m.height=n.y||this.height;if(this.hiResLoads>0)m.hires_loads=this.hiResLoads;if(this.last){var o=Object.keys(this.fullScreenViews).length;if(o>0)m.fullscreen=o;}}new g().setURI('/ajax/photos/logging/session_logging.php').setAllowCrossPageTransition(true).setOption('asynchronous',(l!=k.UNLOAD)).setOption('suppressErrorHandlerWarning',true).setData(m).send();this.views=0;this.hiResLoads=0;this.fbidList=[];this.details={};this.first=false;this.buttonLikes=0;if(this.last){this.set=null;this.logIds=false;this.fullScreenViews={};}}});h.onUnload(function(){k.logPhotoViews(k.UNLOAD);});h.onLeave(function(){k.logPhotoViews(k.LEAVE);});e.exports=k;},null);
__d("PhotoViewerImage",["PhotoEverstoreLogger","URI","Vector"],function(a,b,c,d,e,f,g,h,i){function j(k){"use strict";this._hiResDimensions=k.hiResDimensions&&i.deserialize(k.hiResDimensions);this._normalDimensions=k.normalDimensions&&i.deserialize(k.normalDimensions);this._info=k.info;this._video=k.video;this._shouldLog=k.everstoreLogThis;this._hiResSrc=k.hiResSrc;this._normalSrc=k.normalSrc;this._thumbSrc=k.thumbSrc;this._isInverted=false;this._data=k;}j.prototype.getURIString=function(){"use strict";return h(this._info.permalink).getUnqualifiedURI().toString();};j.prototype.hasHiResDimensions=function(){"use strict";return !!this._hiResDimensions;};j.prototype.getHiResDimensions=function(){"use strict";return this._hiResDimensions;};j.prototype.getNormalDimensions=function(){"use strict";return this._normalDimensions;};j.prototype.getHiResSrc=function(){"use strict";return this._hiResSrc;};j.prototype.getNormalSrc=function(){"use strict";return this._normalSrc;};j.prototype.getThumbSrc=function(){"use strict";return this._thumbSrc;};j.prototype.getInfo=function(){"use strict";return this._info;};j.prototype.getPermalink=function(){"use strict";return this._info.permalink;};j.prototype.getHighestResSrc=function(){"use strict";return this._hiResSrc||this._normalSrc;};j.prototype.preload=function(k){"use strict";var l;if(this.getHighestResSrc())if(k&&!this._resource){this._resource=new Image();this._resource.src=this.getHighestResSrc();l=this._resource.src;if(this._shouldLog)g.logImmediately(this._resource.src);}else if(!k&&!this._small){this._small=new Image();this._small.src=this._normalSrc||this._hiResSrc;l=this._small.src;if(this._shouldLog)g.logImmediately(this._small.src);}return l;};j.prototype.setNormalDimensions=function(k,l){"use strict";this._normalDimensions=new i(k,l);};j.prototype.setHiResDimensions=function(k,l){"use strict";this._hiResDimensions=new i(k,l);};j.prototype.invertDimensions=function(){"use strict";if(this.hasHiResDimensions())this._hiResDimensions=new i(this._hiResDimensions.y,this._hiResDimensions.x);this._normalDimensions=new i(this._normalDimensions.y,this._normalDimensions.x);this._isInverted=!this._isInverted;};j.prototype.copy=function(){"use strict";return new j(this._data);};e.exports=j;},null);
__d("PhotosConst",[],function(a,b,c,d,e,f){var g={VIEWER_PERMALINK:0,VIEWER_SNOWLIFT:6,VIEWER_VAULTBOX:8,VIEWER_SNOWFLAKE:14,VIEWER_PERMALINK_STRING:'permalink',VIEWER_SNOWLIFT_STRING:'snowlift',VIEWER_VAULTBOX_STRING:'vaultbox',BULK_EDITOR:3,FLASH_UPLOADER:4,HTML5_UPLOADER:10,SIZE_NORMAL:'n',PIC_NORMAL_FBX_SIZE:180};e.exports=g;},null);
__d("PhotosUtils",["copyProperties","Vector"],function(a,b,c,d,e,f,g,h){function i(){}g(i,{getNearestBox:function(j,k){var l=Infinity,m=null;for(var n in j){var o=j[n];if(o.contains(k)){var p=k.distanceTo(o.getCenter());if(p<l){l=p;m=n;}}}return m;},absoluteToNormalizedPosition:function(j,k){var l=h.getElementPosition(j),m=h.getElementDimensions(j),n=k.sub(l).mul(100/m.x,100/m.y);n.domain='pure';return n;},normalizedToAbsolutePosition:function(j,k){var l=h.getElementPosition(j),m=h.getElementDimensions(j),n=k.mul(m.x/100,m.y/100).add(l);n.domain='document';return n;},isFacebox:function(j){return j.match(/^face:/);},isTag:function(j){return j.match(/^tag:/);}});e.exports=i;},null);
__d("ProfilePicRequestCreator",["Form","copyProperties"],function(a,b,c,d,e,f,g,h){function i(j,k,l,m){"use strict";this._fbid=j;this._owner=k;this._profileID=l;this._area=m;}i.prototype.setSuccessURI=function(j){"use strict";this._successURI=j;return this;};i.prototype.setErrorURI=function(j){"use strict";this._errorURI=j;return this;};i.prototype.setIsUnscaled=function(j){"use strict";this._isUnscaled=j;return this;};i.prototype.setProfilePhotoSource=function(j){"use strict";this._source=j;return this;};i.prototype.setProfilePhotoMethod=function(j){"use strict";this._method=j;return this;};i.prototype.send=function(){"use strict";var j=h({fbid:this._fbid,owner:this._owner,id:this._profileID,'return':this._successURI,error_return:this._errorURI,is_unscaled:this._isUnscaled,source:this._source||'photo_view',method:this._method},this._area);g.post('/crop_profile_pic.php',j);};e.exports=i;},null);
__d("PhotocropConstraintConstants",[],function(a,b,c,d,e,f){var g={BOUNDARY:'boundary',SQUARE:'square',WIDE:'wide'};g.getAspectRatioForType=function(h){switch(h){case g.SQUARE:return 1;case g.WIDE:return 16/9;default:return null;}};e.exports=g;},null);
__d("PhotocropConstraint",["Vector","PhotocropConstraintConstants","clamp"],function(a,b,c,d,e,f,g,h,i){function j(p){"use strict";this.photocrop=p;this.pos=null;}j.prototype.onMouseMove=function(p,q,r){"use strict";var s=p.sub(this.pos);if(q){this.onResize(s,r);}else this.onMove(s);this.pos=this.pos.add(s);};j.prototype.onMouseDown=function(p){"use strict";this.pos=p;};j.prototype.onResize=function(p,q){"use strict";};j.prototype.onMove=function(p){"use strict";var q=this.photocrop.box,r=this.photocrop.wrapper.offsetWidth,s=this.photocrop.wrapper.offsetHeight;p.x=i(-q.l,p.x,r-q.r);p.y=i(-q.t,p.y,s-q.b);this.photocrop.box=q.add(p);};for(var k in j)if(j.hasOwnProperty(k))m[k]=j[k];var l=j===null?null:j.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=j;function m(){"use strict";if(j!==null)j.apply(this,arguments);}m.prototype.onResize=function(p,q){"use strict";var r=this.photocrop.min_width,s=this.photocrop.min_height,t=this.photocrop.box,u=this.photocrop.wrapper.offsetWidth,v=this.photocrop.wrapper.offsetHeight;switch(q){case 'ne':t.r+=p.x=i(t.l+r-t.r,p.x,u-t.r);t.t+=p.y=i(-t.t,p.y,t.b-s-t.t);break;case 'nw':t.l+=p.x=i(-t.l,p.x,t.r-r-t.l);t.t+=p.y=i(-t.t,p.y,t.b-s-t.t);break;case 'se':t.r+=p.x=i(t.l+r-t.r,p.x,u-t.r);t.b+=p.y=i(t.t+s-t.b,p.y,v-t.b);break;case 'sw':t.l+=p.x=i(-t.l,p.x,t.r-r-t.l);t.b+=p.y=i(t.t+s-t.b,p.y,v-t.b);break;}};for(k in j)if(j.hasOwnProperty(k))n[k]=j[k];n.prototype=Object.create(l);n.prototype.constructor=n;n.__superConstructor__=j;function n(){"use strict";if(j!==null)j.apply(this,arguments);}n.prototype.setRatio=function(p){"use strict";this.ratio=p;return this;};n.prototype.onMouseDown=function(p){"use strict";l.onMouseDown.call(this,p);var q=this.photocrop.box,r=q.r-q.l,s=q.b-q.t;this.displacement=new g(r,s);};n.prototype.$AspectRatioConstraint0=function(p,q,r,s,t,u){"use strict";var v,w,x,y,z;v=this.displacement.x/this.displacement.y;w=y=i(p,q,r);x=z=i(s,t,u);if(v>this.ratio){x=i(s,w/this.ratio,u);w=x*this.ratio;}else{w=i(p,x*this.ratio,r);x=w/this.ratio;}return new g(w,x);};n.prototype.onResize=function(p,q){"use strict";var r=this.photocrop.min_width,s=this.photocrop.min_height,t=this.photocrop.box,u=this.photocrop.wrapper.offsetWidth,v=this.photocrop.wrapper.offsetHeight,w;switch(q){case 'ne':this.displacement=this.displacement.add(p.x,-p.y);w=this.$AspectRatioConstraint0(r,this.displacement.x,u-t.l,s,this.displacement.y,t.b);t.r=t.l+w.x;t.t=t.b-w.y;break;case 'nw':this.displacement=this.displacement.add(-p.x,-p.y);w=this.$AspectRatioConstraint0(r,this.displacement.x,t.r,s,this.displacement.y,t.b);t.l=t.r-w.x;t.t=t.b-w.y;break;case 'se':this.displacement=this.displacement.add(p.x,p.y);w=this.$AspectRatioConstraint0(r,this.displacement.x,u-t.l,s,this.displacement.y,v-t.t);t.r=t.l+w.x;t.b=t.t+w.y;break;case 'sw':this.displacement=this.displacement.add(-p.x,p.y);w=this.$AspectRatioConstraint0(r,this.displacement.x,t.r,s,this.displacement.y,v-t.t);t.l=t.r-w.x;t.b=t.t+w.y;break;}};function o(p,q){var r;switch(q){case h.BOUNDARY:r=new m(p);break;case h.WIDE:case h.SQUARE:r=new n(p).setRatio(h.getAspectRatioForType(q));break;default:throw Error('unsupported PhotocropConstraint type');}return r;}e.exports=o;},null);
__d("Photocrop2",["ArbiterMixin","PhotocropConstraintConstants","CSS","DOM","Event","PhotosConst","Rect","Style","Vector","copyProperties","mixin","PhotocropConstraint"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=q(g);for(var t in s)if(s.hasOwnProperty(t))v[t]=s[t];var u=s===null?null:s.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=s;function v(w,x,y){"use strict";this.photo=w;var z=this.getPhotoDimensions();if(y){this.imageDimensions=new o(y.x,y.y);}else this.imageDimensions=new o(z.x,z.y);x.height=x.height||l.PIC_NORMAL_FBX_SIZE;x.width=x.width||l.PIC_NORMAL_FBX_SIZE;p(this,{target:this.photo.parentNode,create_target:false,target_parent:this.photo.parentNode,min_width:l.PIC_NORMAL_FBX_SIZE,min_height:l.PIC_NORMAL_FBX_SIZE,center_x:(z.x||x.width)/2,center_y:(z.y||x.height)/2,constraint_type:h.BOUNDARY},x);this._unscaledMinHeight=this.min_height;this._unscaledMinWidth=this.min_width;this._unscaledHeight=this.height;this._unscaledWidth=this.width;this.setInitialDimensionsAndPos();if(this.create_target){this.target=j.create('div');i.addClass(this.target,'stageCropper');this.target_parent.appendChild(this.target);}i.addClass(this.target,'photocrop');['bg','wrapper','viewport'].forEach(function(aa){this[aa]=j.create('div');i.addClass(this[aa],aa);}.bind(this));this.highlight=j.create('img');i.addClass(this.highlight,'highlight');this.setHighlightSource();i.addClass(this.wrapper,'photocropWrapper');this.target.appendChild(this.bg);this.target.appendChild(this.wrapper);this.wrapper.appendChild(this.highlight);this.wrapper.appendChild(this.viewport);['ne','nw','sw','se'].forEach(function(aa){var ba=j.create('div');i.addClass(ba,aa);ba.setAttribute('data-cropcorner',aa);this.viewport.appendChild(ba);i.addClass(ba,'profilePicViewportGrabby');}.bind(this));k.listen(this.viewport,{mousedown:this.mousedown.bind(this),dragstart:k.kill,selectstart:k.kill,click:k.stop});k.listen(document,{mousemove:this.mousemove.bind(this),mouseup:this.mouseup.bind(this)});k.listen(window,{resize:this.adjustForResize.bind(this)});this.realignToPictureSize();this.redraw();}v.prototype.setInitialDimensionsAndPos=function(){"use strict";this._constraint=r(this,this.constraint_type);var w=h.getAspectRatioForType(this.constraint_type),x=this.getPhotoDimensions();if(w){this._unscaledMinHeight=this._unscaledMinWidth/w;this._unscaledHeight=this._unscaledWidth/w;}this.setNewRatio();var y=Math.min(this.width,x.x),z=Math.min(this.height,x.y);this.min_width=Math.min(this.min_width,x.x);this.min_height=Math.min(this.min_height,x.y);if(w)if(x.x/x.y>w){z=Math.min(z,x.y);y=z*w;this.min_width=this.min_height*w;}else{y=Math.min(y,x.x);z=y/w;this.min_height=this.min_width/w;}var aa=this.center_x-y/2,ba=this.center_y-z/2;this.box=new m(ba,aa+y,ba+z,aa);};v.prototype.getPhotoDimensions=function(){"use strict";return new o(Math.round(parseFloat(n.get(this.photo,'width'))),Math.round(parseFloat(n.get(this.photo,'height'))));};v.prototype.getPhotoPosition=function(){"use strict";return new o(this.photo.offsetLeft,this.photo.offsetTop);};v.prototype.setHighlightSource=function(){"use strict";this.highlight.src=this.photo.src;};v.prototype.setConstraintType=function(w){"use strict";this.constraint_type=w;this.setInitialDimensionsAndPos();this.adjustForResize();};v.prototype.adjustForResize=function(){"use strict";var w=this.ratio,x=this.setNewRatio(),y=x/w;this.box.t*=y;this.box.l*=y;this.box.b*=y;this.box.r*=y;this.redraw();this.realignToPictureSize();};v.prototype.setNewRatio=function(){"use strict";this.ratio=this.getPhotoDimensions().x/this.imageDimensions.x;this.min_width=this.ratio*this._unscaledMinWidth;this.min_height=this.ratio*this._unscaledMinHeight;this.width=Math.max(1,this.ratio)*this._unscaledWidth;this.height=Math.max(1,this.ratio)*this._unscaledHeight;return this.ratio;};v.prototype.realignToPictureSize=function(){"use strict";var w=this.photo;if(!w)return;var x=this.getPhotoDimensions(),y=this.getPhotoPosition();[this.bg,this.wrapper].forEach(function(z){z.style.width=x.x+'px';z.style.height=x.y+'px';z.style.top=y.y+'px';z.style.left=y.x+'px';});};v.prototype.redraw=function(){"use strict";var w=[this.box.t,this.box.r,this.box.b,this.box.l],x=this.getPhotoDimensions();this.highlight.style.width=x.x+"px";this.highlight.style.height=x.y+"px";this.highlight.style.clip="rect("+w.join("px ")+"px)";this.viewport.style.top=this.box.t+"px";this.viewport.style.left=this.box.l+"px";this.viewport.style.height=(this.box.b-this.box.t)+"px";this.viewport.style.width=(this.box.r-this.box.l)+"px";};v.prototype.done=function(w){"use strict";this.freezeViewport=true;if(!w){[this.bg,this.wrapper].forEach(j.remove);if(this.create_target){j.remove(this.target);this.target=null;}else i.removeClass(this.target,'photocrop');}var x=Math.round(this.box.l*(1/this.ratio)),y=Math.round(this.box.t*(1/this.ratio)),z=Math.round(this.box.r*(1/this.ratio)),aa=Math.round(this.box.b*(1/this.ratio));this.inform('done',w);return {x:Math.max(x,0),y:Math.max(y,0),width:z-Math.max(x,0),height:aa-Math.max(y,0)};};v.prototype.reset=function(){"use strict";this.freezeViewport=false;};v.prototype.mousedown=function(w){"use strict";if(this.freezeViewport)return;this.mouseTarget=w.getTarget();this._constraint.onMouseDown(o.getEventPosition(w));i.addClass(document.body,'draggingMode');return false;};v.prototype.mousemove=function(w){"use strict";if(!this.mouseTarget)return;this._constraint.onMouseMove(o.getEventPosition(w),this.mouseTarget!==this.viewport,this.mouseTarget.getAttribute('data-cropcorner'));this.redraw();return false;};v.prototype.mouseup=function(w){"use strict";this.mouseTarget=null;i.removeClass(document.body,'draggingMode');};e.exports=v;},null);
__d("ZoomCropDimensions",["BasicVector"],function(a,b,c,d,e,f,g){var h=320,i=.5,j=.5,k=180;l.prototype.clone=function(){"use strict";return new l(this.$ZoomCropDimensions0).setSize(this.$ZoomCropDimensions1.x,this.$ZoomCropDimensions1.y).setSmallestSize(this.$ZoomCropDimensions2.x,this.$ZoomCropDimensions2.y).setCenter(this.$ZoomCropDimensions3.x,this.$ZoomCropDimensions3.y).setZoom(this.$ZoomCropDimensions4);};function l(m){"use strict";this.$ZoomCropDimensions0=m;this.setSmallestSize(k,k).setCenter(i,i);this.setSize(h,h).setZoom(j);}l.prototype.getArea=function(){"use strict";var m=this.getPosition(),n=this.$ZoomCropDimensions1.div(this.$ZoomCropDimensions4);return {height:Math.round(n.y),width:Math.round(n.x),x:Math.round(Math.abs(m.left)/this.$ZoomCropDimensions4),y:Math.round(Math.abs(m.top)/this.$ZoomCropDimensions4)};};l.prototype.getPosition=function(){"use strict";var m=this.$ZoomCropDimensions5();return {height:m.imageSize.y,left:this.$ZoomCropDimensions1.x/2-m.center.x,top:this.$ZoomCropDimensions1.y/2-m.center.y,width:m.imageSize.x};};l.prototype.getRect=function(){"use strict";var m=this.$ZoomCropDimensions5(),n=this.$ZoomCropDimensions1.div(this.$ZoomCropDimensions4);return {center:{x:m.center.x/m.imageSize.x,y:m.center.y/m.imageSize.y},size:{x:n.x,y:n.y}};};l.prototype.getSize=function(){"use strict";return this.$ZoomCropDimensions1;};l.prototype.getZoom=function(){"use strict";return this.$ZoomCropDimensions4;};l.prototype.getZoomRange=function(){"use strict";var m=Math.min(this.$ZoomCropDimensions0.x,this.$ZoomCropDimensions0.y);return {max:this.$ZoomCropDimensions1.x/Math.min(this.$ZoomCropDimensions2.x,m),min:this.$ZoomCropDimensions1.x/m};};l.prototype.moveByPixels=function(m,n){"use strict";var o=this.$ZoomCropDimensions5();return this.moveBy(m/o.imageSize.x,n/o.imageSize.y);};l.prototype.moveBy=function(m,n){"use strict";return this.setCenter(this.$ZoomCropDimensions3.x+m,this.$ZoomCropDimensions3.y+n);};l.prototype.setCenter=function(m,n){"use strict";this.$ZoomCropDimensions3=new g(Math.min(Math.max(m,0),1),Math.min(Math.max(n,0),1));return this;};l.prototype.setSize=function(m,n){"use strict";this.$ZoomCropDimensions1=new g(m,n);return this;};l.prototype.setSmallestSize=function(m,n){"use strict";this.$ZoomCropDimensions2=new g(m,n);return this;};l.prototype.setZoom=function(m){"use strict";var n=this.getZoomRange();this.$ZoomCropDimensions4=Math.max(Math.min(m,n.max),n.min);return this;};l.prototype.$ZoomCropDimensions6=function(m,n){"use strict";var o=this.$ZoomCropDimensions1.x/2,p=this.$ZoomCropDimensions1.y/2;return new g(Math.max(Math.min(n.x,m.x-o),o),Math.max(Math.min(n.y,m.y-p),p));};l.prototype.$ZoomCropDimensions5=function(){"use strict";var m=this.$ZoomCropDimensions0.mul(this.$ZoomCropDimensions4);return {imageSize:m,center:this.$ZoomCropDimensions6(m,this.$ZoomCropDimensions3.mul(m.x,m.y))};};e.exports=l;},null);
__d("ZoomCropImagePreview.react",["React","cx"],function(a,b,c,d,e,f,g,h){var i=g.createClass({displayName:'ZoomCropImagePreview',propTypes:{dimensions:g.PropTypes.object,size:g.PropTypes.object,src:g.PropTypes.string},render:function(){var j=this.props.dimensions,k=this.props.size,l=j.getSize().x/k.x;if(l!==1)j=j.clone().setSize(k.x,k.y).setZoom(j.getZoom()/l);return this.transferPropsTo(g.DOM.div({className:"_1k3v",style:{height:k.y,width:k.x}},g.DOM.img({className:"_1k3w",src:this.props.src,style:j.getPosition()})));}});e.exports=i;},null);
__d("ZoomCropImage.react",["Event","React","UserAgent","Vector","Image.react","ZoomCropImagePreview.react","cx","ix","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=h.createClass({displayName:'ZoomCropImage',propTypes:{dimensions:h.PropTypes.object,src:h.PropTypes.string},getInitialState:function(){return {moved:false};},componentDidMount:function(){var q=i.ie()<9?document.documentElement:window;this._listeners=g.listen(q,{mousemove:this._handleMouseMove.bind(this),mouseup:this._handleMouseUp.bind(this)});},componentWillUnmount:function(){for(var q in this._listeners){this._listeners[q]&&this._listeners[q].remove();this._listeners[q]=null;}},render:function(){var q=this.props.dimensions,r=q.getSize();return this.transferPropsTo(h.DOM.div({className:"_4on5",style:{height:r.y,width:r.x}},l({dimensions:q,size:r,src:this.props.src}),h.DOM.img({className:"_4on7",onDragStart:g.prevent,onMouseDown:this._handleMouseDown,src:this.props.src,style:q.getPosition()}),h.DOM.div({className:(("_3dfy")+(this.state.moved?' '+"_3dfz":''))},h.DOM.span({className:"_3df-"},k({className:"_3-8_ _3df_",src:n('/images/ads/cropper/drag.png')}),"Drag to reposition photo"))));},_handleMouseDown:function(q){if(this._position)return;q.preventDefault();this._position=j.getEventPosition(q);},_handleMouseMove:function(q){if(!this._position)return;var r=j.getEventPosition(q),s=this._position.sub(r);this.props.onMove(s.x,s.y);this.setState({moved:true});this._position=r;},_handleMouseUp:function(){this._position=null;}});e.exports=p;},null);
__d("ZoomCropSlider.react",["React","AbstractRangeInput.react","cx"],function(a,b,c,d,e,f,g,h,i){var j=g.createClass({displayName:'ZoomCropSlider',propTypes:{onZoom:g.PropTypes.func,zoom:g.PropTypes.number,zoomRange:g.PropTypes.object},render:function(){return this.transferPropsTo(g.DOM.div({className:"_55vh"},g.DOM.div({className:"_55vi"},"âˆ’"),h({className:"_55vj",disabled:this.props.zoomRange.max===this.props.zoomRange.min,max:this.props.zoomRange.max,min:this.props.zoomRange.min,onChange:this.props.onZoom,values:[this.props.zoom]}),g.DOM.div({className:"_55vk"},"+")));}});e.exports=j;},null);
__d("ZoomCrop.react",["React","ZoomCropDimensions","Image.react","ZoomCropImage.react","ZoomCropImagePreview.react","ZoomCropSlider.react","cx","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=g.createClass({displayName:'ZoomCrop',propTypes:{center:g.PropTypes.object,cropSizeRatio:g.PropTypes.object,imageSize:g.PropTypes.object,previewSize:g.PropTypes.number,src:g.PropTypes.string,warningText:g.PropTypes.string},getDefaultProps:function(){return {previewSize:32};},getInitialState:function(){this._dims=new h(this.props.imageSize);if(this.props.center)this._dims.setCenter(this.props.center.x,this.props.center.y);if(this.props.cropSizeRatio){var p=this.props.cropSizeRatio.x*this.props.imageSize.x;this._dims.setZoom(this._dims.getSize().x/p);}return this._getDimensionsState();},render:function(){var p;if(this.state.zoom>1)p=g.DOM.div({className:"_3p9d"},i({className:"_3-8_ _3p9e",src:n('/images/mobile/glyph/error-solid_white_s.png')}),this.props.warningText);return (g.DOM.div({className:"_4liw"},j({className:"_1szc",dimensions:this._dims,onMove:this._handleMove,src:this.props.src}),k({className:"_1szd",dimensions:this._dims,size:{x:this.props.previewSize,y:this.props.previewSize},src:this.props.src}),l({className:"_4lix",onZoom:this._handleZoom,zoom:this.state.zoom,zoomRange:this._dims.getZoomRange()}),p));},getDimensions:function(){return this._dims;},_handleZoom:function(p){this._dims.setZoom(p[0]);this.setState(this._getDimensionsState());},_handleMove:function(p,q){this._dims.moveByPixels(p,q);this.setState(this._getDimensionsState());},_getDimensionsState:function(){return {dimensions:this._dims.getPosition(),zoom:this._dims.getZoom()};}});e.exports=o;},null);
__d("PhotoPermalinkURI",[],function(a,b,c,d,e,f){var g={isValid:function(h){return g.parse(h)!==null;},parse:function(h){if(this.isValidLegacy(h)){var i=h.getQueryData();if(i.fbid)return {photo_id:i.fbid,set_token:i.set};if(i.id&&i.pid)return {photo_id:i.id+':'+i.pid,set_token:i.set};return null;}var j=h.getPath();if(j[j.length-1]==='/')j=j.substring(0,j.length-1);var k=j.split('/');if(k.length>=3&&k[2]==='photos')if(k.length===4&&/^\d+$/.exec(k[3])!==null){return {photo_id:k[3],set_token:null};}else if(k.length===5&&/^\d+$/.exec(k[4])!==null)return {photo_id:k[4],set_token:k[3]};return null;},isValidLegacy:function(h){var i=h.getPath();if(i[i.length-1]==='/')i=i.substring(0,i.length-1);if(i==='/photo.php'||i==='/force_photo/photo.php'||i==='/photo'||i==='/force_photo/photo/index.php'||i==='/photo/index.php'||i==='/force_photo/photo')return true;return false;}};e.exports=g;},null);
__d("PhotoStreamCache",["DOM","HTML","PhotoEverstoreLogger","PhotosConst","PhotoViewerImage","Rect","UIPagelet","URI","Vector","copyProperties","createArrayFrom","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(){"use strict";}s.prototype.init=function(t,u,v,w){"use strict";this.version=t;this.pageletName=u;this.pageletRootID=v;this.bufferSize=s.BUFFER_SIZE;this.fullBucketSize=s.FULL_BUCKET_SIZE;this.initError=false;this.isActive=true;this.usesOpaqueCursor=false;this.usesNonCircularPhotoSet=false;this.reachedLeftEnd=false;this.reachedRightEnd=false;this.leftLock=false;this.rightLock=false;this.useAjaxPipe=true;this.logger=w;this.viewAsUser=null;this.reset();};s.prototype.setViewAs=function(t){"use strict";this.viewAsUser=t;};s.prototype.isInViewAsMode=function(){"use strict";return !!this.viewAsUser;};s.prototype.getViewAsUserId=function(){"use strict";return this.viewAsUser;};s.prototype.getUsesOpaqueCursor=function(){"use strict";return this.usesOpaqueCursor;};s.prototype.isNonCircularPhotoSet=function(){"use strict";return this.usesNonCircularPhotoSet;};s.prototype.setReachedLeftEnd=function(){"use strict";this.reachedLeftEnd=true;};s.prototype.setReachedRightEnd=function(){"use strict";this.reachedRightEnd=true;};s.prototype.hasReachedLeftEnd=function(){"use strict";return this.reachedLeftEnd;};s.prototype.hasReachedRightEnd=function(){"use strict";return this.reachedRightEnd;};s.prototype.nonCircularPhotoSetCanPage=function(t){"use strict";if(!this.isNonCircularPhotoSet())return true;if(t<0)return this.getCursorPos()||!this.hasReachedLeftEnd();if(t>0)return (this.getLength()-1!=this.getCursorPos())||!this.hasReachedRightEnd();return true;};s.prototype.setUseAjaxPipe=function(t){"use strict";this.useAjaxPipe=t;};s.prototype.reset=function(){"use strict";this.cache={image:{},extra:{},html:{}};this.fbidList=[];this.loaded=false;this.allLoaded=false;this.permalinkMap={};this.position=0;this.totalCount=null;this.firstCursor=null;this.firstCursorIndex=null;this.firstOpaqueCursor=null;};s.prototype.waitForInitData=function(){"use strict";this.fbidList.push(s.INIT_PLACEHOLDER);};s.prototype.destroy=function(){"use strict";this.reset();this.isActive=false;};s.prototype.isLoaded=function(){"use strict";return this.loaded;};s.prototype.canPage=function(){"use strict";if(!this.isLoaded())return false;if(this.totalCount!==null)return this.totalCount>1;if(this.usesNonCircularPhotoSet)return true;return this.getLength()>1;};s.prototype.errorInCurrent=function(){"use strict";if(this.initError){return true;}else if(!this.isLoaded())return false;return this.checkErrorAt(this.getCursor());};s.prototype.getLength=function(){"use strict";return this.fbidList.length;};s.prototype.getPhotoSet=function(){"use strict";return this.photoSetQuery.set;};s.prototype.getPhotoSetQuery=function(){"use strict";return this.photoSetQuery;};s.prototype.getCurrentImageData=function(){"use strict";return this.getImageData(this.getCursor());};s.prototype.addViewAsToURI=function(t){"use strict";var u=n(t);if(this.isInViewAsMode())u.addQueryData({viewas:this.getViewAsUserId()});return u;};s.prototype.getOpaqueCursor=function(t){"use strict";if(this.getImageData(t)){if(this.version===j.VIEWER_VAULTBOX)return this.getImageData(t).getInfo().opaquecursor;return this.getImageData(t).info.opaquecursor;}if(t==this.firstCursor)return this.firstOpaqueCursor;return null;};s.prototype.getImageData=function(t){"use strict";var u=this.getCacheContent(t,s.IMAGE_DATA);if(u)u.info.permalink=this.addViewAsToURI(u.info.permalink);return u;};s.prototype.getCurrentHtml=function(){"use strict";return this.getCacheContent(this.getCursor(),s.HTML);};s.prototype.getCurrentExtraData=function(){"use strict";return this.getCacheContent(this.getCursor(),s.EXTRA);};s.prototype.getCacheContent=function(t,u){"use strict";if(!t||t===s.ERROR_ID||t===s.INIT_PLACEHOLDER)return null;return this.cache[u][t];};s.prototype.getCursorPos=function(){"use strict";return this.position;};s.prototype.getCursor=function(){"use strict";if(this.position>=0&&this.position<this.getLength())return this.fbidList[this.position];return null;};s.prototype.getCursorForURI=function(t){"use strict";return this.permalinkMap[t];};s.prototype.calculatePositionForMovement=function(t){"use strict";var u=this.position+t;if(this.allLoaded){var v=this.getLength();u=(v+u%v)%v;}return u;};s.prototype.isValidMovement=function(t){"use strict";if(!this.isLoaded()||!this.canPage())return false;var u=this.calculatePositionForMovement(t);return this.getCursor()>0||(u>=0&&u<this.getLength());};s.prototype.moveCursor=function(t){"use strict";if(!this.isValidMovement(t))return;this.position=this.calculatePositionForMovement(t);if(t!==0)this.loadMoreIfNeccessary(t>0);};s.prototype.checkErrorAt=function(t){"use strict";if(!this.isLoaded())return false;if(t===s.ERROR_ID)return true;return false;};s.prototype.getRelativeMovement=function(t){"use strict";for(var u=0;u<this.getLength();u++)if(this.fbidList[u]==t)return u-this.position;return null;};s.prototype.preloadImages=function(t){"use strict";var u,v,w=this.getLength(),x=this.cache.image,y=s.BUFFER_SIZE;if(w>y*2){u=(this.position+w-y%w)%w;v=(this.position+y)%w;}else{u=0;v=w-1;}while(u!=v){var z,aa=this.fbidList[u],ba=t&&t(x[aa]);if(this.version===j.VIEWER_VAULTBOX){z=x[aa]&&x[aa].preload(ba);}else if(x[aa]&&x[aa].url)if(ba&&!x[aa].resource){x[aa].resource=new Image();x[aa].resource.src=x[aa].url;z=x[aa].url;if(x[aa].everstoreLogThis===true)i.logImmediately(x[aa].resource.src);}else if(!ba&&!x[aa].small){x[aa].small=new Image();x[aa].small.src=x[aa].smallurl||x[aa].url;z=x[aa].small.src;if(x[aa].everstoreLogThis===true)i.logImmediately(x[aa].small.src);}if(this.logger&&z)this.logger.log(z);u=(u+1)%w;}};s.prototype.loadMoreIfNeccessary=function(t){"use strict";if(this.allLoaded||(t&&this.rightLock)||(!t&&this.leftLock))return;var u=t?1:-1,v=this.position+this.bufferSize*u;if(v<0&&!this.checkErrorAt(this.getEndCursor(false))){this.leftLock=true;this.fetch(this.fullBucketSize,false);}else if(v>this.getLength()&&!this.checkErrorAt(this.getEndCursor(true))){this.rightLock=true;this.fetch(this.fullBucketSize,true);}};s.prototype.getEndCursor=function(t){"use strict";return t?this.fbidList[this.getLength()-1]:this.fbidList[0];};s.prototype.calculateRelativeIndex=function(t,u,v){"use strict";if(!this.totalCount)return null;var w=this.fbidList.indexOf(u),x=this.fbidList.indexOf(v);if(w===-1||x===-1)return null;var y=x-w;return (t+y+this.totalCount)%this.totalCount;};s.prototype.calculateDistance=function(t,u){"use strict";var v=this.fbidList.indexOf(t),w=this.fbidList.indexOf(u);if(v===-1||w===-1)return null;return (w-v+this.getLength())%this.getLength();};s.prototype.fetch=function(t,u){"use strict";var v=this.getEndCursor(u),w=p({cursor:v,version:this.version,end:this.getEndCursor(!u),fetchSize:u?t:-1*t,relevant_count:this.relevantCount,opaqueCursor:this.getOpaqueCursor(v)},this.photoSetQuery);if(this.isInViewAsMode())w.viewas=this.getViewAsUserId();if(this.totalCount&&this.firstCursorIndex!==null){w.total=this.totalCount;w.cursorIndex=this.calculateRelativeIndex(this.firstCursorIndex,this.firstCursor,v);}var x=r(this.pageletRootID);if(!x){x=g.create('div',{id:this.pageletRootID});g.appendContent(document.body,x);}m.loadFromEndpoint(this.pageletName,x,w,{usePipe:this.useAjaxPipe,automatic:true,jsNonblock:true,crossPage:true});if(!this.useAjaxPipe)this.setUseAjaxPipe(true);};s.prototype.storeToCache=function(t){"use strict";var u={};if(!this.isActive)return u;if('error' in t){this.processErrorResult(t.error);u.error=true;return u;}if('init' in t){this.processInitResult(t.init);u.init={logids:t.init.logids,fbid:t.init.fbid,loggedin:t.init.loggedin,fromad:t.init.fromad};}if('image' in t){this.processImageResult(t.image);u.image=true;}if('data' in t){this.processDataResult(t.data);u.data=true;}return u;};s.prototype.processInitResult=function(t){"use strict";if(this.loaded)return;this.usesOpaqueCursor=t.usesopaquecursor;this.usesNonCircularPhotoSet=t.isnoncircularphotoset;this.loaded=true;this.photoSetQuery=t.query;if(t.bufferSize)this.bufferSize=t.bufferSize;if(t.fullBucketSize)this.fullBucketSize=t.fullBucketSize;if(this.fbidList.length===0){this.fbidList.push(t.fbid);this.rightLock=true;}else{var u=this.fbidList.indexOf(s.INIT_PLACEHOLDER);if(u!=-1)this.fbidList[u]=t.fbid;}this.firstCursor=t.fbid;this.firstOpaqueCursor=t.opaquecursor;if('initIndex' in t&&'totalCount' in t){this.firstCursorIndex=t.initIndex;this.totalCount=t.totalCount;}if(this.version==j.VIEWER_PERMALINK)this.fetch(s.INIT_BUCKET_SIZE,true);};s.prototype.processImageResult=function(t){"use strict";for(var u in t){if(u===this.firstCursor&&t[u].everstoreLogThis)i.logImmediately(t[u].url);if(this.version===j.VIEWER_VAULTBOX){var v=t[u];this.cache.image[u]=new k(v);this.permalinkMap[this.cache.image[u].getURIString()]=u;}else{this.cache.image[u]=t[u];if(t[u].dimensions)this.cache.image[u].dimensions=o.deserialize(t[u].dimensions);if(t[u].originalDimensions)this.cache.image[u].originalDimensions=o.deserialize(t[u].originalDimensions);if(t[u].smalldims)this.cache.image[u].smalldims=o.deserialize(t[u].smalldims);this.permalinkMap[n(t[u].info.permalink).getUnqualifiedURI().toString()]=u;}}};s.prototype.attachToFbidsList=function(t,u,v){"use strict";if(this.allLoaded)return;if(u===-1){for(var w=t.length-1;w>=0;w--){this.fbidList.unshift(t[w]);this.position++;}this.leftLock=false;}else{for(var x=0;x<t.length;x++)this.fbidList.push(t[x]);this.rightLock=false;}if(v)this.setAllLoaded();};s.prototype.setAllLoaded=function(){"use strict";this.allLoaded=true;if(this.getCursor()===null)this.position=this.calculatePositionForMovement(0);};s.prototype.processDataResult=function(t){"use strict";for(var u in t){if(!this.cache.html[u])this.cache.html[u]={};for(var v in t[u].html){var w=t[u].html[v];if(typeof w==='string')w=h(w).getRootNode();this.cache.html[u][v]=q(w.childNodes);}if(!('extra' in t[u])){this.cache.extra[u]=null;continue;}this.cache.extra[u]={tagRects:{}};if(!Array.isArray(t[u].extra.tagRects))for(var x in t[u].extra.tagRects)if(t[u].extra.tagRects[x])this.cache.extra[u].tagRects[x]=l.deserialize(t[u].extra.tagRects[x]);Object.keys(t[u].extra).forEach(function(y){if(y=='tagRects')return;this.cache.extra[u][y]=t[u].extra[y];}.bind(this));}};s.prototype.processErrorResult=function(t){"use strict";if(!this.isLoaded()){this.initError=true;return;}var u=t.side,v=[s.ERROR_ID];this.attachToFbidsList(v,u);};s.prototype.setTotalCount=function(t){"use strict";this.totalCount=t;};s.prototype.setFirstCursorIndex=function(t){"use strict";this.firstCursorIndex=t;};p(s,{ERROR:'error',HTML:'html',IMAGE_DATA:'image',EXTRA:'extra',BUFFER_SIZE:3,INIT_BUCKET_SIZE:4,FULL_BUCKET_SIZE:12,ERROR_ID:-1,INIT_PLACEHOLDER:1});e.exports=s;},null);
__d("AssertionError",["ManagedError"],function(a,b,c,d,e,f,g){function h(i){g.prototype.constructor.apply(this,arguments);}h.prototype=new g();h.prototype.constructor=h;e.exports=h;},null);
__d("Assert",["AssertionError","sprintf"],function(a,b,c,d,e,f,g,h){function i(n,o){if(typeof n!=='boolean'||!n)throw new g(o);return n;}function j(n,o,p){var q;if(o===undefined){q='undefined';}else if(o===null){q='null';}else{var r=Object.prototype.toString.call(o);q=/\s(\w*)/.exec(r)[1].toLowerCase();}i(n.indexOf(q)!==-1,p||h('Expression is of type %s, not %s',q,n));return o;}function k(n,o,p){i(o instanceof n,p||'Expression not instance of type');return o;}function l(n,o){m['is'+n]=o;m['maybe'+n]=function(p,q){if(p!=null)o(p,q);};}var m={isInstanceOf:k,isTrue:i,isTruthy:function(n,o){return i(!!n,o);},type:j,define:function(n,o){n=n.substring(0,1).toUpperCase()+n.substring(1).toLowerCase();l(n,function(p,q){i(o(p),q);});}};['Array','Boolean','Date','Function','Null','Number','Object','Regexp','String','Undefined'].forEach(function(n){l(n,j.bind(null,n.toLowerCase()));});e.exports=m;},null);
__d("PhotoSnowliftAds",["Arbiter","Event","copyProperties","CSS","csx","DataStore","DOM","PhotoSessionLog","UIPagelet","URI","Vector","extendArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s={REFRESH_RATE:30000,UNITS_REGISTER_DELAY:1000,root:null,availableDimensions:null,loadQuery:null,lastLoadTime:0,minAds:100,units:null,isLogAdData:null,displayedCallback:null,position:null,adsStatus:'null',adsEvents:{},resetEvents:function(){this.adsStatus='reset';this.adsEvents={};},addEvent:function(t,u){if(u)this.adsStatus=t;var v=Date.now();this.adsEvents[t+'_'+v]=v;},init:function(t,u,v,w){this.reset();this.root=t;this.snowlift=u;this.minAds=v.min_ads;this.displayedCallback=w;this.addEvent('init',true);},reset:function(){this.lastLoadTime=0;this.position=0;this.units=[];this.resetEvents();this.addEvent('reset',true);},resize:function(t){this.availableDimensions=t;this.loadQuery=this.snowlift.getLoadQuery();this.processResize();},calculateUnitSizes:function(t,u,v){var w={};t.forEach(function(x){var y=x.root.firstChild.offsetHeight;x.units.forEach(function(aa){if(!j.hasClass(aa,'hidden')&&!this.getIsHoldout(aa)&&!this.getIsShadow(aa)){var ba=this.getHeight(aa.firstChild,u);y-=ba;}}.bind(this));var z={height:y,visible:false};x.units.forEach(function(aa){var ba=this.getIsAds(aa),ca=this.getHeight(aa.firstChild,u),da=this.getUnitId(aa),ea=this.getIsHoldout(aa);if(ea&&v)return;w[da]={height:ca,visible:false,priority:0,is_ads:ba,is_holdout:ea,section_ref:z};}.bind(this));}.bind(this));return w;},calculateVisibleUnits:function(t,u,v){var w=0,x=this.getUnitPriority(u);x.forEach(function(y){if(u.hasOwnProperty(y)){var z=u[y],aa=z.height;if(!z.section_ref.visible)aa+=z.section_ref.height;z.height_below=v-aa;z.visible=z.height_below>=0&&aa>0;if(z.visible){z.section_ref.visible=true;v-=aa;w++;}}}.bind(this));return u;},displayUnits:function(t,u){t.forEach(function(v){var w=false,x=true;v.units.forEach(function(y){var z=this.getUnitId(y),aa=u[z];if(!aa)return;var ba=aa.visible,ca=aa.height_below,da=aa.is_ads;j.conditionClass(y,'hidden',!ba);if(da&&ba&&x){var ea=m.find(y,'div.ego_unit');j.addClass(ea,'ego_unit_no_top_border');x=false;}w=w||ba;this.calcUnitStats(this.units[da][z],ba,ca);}.bind(this));j.conditionClass(v.root,'hidden',!w);}.bind(this));g.inform('PhotoSnowliftAds/displayUnits');},getUnitsDisplayed:function(t,u){var v=0;t.forEach(function(w){w.units.forEach(function(x){var y=this.getUnitId(x),z=u[y];if(!z||!z.visible)return;v++;}.bind(this));}.bind(this));return v;},getHeightsRequired:function(t,u){var v=0,w=[];t.forEach(function(x){var y=false;x.units.forEach(function(z){var aa=this.getUnitId(z),ba=u[aa];if(!ba)return;v+=ba.height;if(!y){v+=ba.section_ref.height;y=true;}w.push(v);}.bind(this));}.bind(this));return w;},getUnitPriority:function(t){var u=[],v=0,w=0;for(var x in t){var y=t[x];u.push(x);var z=this.minAds+v+w;if(y.is_ads){if(w<this.minAds)z=w;w++;}else v++;y.priority=z;}u=u.sort(function(aa,ba){var ca=t[aa],da=t[ba];return ca.priority-da.priority;}.bind(this));return u;},updateUnitsStatus:function(){var t=this.availableDimensions.x,u=this.availableDimensions.y,v=this.calculateUnitSizes(this.sections,t);v=this.calculateVisibleUnits(this.sections,v,u);for(var w in v){if(!v.hasOwnProperty(w))continue;var x=v[w];if(!x.is_holdout||!x.visible)continue;var y=this.units[1][w];this.calcUnitStats(y,x.visible,x.height_below);}v=this.calculateUnitSizes(this.sections,t,true);v=this.calculateVisibleUnits(this.sections,v,u);this.displayUnits(this.sections,v);if(this.displayedCallback){var z=this.getUnitsDisplayed(this.sections,v),aa=this.getHeightsRequired(this.sections,v);this.displayedCallback(z,aa);}},calcUnitStats:function(t,u,v){var w=Date.now();if(t.visible)t.totalTime+=w-t.lastShowTime;if(t.trackingCode!==null&&t.totalTime>=this.UNITS_REGISTER_DELAY){var x=t.trackingCode;t.trackingCode=null;this.registerImpression(x,t.registerUrl);}t.visible=u;t.heightBelow=v;t.lastShowTime=w;},prepareResize:function(){var t=function(u){var v=m.create('div',{className:'inner'}),w=m.create('div',{className:'wrapper'},v);m.replace(u,w);m.setContent(v,u);return w;};this.sections=m.scry(this.root,'div.ego_section').map(function(u){return {root:t(u),units:m.scry(u,'div.ego_unit').map(t)};});},processResize:function(){if(this.isLoading||this.lastLoadTime===0||this.availableDimensions===null){this.setLogData();return;}this.updateUnitsStatus();this.setLogData();var t=this.nextRegisterTime();if(t!==Infinity)setTimeout(this.processResize.bind(this),t);},setIsLogAdData:function(t){this.isLogAdData=t;this.addEvent('setIsLogAdData',false);this.setLogData();},setLogData:function(){var t=this.snowlift.getImageId();if(this.isLogAdData&&t){var u=q.getElementDimensions(this.snowlift.getImage()),v=q.getElementDimensions(this.snowlift.getRHCHeader()),w=q.getElementDimensions(this.snowlift.getRHCBody()),x=q.getElementDimensions(this.snowlift.getRHCFooter()),y={query_set:this.snowlift.getLoadQuery().set,window_x:window.innerWidth,window_y:window.innerHeight,image_x:u.x,image_y:u.y,header_x:v.x,header_y:v.y,body_x:w.x,body_y:w.y,footer_x:x.x,footer_y:x.y,ads_below_space:this.getAdsBelowSpace(),time:Date.now(),adsStatus:this.adsStatus,adsEvents:this.adsEvents,refreshRate:this.refreshUnitsRate,position:this.position};n.updateAdData(t,y);}},getAdsBelowSpace:function(){var t=[],u=this.units[1];for(var v in u)if(u.hasOwnProperty(v)&&!this.getIsHoldout(this.getAdUnit(v)))t.push(u[v].heightBelow);return t;},getIsAds:function(t){var u=m.scry(t,"div._4u8");return u.length;},getUnitId:function(t){if(this.getIsAds(t)){return this.getAdId(t);}else return this.getEgoId(t);},getEgoId:function(t){var u=m.find(t,'div.ego_unit');return u.getAttribute('data-ego-fbid');},getAdData:function(t){var u=m.find(t,"div._4u8"),v=u.getAttribute('data-ad');return v&&JSON.parse(v)||{};},getAdId:function(t){return this.getAdData(t).adid;},getIsHoldout:function(t){return t&&this.getIsAds(t)&&this.getAdData(t).holdout;},getIsShadow:function(t){return t&&this.getIsAds(t)&&this.getAdData(t).shadow;},getAdUnit:function(t){if(!this.sections)return null;var u=[];this.sections.forEach(function(w){r(u,w.units);});for(var v=0;v<u.length;v++)if(this.getIsAds(u[v])&&this.getAdId(u[v])==t)return u[v];return null;},nextRegisterTime:function(){var t=Infinity,u=i(i({},this.units[0]),this.units[1]);for(var v in u)if(u.hasOwnProperty(v)){var w=u[v];if(w.trackingCode!==null&&w.visible)t=Math.min(t,this.UNITS_REGISTER_DELAY-w.totalTime);}return t;},getHeight:function(t,u){var v=l.get(t,'height');if(v&&v.x===u)return v.y;return this.cacheHeight(t,u);},cacheHeight:function(t,u){var v={x:u,y:t.offsetHeight};l.set(t,'height',v);return v.y;},loadAdsAndEgo:function(){this.resetEvents();this.addEvent('adsRequested',true);this.position++;var t=this.getCursorFBID(this.loadQuery);o.loadFromEndpoint('WebEgoPane',this.root,{pid:34,data:[this.loadQuery.set,t,false,this.snowlift.getOpaqueCursor(t)]},{crossPage:true,bundle:false});},getCursorFBID:function(t){if(t.v!==undefined)return t.v;if(t.fbid!==undefined)return t.fbid;return '0';},unitsLoaded:function(t,u){var v;if(u){v='/ai.php';this.addEvent('adsLoaded',true);}else{v='/ajax/ei.php';this.addEvent('egoLoaded',true);}var w={};for(var x in t)if(t.hasOwnProperty(x))w[x]={trackingCode:t[x],totalTime:0,lastShowTime:0,heightBelow:-10000,visible:false,registerUrl:v};this.units[u]=w;if(u)this.waitForImages(this.imagesLoaded.bind(this));},imagesLoaded:function(){this.prepareResize();this.addEvent('imagesLoaded',true);this.lastLoadTime=Date.now();this.isLoading=false;this.processResize();j.removeClass(this.root,'loading');},loadAdsFromUserActivity:function(){var t=Date.now()-this.lastLoadTime;if(!this.isLoading&&t>s.REFRESH_RATE){j.addClass(this.root,'loading');this.isLoading=true;this.loadAdsAndEgo();}},registerImpression:function(t,u){var v=m.create('iframe',{src:p(u).addQueryData({aed:t}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});v.setAttribute('aria-hidden','true');m.appendContent(this.root,v);},waitForImages:function(t){var u=m.scry(this.root,'img.img'),v=u.length,w=v;if(w===0)t();var x=function(){w--;if(w===0)setTimeout(t,0);};for(var y=0;y<v;y++){var z=u[y];if(z.complete){x();}else h.listen(z,{load:x,error:x,abort:x});}}};e.exports=s;},null);
__d("PhotoTagSearchPivotLogger",["Banzai"],function(a,b,c,d,e,f,g){var h={};g.subscribe(g.SHUTDOWN,function(){Object.keys(h).forEach(function(l){var m=h[l];Object.keys(m).forEach(function(n){g.post('photo_tag_search_pivot',{source:l,action:n,count:m[n]});});});});var i=/^(perm:)?tag:/,j,k={logImpression:function(l,m){var n=l in h?h[l]:(h[l]={});n[m]=m in n?n[m]+1:1;},logImageImpression:function(l,m,n){if(j!==m){if(n.some(function(o){return i.test(o);}))this.logImpression(l,'image_impression');j=m;}},logPivotImpression:function(l,m){if(i.test(m))this.logImpression(l,'pivot_impression');},logShowMorePhotos:function(){this.logImpression('photoset','show_more_photos');},logHideMorePhotos:function(){this.logImpression('photoset','hide_more_photos');},logSuggestMorePhotos:function(){this.logImpression('photoset','suggest_more_photos');},logMorePhotosNavigation:function(l){g.post('photo_tag_search_pivot',{source:'photoset',action:'more_photos_search',query:l,count:1});}};e.exports=k;},null);
__d("XPhotosetSearchPivotControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f,g){e.exports=g.create("\/search-pivot\/photoset\/",{fbid:{type:"Int",required:true},tags:{type:"IntToIntMap"}});},null);
__d("PhotoViewer",["Bootloader","CSS","DOM","copyProperties","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k){function l(){"use strict";this.image=null;this.root=null;this.stream=null;}l.prototype.getEventString=function(m){"use strict";var n=this.getEventPrefix();if(n)return n+'.'+m;return null;};l.prototype.getImage=function(){"use strict";return this.image;};l.prototype.getPosition=function(){"use strict";return this.stream?this.stream.getCursor():null;};l.prototype.getRoot=function(){"use strict";return this.root;};l.prototype.hiliteAllBoxes=function(){"use strict";i.scry(this.stageWrapper,'div.tagsWrapper div.faceBox').forEach(function(m){h.addClass(m,'otherActive');});};l.bootstrap=function(m,n){"use strict";g.loadModules(["PhotoSnowlift"],function(o){o.bootstrap(m,n);});};j(l.prototype,{getEventPrefix:k.thatReturnsNull,getSourceString:k.thatReturnsNull,getVersionConst:k.thatReturnsNull,getViewerSource:k.thatReturnsNull,getViewerSet:k.thatReturnsNull});e.exports=l;},null);
__d("VideoPlayerFlashApi",[],function(a,b,c,d,e,f){function g(i){return [].slice.call(i);}function h(i,j){"use strict";this.$VideoPlayerFlashApi0=i;this.$VideoPlayerFlashApi1=j;}h.prototype.getDOMElement=function(){"use strict";return this.$VideoPlayerFlashApi0;};h.prototype.pause=function(i){"use strict";this.$VideoPlayerFlashApi2(this.$VideoPlayerFlashApi0.pauseVideo,g(arguments));};h.prototype.play=function(i){"use strict";this.$VideoPlayerFlashApi2(this.$VideoPlayerFlashApi0.playVideo,g(arguments));};h.prototype.seek=function(i){"use strict";this.$VideoPlayerFlashApi2(this.$VideoPlayerFlashApi0.seekVideo,g(arguments));};h.prototype.setScriptPath=function(i){"use strict";this.$VideoPlayerFlashApi2(this.$VideoPlayerFlashApi0.setScriptPath,g(arguments));};h.prototype.setFTData=function(i){"use strict";this.$VideoPlayerFlashApi2(this.$VideoPlayerFlashApi0.setFTData,g(arguments));};h.prototype.switchVideo=function(i){"use strict";this.$VideoPlayerFlashApi2(this.$VideoPlayerFlashApi0.switchVideo,g(arguments));};h.prototype.unmute=function(){"use strict";this.$VideoPlayerFlashApi2(this.$VideoPlayerFlashApi0.unmuteVideo,g(arguments));};h.prototype.$VideoPlayerFlashApi2=function(i,j){"use strict";try{i.apply(this.$VideoPlayerFlashApi0,j);}catch(k){this.$VideoPlayerFlashApi1&&this.$VideoPlayerFlashApi1(k);}};e.exports=h;},null);
__d("VideoPlayerHTML5Api",["Arbiter","Event","Run","SubscriptionsHandler"],function(a,b,c,d,e,f,g,h,i,j){function k(l){"use strict";this.$VideoPlayerHTML5Api0=l;this.$VideoPlayerHTML5Api1=l.id;this.$VideoPlayerHTML5Api2=new j();i.onLeave(function(){return this.$VideoPlayerHTML5Api2.release();}.bind(this));this.$VideoPlayerHTML5Api3();}k.prototype.getDOMElement=function(){"use strict";return this.$VideoPlayerHTML5Api0;};k.prototype.pause=function(l){"use strict";this.$VideoPlayerHTML5Api0.pause();};k.prototype.play=function(l){"use strict";this.$VideoPlayerHTML5Api0.play();};k.prototype.seek=function(l){"use strict";};k.prototype.setFTData=function(l){"use strict";};k.prototype.switchVideo=function(l){"use strict";};k.prototype.unmute=function(){"use strict";this.$VideoPlayerHTML5Api0.muted=false;};k.prototype.$VideoPlayerHTML5Api3=function(){"use strict";this.$VideoPlayerHTML5Api2.addSubscriptions(h.listen(this.$VideoPlayerHTML5Api0,'playing',function(){this.$VideoPlayerHTML5Api4('flash/beginPlayback');}.bind(this)),h.listen(this.$VideoPlayerHTML5Api0,'ended',function(){this.$VideoPlayerHTML5Api4('flash/finishPlayback');}.bind(this)),h.listen(this.$VideoPlayerHTML5Api0,'pause',function(){this.$VideoPlayerHTML5Api4('flash/pausePlayback');}.bind(this)));};k.prototype.$VideoPlayerHTML5Api4=function(event){"use strict";g.inform(event,{divID:this.$VideoPlayerHTML5Api1});};e.exports=k;},null);
__d("VideoPlayerApiFactory",["DOMQuery","VideoPlayerFlashApi","VideoPlayerHTML5Api","invariant"],function(a,b,c,d,e,f,g,h,i,j){var k={create:function(l,m){var n=null;if(l.tagName==='VIDEO'){n=new i(l);}else{var o=g.scry(l,'embed');if(!o.length)o=g.scry(l,'object');if(o.length)n=new h(o[0],m);}return n;}};e.exports=k;},null);
__d("PhotosetSearchPivot.react",["LeftRight.react","PhotoTagSearchPivotLogger","PhotosetSearchPivotData","React","XUISpinner.react","XUIText.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=j.createClass({displayName:'PhotosetSearchPivotItem',propTypes:{normalized:j.PropTypes.string,title:j.PropTypes.string,uri:j.PropTypes.string,images:j.PropTypes.array},onClick:function(){h.logMorePhotosNavigation(this.props.normalized);},render:function(){return (j.DOM.div({className:"_25r"},j.DOM.a({onClick:this.onClick,href:this.props.uri,className:"_25t _3-8t"},j.DOM.div({className:"_25u"},j.DOM.div({className:"_25v _25w",style:{backgroundImage:'url('+this.props.images[0].uri+')'}}),j.DOM.div({className:"_25x"},j.DOM.div({className:"_25y"},j.DOM.div({className:"_25z"}),j.DOM.div({className:"_26r"},j.DOM.div({className:"_273 _25w",style:{backgroundImage:'url('+this.props.images[1].uri+')'}}))),j.DOM.div({className:"_274"},j.DOM.div({className:"_25z"}),j.DOM.div({className:"_26r"},j.DOM.div({className:"_273 _25w",style:{backgroundImage:'url('+this.props.images[2].uri+')'}}))))),l({display:"block",className:"_27f _2pi4"},this.props.title))));}}),p=j.createClass({displayName:'PhotosetSearchPivot',propTypes:{fbid:j.PropTypes.string,endofalbum:j.PropTypes.bool},fetchPivots:function(q){i.fetch(q).then(function(r){var s=r.pivots;setTimeout(function(){this.setState({pivots:s||[],action:'show'});}.bind(this),0);}.bind(this),function(r){setTimeout(function(){this.setState({pivots:[],action:'show'});}.bind(this),0);}.bind(this));},getInitialState:function(){this.fetchPivots(this.props.fbid);return {pivots:[],action:'loading'};},componentWillReceiveProps:function(q){if(q.fbid){this.setState({action:'loading'});this.fetchPivots(q.fbid);}else{this.setState({action:'hide'});setTimeout(function(){if(this.state.action==='hide')this.setState({pivots:[],action:''});}.bind(this),1000);}},onExitClicked:function(){this.props.onclose();},render:function(){if(this.state.action==='loading')return (j.DOM.div({className:"_27g _27h _2ph_"},k({size:"large"})));if(this.state.pivots.length===0&&this.state.action!=='show')return j.DOM.span(null);var q;if(this.state.pivots.length>0){q=this.state.pivots.map(function(s){return (o({normalized:s.normalized,title:s.title,uri:s.uri,images:s.images}));});}else q=j.DOM.div({className:"_27i"},"Unfortunately, there doesn't seem to be any other relevant photos available.");var r=this.props.endofalbum?j.DOM.span({className:"_2pij"},"End of album"):null;return (j.DOM.div({className:(("_27g")+(this.state.action==='hide'?' '+"_27j":'')+(this.state.action==='show'?' '+"_27k":''))},j.DOM.div({className:"_27l"},g({className:"_27m _2pi3 _2pib"},j.DOM.span(null,r,j.DOM.span({className:"_4ptz"},"Other photos you may like")),j.DOM.a({href:"#",onClick:this.onExitClicked,className:"_27n"})),j.DOM.div({className:"_27o _2pi8 clearfix"},q))));}});e.exports=p;},null);
__d("XSpotlightProfilePicCropViewerAsyncControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f,g){e.exports=g.create("\/profile_picture\/crop_photo\/",{photo_id:{type:"String",required:true},set_id:{type:"String",required:true}});},null);
__d("ProfilePicCropViewerStrings",["fbt","tx"],function(a,b,c,d,e,f,g,h){var i={BUTTON_CANCEL:"Cancel",BUTTON_SAVE:"Save Profile Picture",CROP_AND_SAVE:"Crop and save your profile picture",CROP_INSTRUCTIONS:"Move the box to where you want to crop your photo. Drag the corners in or out to adjust the size.",CROP_SAVING:"Saving Profile Picture...",LEAVE_WARNING_BODY:"The changes you made to your profile picture won't be saved if you close this dialog.",LEAVE_WARNING_CANCEL:"Stay on this Page",LEAVE_WARNING_OK:"Leave this Page",LEAVE_WARNING_TITLE:"Changes Not Saved",LEAVE_WARNING_UNLOAD:"The changes you made to your profile picture haven't been saved.",LOADING:"Loading...",PREVIOUS_PIC:"You've used this photo as your profile picture before. Do you want to use it again?",PROFILE_PIC_VISIBILITY:"Your current profile picture is always public.",UPLOADING:"Uploading...",ZOOM_WARNING:"Watch out! Zooming in too much lowers the quality of your profile picture"};e.exports=i;},null);
__d("XProfilePhotoActionLogControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f,g){e.exports=g.create("\/profile_photo\/logger\/",{event:{type:"Enum",required:true},source:{type:"Enum",required:true},method:{type:"Enum",required:true}});},null);
__d("ProfilePhotoActionLogger",["AsyncSignal","XProfilePhotoActionLogControllerURIBuilder"],function(a,b,c,d,e,f,g,h){var i={EVENT_SELECT_METHOD:'select_method',SOURCE_SUGGESTIONS:'suggestions',SOURCE_TIMELINE:'timeline',SOURCE_NUX:'nux',METHOD_EXISTING:'existing',METHOD_UPLOAD:'upload',log:function(j,k,l){new g((new h()).setEnum('event',j).setEnum('source',k).setEnum('method',l).getURI().toString()).send();}};e.exports=i;},null);
__d("TimelineProfilePicConfig",["fbt"],function(a,b,c,d,e,f,g){var h={loading:'timeline/profile_pic/loading',success:'timeline/profile_pic/success',leavingMessage:"Your profile picture is still uploading, are you sure you want to leave?"};e.exports=h;},null);
__d("XProfilePictureActionLoggerControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f,g){e.exports=g.create("\/profile\/picture\/action_logging\/",{action_type:{type:"Enum"},flow_type:{type:"Enum"},step_type:{type:"Enum"}});},null);
__d("ProfilePictureFlowLogging",["Arbiter","AsyncSignal","Event","Parent","ProfilePhotoActionLogger","Run","TimelineProfilePicConfig","TimelineProfilePictureLoggerEnums","XProfilePictureActionLoggerControllerURIBuilder","tidyEvent"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=m.loading,r=m.success,s='data-action-type',t,u,v;function w(){v&&v.unsubscribe();v=null;}var x={action:n.actions,flow:n.flows,step:n.steps,log:function(y){var z=y||x.step.INIT;new h(new o().setEnum('action_type',t).setEnum('flow_type',u).setEnum('step_type',z).getURI().toString()).send();if(t==x.action.UPLOAD&&z==x.step.INIT)k.log(k.EVENT_SELECT_METHOD,k.SOURCE_TIMELINE,k.METHOD_UPLOAD);u=null;if(y==='success'||y==='fail')t=null;return x;},setAction:function(y){t=y;return x;},setFlowType:function(y){u=y;return x;},init:function(y){if(!v){v=g.subscribe([q,r],function(z){x.log(z===q?n.steps.loading:n.steps.success);});l.onLeave(w);}p(i.listen(y,'click',function(z){var aa=j.byAttribute(z.getTarget(),s);if(!aa)return;x.setAction(aa.getAttribute(s)).log();}));},initMenuItems:function(y,z){x.init(y.getRoot());if(!z)return;var aa=z.getFileForm();p([aa.subscribe('submit',function(){x.log(x.step.UPLOAD_SELECT).log(x.step.LOADING);}),aa.subscribe('success',function(){x.log(x.step.UPLOAD_SUCCESS).log(x.step.SUCCESS);}),aa.subscribe('fail',function(){x.log(x.step.FAIL);})]);}};e.exports=x;},null);
__d("XProfilePicMakeAsyncControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f,g){e.exports=g.create("\/profile\/picture\/make_profile_pic\/",{photo_id:{type:"Int",required:true},profile_id:{type:"Int",required:true}});},null);
__d("ProfilePicCropViewerMixin",["AsyncResponse","AsyncRequest","DialogX","Layer","ProfilePicCropViewerStrings","ProfilePictureFlowLogging","React","Run","XProfilePicMakeAsyncControllerURIBuilder","XProfilePicCropAsyncControllerURIBuilder","XUIDialogButton.react","XUIDialogBody.react","XUIDialogFooter.react","XUIDialogTitle.react"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){function u(){var w=j.getTopmostLayer();if(!w)return;var x=w.subscribe('hide',function(){u();x.unsubscribe();});w.hide();}var v={componentDidMount:function(){this._preventClose=true;n.onBeforeUnload(function(){if(this.isMounted()&&!this._shouldAllowClose())return k.LEAVE_WARNING_UNLOAD;}.bind(this),true);this._logFlowStep(l.step.VIEWER_INIT);},componentDidUpdate:function(w,x){if(!x.photoData&&this.state.photoData)this._logFlowStep(this.state.photoData.previousprofilepic?l.step.PREVIOUS_PIC_INIT:l.step.CROP);},getViewerID:function(){return this.props.setid;},_forceClose:function(){this._preventClose=false;this._warningDialog&&this._warningDialog.destroy();this._warningDialog=null;this.close();this._logFlowStep(l.step.CANCEL);},handleCancel:function(){if(!this.props.warnOnCancel||this._shouldAllowClose())return this._forceClose();this._showCloseWarning();},handleSave:function(){this.setState({savingMode:true});this._preventClose=false;this._logFlowStep(l.step.LOADING);var w,x=this.state.photoData.id,y=this.props.profileID;if(this.state.photoData.previousprofilepic){w=new o();this._logFlowStep(l.step.PREVIOUS_PIC_SAVING);}else{var z=this.getCropArea(),aa=this.getPhotoSize();w=new p().setFloat('x',z.x/aa.width).setFloat('y',z.y/aa.height).setFloat('width',z.width/aa.width).setFloat('height',z.height/aa.height);this._logFlowStep(l.step.CROP_SAVING);}w.setInt('photo_id',x).setInt('profile_id',y);new h(w.getURI()).setHandler(this._savingSuccess).setErrorHandler(this._savingError).send();},_logFlowStep:function(w){l.setFlowType(this.getFlowType()).log(w);},_savingSuccess:function(){this._logFlowStep(this.state.photoData.previousprofilepic?l.step.PREVIOUS_PIC_SUCCESS:l.step.CROP_SUCCESS);this.close();u();},_savingError:function(w){this._preventClose=true;this.setState({savingMode:false});this._logFlowStep(this.state.photoData.previousprofilepic?l.step.PREVIOUS_PIC_FAIL:l.step.CROP_FAIL);g.defaultErrorHandler(w);},_shouldAllowClose:function(){return !this._preventClose;},_showCloseWarning:function(){if(!this._warningDialog)this._warningDialog=new i({modal:true,width:400,xui:true},m.DOM.div(null,t(null,k.LEAVE_WARNING_TITLE),r(null,k.LEAVE_WARNING_BODY),s(null,q({action:"cancel",label:k.LEAVE_WARNING_CANCEL}),q({action:"cancel",onClick:this._forceClose,label:k.LEAVE_WARNING_OK,use:"confirm"}))));this._warningDialog.show();}};e.exports=v;},null);
__d("SpotlightProfilePicCropOptions",[],function(a,b,c,d,e,f){var g=2.5,h=.8,i=320,j={getOptions:function(k,l){var m={},n=Math.min(l.x,l.y),o,p,q=k.facebox;if(q){p=Math.max(q.size.x*l.x,q.size.y*l.y)*g;o=q.center;}else{p=h*n;if(k.focus)o=k.focus;}var r=l.x/k.original.width;m.height=m.width=Math.min(Math.max(p,i*r),n);if(o){m.center_x=Math.min(Math.max(o.x*l.x,m.width/2),l.x-m.width/2);m.center_y=Math.min(Math.max(o.y*l.y,m.height/2),l.y-m.height/2);}return m;},getOptionsAsRatio:function(k,l){var m=j.getOptions(k,l),n=Math.min(l.x,l.y);return {center:{x:m.center_x?m.center_x/l.x:.5,y:m.center_y?m.center_y/l.y:.5},size:{x:m.width/n,y:m.height/n}};}};e.exports=j;},null);
__d("SpotlightProfilePicCropViewer",["ArbiterMixin","Photocrop2","ProfilePicCropViewerMixin","ProfilePicCropViewerStrings","ProfilePictureFlowLogging","React","SpotlightProfilePicCropOptions","SpotlightViewer","SpotlightViewerAutoResize","SpotlightViewerBehaviorsMixin","SpotlightViewerCoreMixin","SpotlightViewerDimensionMixin","XUIButton.react","XUIDialogFooter.react","XUIGrayText.react","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=l.PropTypes,x="_1rnz",y=420,z=l.createClass({displayName:'SpotlightProfilePicCropViewer',propTypes:{profileID:w.string.isRequired,setid:w.string.isRequired,uploading:w.bool,warnOnCancel:w.bool},mixins:[g,i,p,q,r],behaviors:[o],getDefaultProps:function(){return {minHeight:320,verticalPadding:180};},getInitialState:function(){return {photoData:null,open:this.props.open,updatingPhoto:false,savingMode:false};},componentDidUpdate:function(){setTimeout(this._enableCropping,1);},componentWillUnmount:function(){this._disableCropping();this._subscriptions&&this._subscriptions.release();this._subscriptions=null;},render:function(){var aa,ba,ca={height:this.getStageDimensions().y},da=(("_2he4")+(!this.state.photoData?' '+"_2he5":''));if(!this.state.photoData){ba=j.LOADING;ca={width:y,height:y};}else ba=this.state.photoData.previousprofilepic?j.PREVIOUS_PIC:j.CROP_INSTRUCTIONS;if(this.state.savingMode){aa=u({className:x,shade:"medium",weight:"bold"},j.CROP_SAVING);}else if(this.state.photoData){aa=[s({label:j.BUTTON_CANCEL,onClick:this.handleCancel}),s({label:j.BUTTON_SAVE,onClick:this.handleSave,use:"confirm"})];}else if(this.props.uploading)aa=u({className:x,shade:"medium",weight:"bold"},j.UPLOADING);return (n({className:"_2yue",onBeforeHide:this._shouldAllowClose,onHide:this.close,open:this.state.open},l.DOM.div({className:"_2he6"},u({display:"block",shade:"medium",size:"medium",weight:"bold"},j.CROP_AND_SAVE),u({display:"block",shade:"medium",size:"small"},ba)),l.DOM.div({className:da,style:ca},this.getMedia()),t({leftContent:u({className:x,shade:"medium"},j.PROFILE_PIC_VISIBILITY)},aa)));},_disableCropping:function(){this._photocrop&&this._photocrop.done();this._photocrop=null;},_enableCropping:function(){this._photocrop&&this._photocrop.reset();var aa=this.state.photoData;if(!this.refs.image||this._photocrop||aa.previousprofilepic)return;var ba=this.getImageDimensions();this._photocrop=new h(this.refs.image.getDOMNode(),m.getOptions(aa,ba),this.getDimensions().getOriginalDimensionsFromPhoto(aa));},getCropArea:function(){return this._photocrop.done(true);},getFlowType:function(){return k.flow.SPOTLIGHT;},getPhotoSize:function(){var aa=this.getDimensions().getOriginalDimensionsFromPhoto(this.state.photoData);return {height:aa.y,width:aa.x};}});e.exports=z;},null);
__d("ZoomProfilePicCropViewer.react",["ArbiterMixin","BasicVector","ProfilePicCropViewerStrings","ProfilePictureFlowLogging","ProfilePicCropViewerMixin","React","SpotlightProfilePicCropOptions","SpotlightViewerCoreMixin","SpotlightViewerDimensionMixin","XUIButton.react","XUIDialog.react","XUIDialogFooter.react","XUIDialogTitle.react","XUIGrayText.react","ZoomCrop.react","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w="_3mdr",x=520,y=460,z=22,aa=new h(x-z,y-z),ba=l.createClass({displayName:'ZoomProfilePicCropViewer',mixins:[g,k,n,o],propTypes:{profileID:l.PropTypes.string.isRequired,setid:l.PropTypes.string.isRequired,uploading:l.PropTypes.bool,warnOnCancel:l.PropTypes.bool},getInitialState:function(){return {open:true,photoData:null,updatingPhoto:false,savingMode:false};},render:function(){var ca=this.state.photoData,da=i.CROP_AND_SAVE,ea,fa,ga,ha=(("_3mds")+(!this.state.photoData?' '+"_3mdt":''));if(!ca){da=i.LOADING;}else if(ca.previousprofilepic){da=i.BUTTON_SAVE;ga=this.getDimensions().getImageDimensionsForStage({x:ca.image1.width,y:ca.image1.height},aa);fa=l.DOM.img({className:"_3mdu",height:ga.y,src:ca.image1.uri,width:ga.x});}else{da=i.CROP_AND_SAVE;ga=new h(ca.original.width,ca.original.height);var ia=m.getOptionsAsRatio(ca,ga);fa=u({center:ia.center,cropSizeRatio:ia.size,imageSize:ga,ref:"image",src:ca.original.uri,warningText:i.ZOOM_WARNING});}if(this.state.savingMode){ea=t({className:w,shade:"medium",weight:"bold"},i.CROP_SAVING);}else if(ca){ea=[p({label:i.BUTTON_CANCEL,onClick:this.handleCancel}),p({label:i.BUTTON_SAVE,onClick:this.handleSave,use:"confirm"})];}else if(this.props.uploading)ea=t({className:w,shade:"medium",weight:"bold"},i.UPLOADING);return (q({layerHideOnBlur:false,modal:true,shown:true,width:x},s({showCloseButton:false},t({display:"block",shade:"medium",size:"medium",weight:"bold"},da)),l.DOM.div({className:ha},fa),r({leftContent:t({className:w,shade:"medium"},i.PROFILE_PIC_VISIBILITY)},ea)));},getCropArea:function(){return this.refs.image.getDimensions().getArea();},getFlowType:function(){return j.flow.ZOOMCROP;},getPhotoSize:function(){return this.state.photoData.original;}});e.exports=ba;},null);
__d("ProfilePicCropViewerInit",["ProfilePicCropViewerGating","XSpotlightProfilePicCropViewerAsyncControllerURIBuilder"],function(a,b,c,d,e,f,g,h){var i='profile-picture-crop',j='loading',k;function l(n,o,p){if(!m.useCropViewer())return false;d(['SpotlightViewerInit','SpotlightProfilePicCropViewer','ZoomProfilePicCropViewer.react','PhotoStore','AsyncRequest'],function(q,r,s,t,u){m.close();var v=i+':'+n+':'+o,w=g.zoomcrop?s:r;k=q.render(w({open:true,photoid:n,profileID:o,setid:v,uploading:p&&p.uploading,warnOnCancel:p&&p.warnOnCancel}),function(){k=null;});if(!t.hasBeenCreated(v)&&n!==j)new u(new h().setString('photo_id',n).setString('set_id',v).getURI()).setErrorHandler(function(x){if(x===v)m.close();}.bind(this,v)).send();});return true;}var m={close:function(){k&&k.close();},useCropViewer:function(){return g.viewer;},loading:function(n,o){l(j,n,o);},loadID:l};e.exports=m;},null);
__d("PhotoSnowlift",["Arbiter","Assert","AsyncRequest","Bootloader","CSS","Dialog","DOM","DOMControl","Event","FullScreen","ImageUtils","Input","Keys","Layer","LikeConfirmer","LinkController","LitestandStoryInsertionStatus","Locale","PageTransitions","Parent","PhotoLogger","PhotoPermalinkURI","PhotosConst","PhotoSessionLog","PhotoSnowliftAds","PhotoStreamCache","PhotoTagSearchPivotLogger","PhotosetSearchPivotData","PhotosUtils","PhotoViewer","React","Rect","ScriptPath","ScrollableArea","Style","Toggler","UFIFeedbackTargets","UIPagelet","URI","UserAgent","Vector","VideoPlayerApiFactory","PhotosetSearchPivot.react","$","asyncCallback","computeRelativeURI","copyProperties","createArrayFrom","csx","cx","emptyFunction","ge","getActiveElement","goURI","tx","userAction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb){var kb=74,lb=75,mb=70,nb=76;for(var ob in ja)if(ja.hasOwnProperty(ob))qb[ob]=ja[ob];var pb=ja===null?null:ja.prototype;qb.prototype=Object.create(pb);qb.prototype.constructor=qb;qb.__superConstructor__=ja;function qb(){"use strict";ja.call(this);this._seenTags={};this._navCount=0;}qb.prototype.preload=function(rb,sb){"use strict";j.loadModules(["PhotoTagger","Live","PhotoTagApproval","PhotoTags","TagTokenizer","css:fb-photos-snowlift-fullscreen-css"],function(ub){this.PhotoTagger=ub;}.bind(this));var tb=this.getImageSrc(sa(rb).getQueryData());if(tb)if(!this._log(tb))(new Image()).src=tb;};qb.prototype.onFlashEvent=function(rb,sb){"use strict";var tb=m.scry(this.videoStage,".videoStageContainer");if(tb.length===0)return;if(sb.divID===tb[0].id){var ub=va.create(this.videoStage);ub.setScriptPath(ma.getScriptPath());ub.setFTData(JSON.stringify(this._dataFt));}};qb.prototype.bootstrap=function(rb,sb){"use strict";if(rb&&sa(rb).getQueryData().makeprofile)this.enableCropperOnInit=true;this.preload(rb,sb);if(this.closeDirty){setTimeout(this.bootstrap.bind(this,rb,sb),0);return;}ea.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this._dataFt=null;var tb=z.byAttribute(sb,'data-cursor');if(tb){try{var vb=JSON.parse(tb.getAttribute('data-ft'));this._dataFt={qid:vb.qid,mf_story_key:vb.mf_story_key};}catch(ub){}}else try{tb=z.byAttribute(sb,'data-ad');var wb=JSON.parse(tb.getAttribute('data-ad'));this._dataFt={ad_id:wb.adid};}catch(ub){}this.ua=jb('snowlift',sb).uai('open');this.returningToStart=false;this.loading&&k.removeClass(this.loading,'loading');if(sb){k.addClass((this.loading=sb),'loading');var xb=z.byClass(sb,'uiStreamStory')||z.byClass(sb,"_5jmm");if(xb){this.storyID=xb.id;}else{var yb=z.byClass(sb,"_5b9c");if(yb)this.storyID=yb.getAttribute('data-ownerid');}this._updateContainerOwnerID();this.getThumbAndSize(sb);}else this.loading=null;g.inform('PhotoSnowlift.GO',rb,g.BEHAVIOR_STATE);this.loadFrameIfUninitialized();this.videoPlayerToken=g.subscribe('flash/ready',this.onFlashEvent.bind(this));};qb.prototype._updateContainerOwnerID=function(){"use strict";if(this.container)if(this.storyID){this.container.setAttribute('data-ownerid',this.storyID);}else this.container.removeAttribute('data-ownerid');};qb.prototype.getCurrentImageServerSizeDimensions=function(){"use strict";var rb=this.stream.getCurrentImageData();return rb.originalDimensions||rb.dimensions;};qb.prototype.getEventPrefix=function(){"use strict";return 'PhotoSnowlift';};qb.prototype.getRoot=function(){"use strict";return this.root;};qb.prototype.getSourceString=function(){"use strict";return 'snowlift';};qb.prototype.getViewerSource=function(){"use strict";return this.source;};qb.prototype.getViewerSet=function(){"use strict";return this.stream.getPhotoSet();};qb.prototype.getVersionConst=function(){"use strict";return ca.VIEWER_SNOWLIFT;};qb.prototype.getImage=function(){"use strict";return this.image;};qb.prototype.getImageId=function(){"use strict";return this.stream.getCursor();};qb.prototype.getRHCHeader=function(){"use strict";return this.rhcHeader;};qb.prototype.getRHCBody=function(){"use strict";return this.ufiForm;};qb.prototype.getRHCFooter=function(){"use strict";return this.rhcFooter;};qb.prototype.getLoadQuery=function(){"use strict";return this.loadQuery;};qb.prototype.getCurrentPhotoInfo=function(){"use strict";var rb=this.stream.getCurrentImageData();if(rb)return rb.info;return null;};qb.prototype.getOwnerId=function(){"use strict";var rb=this.stream.getCurrentImageData();if(rb)return rb.info.owner;return null;};qb.prototype.getThumbAndSize=function(rb){"use strict";this.currentImageSize=null;this.thumbSrc=null;var sb=sa(rb.getAttribute('ajaxify')).getQueryData();if(!sb.size)return;var tb=ua.deserialize(sb.size);if(!tb.x||!tb.y)return;this.currentImageSize=tb;if(rb.getAttribute('data-cropped'))return;var ub=m.scry(rb,'img')[0],vb=m.scry(rb,'i')[0],wb=z.byAttribute(rb,'data-size');this.shouldStretch=wb&&this.currentImageSize&&ub&&wb.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=qb.TIMELINE_STRETCH_WIDTH&&ub.offsetWidth===qb.TIMELINE_STRETCH_WIDTH;var xb;if(ub){xb=ub.src;}else if(vb){xb=oa.get(vb,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=xb;};qb.prototype.loadFrameIfUninitialized=function(){"use strict";if(this.root)return;new i('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};qb.prototype.init=function(rb,sb){"use strict";this.init=eb;this._shouldLog=sb.photos_client_loading;this._logger=null;if(this._shouldLog)this._logger=new aa(ca.VIEWER_SNOWLIFT_STRING);this._showHover=sb.pivot_hover;this._showMorePhotos=sb.show_more_photos;da.setEndMetrics(sb.pivot_end_metric);this.startingMousePos=null;this.haveLeftBufferRegion=false;this.showingTypeaheadSuggestions=false;this.fullscreen=p.isSupported();this.showOGVideos=sb.og_videos;this.resizeCommentsForAds=sb.resize_comments_for_ads;this.spotlight=rb;this.spotlight.subscribe('blur',function(){this.closingAction=da.OUTSIDE;}.bind(this));this.spotlight.subscribe('beforehide',this.beforeCloseHandler.bind(this));this.spotlight.subscribe('hide',this.closeHandler.bind(this));this.spotlight.subscribe('key',this.keyHandler.bind(this));this.initializeNodes(this.spotlight.getRoot());ea.init(this.sideAdUnit,this,sb,this.adsDisplayedCallback.bind(this));this.inAdsDisplayedCallback=false;this.lastAdsHeight=0;if(!this.subscription){v.registerHandler(this.handleNavigateAway.bind(this));this.subscription=g.subscribe('PhotoSnowlift.GO',function(tb,ub){this.openExplicitly=true;this.loading&&k.removeClass(this.loading,'loading');this.open(ub);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;y.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;g.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));g.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)p.subscribe('changed',this.onFullScreenChange.bind(this));this.slideshowGk=sb.snowlift_slideshow;this.allowIrrelevantRequests=!!sb.snowlift_allow_irrelevant_requests;};qb.prototype.onFullScreenChange=function(){"use strict";var rb=p.isFullScreen();k.conditionClass(document.body,'fbPhotoSnowliftFullScreenMode',rb);if(rb){if(!k.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var sb=this.stream.getCurrentImageData();if(sb&&sb.url&&this.image.src!==sb.url&&this.shouldShowHiRes(sb))this.switchImage(sb.url);this.adjustForResize();}else{this.uncollapseRHC();if(ta.chrome()&&!k.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.page(0,false);g.inform('reflow');}pa.hide();if(this.cropper)this.cropper.resetPhoto();};qb.prototype.initializeNodes=function(rb){"use strict";this.root=rb;this.container=m.find(rb,'div.fbPhotoSnowliftContainer');this._updateContainerOwnerID();this.snowliftPopup=m.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=m.find(this.snowliftPopup,'div.rhc');this.rhcHeader=m.find(this.rhc,'div.rhcHeader');this.rhcFooter=m.find(this.rhc,'div.rhcFooter');this.ufiForm=m.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=m.find(this.rhc,'div.fbPhotosSnowboxFeedbackInput');this.scroller=m.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=m.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=m.find(this.snowliftPopup,'div.stageWrapper');this.overlay=m.find(this.snowliftPopup,'div.snowliftOverlay');this.errorBox=m.find(this.stageWrapper,'div.stageError');this.image=m.find(this.stageWrapper,'img.spotlight');this.stage=m.find(this.stageWrapper,'div.stage');this.videoStage=m.find(this.stageWrapper,'div.videoStage');this.prevPager=m.find(this.snowliftPopup,'a.snowliftPager.prev');this.nextPager=m.find(this.snowliftPopup,'a.snowliftPager.next');this.stageActions=m.find(rb,'div.stageActions');this.buttonActions=m.find(this.stageActions,'div.fbPhotosPhotoButtons');this.placeInfo=m.find(this.rhc,'div.fbPhotosSnowliftPlaceInfo');this.sideAdUnit=m.find(rb,"._5ciw");k.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);};qb.prototype.initializeScroller=function(){"use strict";this.initializeScroller=eb;this.scrollableArea=na.fromNative(this.scroller,{fade:true,persistent:true});var rb=function(event){var sb=o.$E(event).getTarget();if(m.contains(this.ufiInputContainer,sb)){var tb=n.getInstance(sb);if(tb){this.scrollableArea.scrollToBottom();var ub=tb.subscribe('resize',function(){var wb=this.scrollableArea.isScrolledToBottom();this.adjustScroller();wb&&this.scrollableArea.scrollToBottom();}.bind(this)),vb=o.listen(sb,'blur',function(){tb.unsubscribe(ub);vb.remove();});}}}.bind(this);g.subscribe('ufi/changed',function(sb,tb){if(this.ufiForm===tb.form)this.adjustScrollerIfNecessary();}.bind(this));g.subscribe('ufi/comment',function(sb,tb){if(this.ufiForm===tb.form){this.adjustScrollerIfNecessary();if(tb.isranked){this.scrollableArea.scrollToTop();}else this.scrollableArea.scrollToBottom();}}.bind(this));o.listen(this.rhc,'click',function(event){var sb=event.getTarget();if(z.byTag(sb,'a')||z.byTag(sb,'button')||m.isNodeOfType(sb,'input'))this.adjustScrollerIfNecessary();}.bind(this));g.subscribe(['reflow','CommentUFI.Pager'],function(){if(this.isOpen)this.adjustScrollerIfNecessary();}.bind(this));o.listen(this.ufiForm,'focusin',rb);};qb.prototype.openHandler=function(rb){"use strict";if(this.isOpen||!ba.isValid(rb)||this.returningToStart||rb.getQueryData().closeTheater||rb.getQueryData().permPage||rb.getQueryData().makeprofile){this.openHandlerRegistered=false;return false;}this.open(rb);this._uriStack.push(sa(rb).getQualifiedURI().toString());y.transitionComplete(true);return true;};qb.prototype.getImageSrc=function(rb){"use strict";if(rb.smallsrc){if(!rb.size)return rb.smallsrc;var sb=ua.deserialize(rb.size),tb=this.getStageSize(sb);tb=this._adjustStageSizeForPixelRatio(tb);if(tb.x<=qb.STAGE_NORMAL_MAX.x&&tb.y<=qb.STAGE_NORMAL_MAX.y)return rb.smallsrc;}return rb.src;};qb.prototype.open=function(rb){"use strict";var sb=sa(rb),tb=sb.getQueryData(),ub=ba.parse(sb);if(ub!==null){tb.fbid=ub.photo_id;tb.set=ub.set_token;}var vb=this.getImageSrc(tb);if(vb){delete tb.src;delete tb.smallsrc;}if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){tb.firstLoad=true;this.initialLoad=true;w.registerBlocker(function(){return this.isOpen;}.bind(this));}this.sessionID=Date.now();this.loadQuery=ab(tb,{ssid:this.sessionID});if(this._dataFt)this.loadQuery.data_ft=this._dataFt;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.source=null;this.saveTagSubscription=g.subscribe('PhotoTagger.SAVE_TAG',this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new fa();this.stream.init(ca.VIEWER_SNOWLIFT,'PhotoViewerPagelet','pagelet_photo_viewer',this._shouldLog?this._logger:null);if(!!sa.getMostRecentURI().getQueryData().viewas)this.stream.setViewAs(sa.getMostRecentURI().getQueryData().viewas+'');this.fetchInitialData();this.setLoadingState(qb.STATE_HTML,true);this.rhcCollapsed=false;this._open(rb,vb);j.loadModules(["SnowliftPicCropper"],function(wb){this.cropper=wb.getInstance(this);this.cropper.init();if(this.enableCropperOnInit){var xb=g.subscribe('PhotoSnowlift.SWITCH_IMAGE',function(){this.cropper.enableCropping();g.unsubscribe(xb);}.bind(this));this.enableCropperOnInit=false;}}.bind(this));j.loadModules(["PhotosButtonTooltips"],function(wb){wb.init();});};qb.prototype._open=function(rb,sb){"use strict";this.createLoader(sb);this.spotlight.show();this.ua&&this.ua.add_event('frame');g.inform('layer_shown',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.OPEN');this.stageHandlers=[o.listen(window,'resize',this.adjustForResize.bind(this)),o.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),o.listen(this.stageWrapper,'mouseleave',function(event){var vb=event.getTarget();if(!(z.byClass(vb,'snowliftOverlay')||z.byClass(vb,'fbPhotoSnowliftTagApproval')||z.byClass(vb,'tagPointer')||z.byClass(vb,'arrow')||z.byClass(vb,'faceboxSuggestion')||z.byClass(vb,'typeaheadWrapper')||z.byClass(vb,'photoTagTypeahead')||z.byClass(vb,'fbPhotoTagger')))this.unhiliteAllTags();this.hidePagers();}.bind(this)),o.listen(this.stageWrapper,'mousemove',this.hilitePager.bind(this)),o.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this)),o.listen(this.overlay,'mouseenter',this.unhiliteAllTags.bind(this)),o.listen(this.container,'mousemove',this._enableMouseOver.bind(this)),o.listen(this.container,'mouseover',this._interceptMouseOver.bind(this)),o.listen(this.stageWrapper,'focusin',this.hilitePager.bind(this)),o.listen(this.rhc,'focusin',this.hidePagers.bind(this))];this.stageHandlers.push(o.listen(this.container,'click',function(event){var vb=event.getTarget();if(z.byClass(vb,'rotateRight')){this.rotate('right');}else if(z.byClass(vb,'rotateLeft')){this.rotate('left');}else if(z.byClass(vb,'closeTheater')){if(p.isFullScreen()){p.toggleFullScreen();return;}this.closingAction=da.X;this.spotlight.hide();return false;}else if(this.fullscreen)if(z.byClass(vb,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(z.byClass(vb,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}.bind(this)));var tb=fb('fbPhotoSnowliftFeedback');if(tb)this.stageHandlers.push(o.listen(tb,'click',function(event){var vb=event.getTarget();if(z.byClass(vb,'like_link')||(z.byClass(vb,'UFILikeLink')&&z.byClass(vb,'UIActionLinks')))this.toggleLikeButton();var wb=z.byClass(event.getTarget(),'uiUfiCollapsedComment');if(wb)k.addClass(wb,'uiUfiCollapsedCommentToggle');}.bind(this)));var ub=fb('fbPhotoSnowliftOnProfile');if(ub)this.stageHandlers.push(o.listen(ub,'click',function(event){if(z.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=sa.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!sb)this.setLoadingState(qb.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){y.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}da.initLogging(da.SNOWLIFT);if(this.pivots)da.setRelevantCount(this.pivots.relevantCount);};qb.prototype.toggleFullScreen=function(){"use strict";var rb=p.toggleFullScreen(document.documentElement);if(rb){var sb=this.stream.getCurrentImageData();if(sb&&sb.url&&this.image.src!==sb.url&&this.shouldShowHiRes(sb))if(!this._log(sb.url))(new Image()).src=sb.url;da.logEnterFullScreen(this.stream.getCursor());}};qb.prototype.getStream=function(){"use strict";return this.stream;};qb.prototype.fetchInitialData=function(){"use strict";this.ua&&this.ua.add_event('init_data');this.stream.waitForInitData();ra.loadFromEndpoint('PhotoViewerInitPagelet',fb('pagelet_photo_viewer_init',this.root),this.loadQuery,{actorID:qa.getActorIDForFeedbackTargetIfExists(this.loadQuery.fbid),usePipe:true,jsNonblock:true,crossPage:true,allowIrrelevantRequests:this.allowIrrelevantRequests});};qb.prototype.toggleCollapse=function(){"use strict";if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();};qb.prototype.collapseRHC=function(){"use strict";this.rhcCollapsed=true;k.addClass(this.root,'collapseRHC');this.adjustForResize();};qb.prototype.uncollapseRHC=function(){"use strict";this.rhcCollapsed=false;k.removeClass(this.root,'collapseRHC');this.adjustForResize();};qb.prototype.beforeCloseHandler=function(){"use strict";if(this.isOpen&&this.cropper&&this.cropper.croppingMode){this.warnLeavePage(this.closeHandler.bind(this));return false;}};qb.prototype.closeHandler=function(){"use strict";if(!this.isOpen)return;this.closingAction=this.closingAction||da.ESC;if(sa.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.returnToStartingURI(this.refreshOnClose);this.close();};qb.prototype.returnToStartingURI=function(rb,sb){"use strict";if(!rb)if(sb){this.squashNextTransition(hb.bind(null,sb));}else this.squashNextTransition();this.returningToStart=true;var tb=g.subscribe('page_transition',(function(){this.returningToStart=false;tb.unsubscribe();}).bind(this)),ub=rb||isNaN(ta.opera()),vb=this._uriStack.length;if(ub&&vb<window.history.length){window.history.go(-vb);}else{var wb=this.startingURI,xb=new sa(wb).removeQueryData('closeTheater');if(wb.getQueryData().sk=='approve'&&wb.getPath()=='/profile.php'){xb.removeQueryData('highlight');xb.removeQueryData('notif_t');}hb(xb);}};qb.prototype.squashNextTransition=function(rb){"use strict";this.squashNext=true;y.registerHandler(function sb(){if(this.squashNext){this.squashNext=false;if(rb)setTimeout(rb,0);y.transitionComplete(true);return true;}return false;}.bind(this),7);};qb.prototype.handleNavigateAway=function(rb){"use strict";var sb=za(y._most_recent_uri.getQualifiedURI(),rb.getAttribute('href'));if(this.isOpen&&(sb instanceof sa)&&sb.getUnqualifiedURI().toString()!=this.startingURI.toString()&&sb.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=da.NAVIGATE;this.returnToStartingURI(false,sb);this.close();return false;}return true;};qb.prototype.postProcessTaggedPhotos=function(){"use strict";if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var rb=null;if(this.source===qb.COLLECTIONS_UNTAGGED_PHOTOS){rb='/ajax/photos/photo/edit/skiptag/';}else if(this.source===qb.PHOTOS_OF_YOU_SUGGESTIONS||this.source===qb.FRIENDS_IN_PHOTOS_SUGGESTIONS)rb='/ajax/photos/photo/add_to_star_grid/';if(rb)new i().setURI(rb).setAllowCrossPageTransition(true).setData({media_id:this.taggedPhotoIds,source:this.source}).send();}};qb.prototype.onTagSaved=function(rb,sb){"use strict";if(this.taggedPhotoIds){if(this.source===qb.PHOTOS_OF_YOU_SUGGESTIONS&&!sb.self_tag)return;this.taggedPhotoIds.push(sb.photo_fbid);}};qb.prototype.close=function(){"use strict";if(!this.isOpen)return;this.hideMorePhotos();this.isOpen=false;this._navCount=0;if(this.fullscreen)p.disableFullScreen();jb('snowlift').uai('close');this.cropper&&this.cropper.disableCropping();this.spotlight.hide();this.openExplicitly=false;this.postProcessTaggedPhotos();g.unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=true;setTimeout(this.closeCleanup.bind(this),0);};qb.prototype.closeCleanup=function(){"use strict";g.unsubscribe(this.videoPlayerToken);this.closeDirty=false;k.removeClass(this.root,'dataLoading');da.logPhotoViews(this.closingAction);this.destroy();k.hide(this.errorBox);k.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;k.removeClass(this.stageWrapper,'showVideo');m.empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();m.empty(this.sideAdUnit);this.stream.destroy();var rb=this.closingAction===da.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){y.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}g.inform('layer_hidden',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.CLOSE',rb);this.root.setAttribute('aria-busy','true');};qb.prototype.createLoader=function(rb){"use strict";if(this.currentImageSize===null){this.adjustStageSize(qb.STAGE_MIN);}else{var sb=this.getStageSize(this.currentImageSize);sb=new ua(Math.max(sb.x,qb.STAGE_MIN.x),Math.max(sb.y,qb.STAGE_MIN.y));var tb=this.getImageSizeInStage(this.currentImageSize,sb);if(this.thumbSrc===null){this.adjustStageSize(tb);}else this.useImage(m.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:tb.x+'px',height:tb.y+'px'}}),tb,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(rb)setTimeout((function(){var ub=new Image(),vb=o.listen(ub,'load',ya(function(){if(!this.isOpen)return;if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(rb,this.currentImageSize);this.ua&&this.ua.add_event('image');this.setLoadingState(qb.STATE_IMAGE_DATA,false);}}.bind(this),'photo_theater')),wb=function(){if(vb){vb.remove();vb=null;}};g.subscribeOnce('PhotoSnowlift.SWITCH_IMAGE',wb);g.subscribeOnce('PhotoSnowlift.CLOSE',wb);this._log(rb);ub.src=rb;}).bind(this),0);k.hide(this.stageActions);this.setStagePagersState('disabled');};qb.prototype.initDataFetched=function(rb){"use strict";da.setPhotoSet(this.stream.getPhotoSet());da.setLogFbids(rb.logids);var sb=this.stream.getCurrentImageData();da.addPhotoView(sb.info,this.shouldShowHiRes(sb),this.fullscreen&&p.isFullScreen());var tb=this.stream.getCurrentExtraData();if(this._showHover&&tb)ga.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(tb.tagRects));if(tb&&tb.source!==undefined){this.source=parseInt(tb.source,10);da.setSource(this.source);}if(!this.pageHandlers)this.pageHandlers=[o.listen(this.root,'click',this.pageListener.bind(this)),o.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];k.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=rb.loggedin;this.disableAds=!this.isLoggedInViewer||rb.fromad||this.stream.isInViewAsMode();this.loadAds();};qb.prototype.adjustScrollerIfNecessary=function(){"use strict";clearTimeout(this.scrollerTimeout);this.scrollerTimeout=setTimeout(this.adjustScroller.bind(this),0);};qb.prototype.adjustScroller=function(rb){"use strict";clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var sb=ua.getElementDimensions(this.rhc),tb=sb.y;tb-=ua.getElementDimensions(this.rhcHeader).y;tb-=ua.getElementDimensions(this.ufiInputContainer).y;if(this.placeInfo){var ub=ua.getElementDimensions(this.placeInfo);tb-=ub.y;oa.set(this.sideAdUnit,'bottom',ub.y+'px');}if(rb==null)rb=this.resizeCommentsForAds?this.lastAdsHeight:0;this.lastAdsHeight=rb;tb=Math.max(0,tb);var vb=ua.getElementDimensions(this.scrollerBody).y,wb=Math.max(qb.MIN_UFI_HEIGHT,tb-rb);if(vb>=wb){if(tb>wb){k.removeClass(this.rhc,'pinnedUfi');tb-=wb;}else{k.addClass(this.rhc,'pinnedUfi');tb=0;}oa.set(this.scroller,'height',wb+'px');}else{oa.set(this.scroller,'height','auto');k.removeClass(this.rhc,'pinnedUfi');tb-=vb;}var xb=ua.getElementDimensions(this.ufiInputContainer).y;oa.set(this.ufiForm,'padding-bottom',xb+'px');ea.resize(new ua(sb.x,tb));this.scrollableArea.adjustGripper();};qb.prototype.adjustForResize=function(){"use strict";this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();};qb.prototype.shouldShowHiRes=function(rb){"use strict";if(!rb||!rb.smallurl)return false;var sb=this.getStageSize(rb.dimensions);sb=this._adjustStageSizeForPixelRatio(sb);var tb=this.getImageSizeInStage(rb.dimensions,sb);return (tb.x>qb.STAGE_NORMAL_MAX.x||tb.y>qb.STAGE_NORMAL_MAX.y);};qb.prototype._adjustStageSizeForPixelRatio=function(rb){"use strict";if(window.devicePixelRatio&&window.devicePixelRatio>1)rb=new ua(rb.x*window.devicePixelRatio,rb.y*window.devicePixelRatio);return rb;};qb.prototype.getImageURL=function(rb){"use strict";if(rb.video){return null;}else if(rb.smallurl&&!this.shouldShowHiRes(rb))return rb.smallurl;return rb.url;};qb.prototype.getImageDimensions=function(rb){"use strict";if(rb.smalldims&&(!this.shouldShowHiRes(rb)||this.image.src===rb.smallurl))return rb.smalldims;return rb.dimensions;};qb.prototype.getStageSize=function(rb,sb){"use strict";var tb=ua.getViewportDimensions(),ub=new ua(rb.x,rb.y);if(sb)ub=new ua(Math.max(rb.x,sb.x),Math.max(rb.y,sb.y));var vb,wb;if(this.fullscreen&&p.isFullScreen()){return new ua((this.rhcCollapsed?screen.width:screen.width-qb.SIDEBAR_SIZE_MAX),screen.height-qb.FULL_SCREEN_PADDING*2);}else{vb=Math.min(ub.x,(tb.x-qb.SIDEBAR_SIZE_MAX-qb.STAGE_CHROME.x));wb=Math.min(ub.y,tb.y-qb.STAGE_CHROME.y);}if(vb===0&&wb===0)return new ua(0,0);var xb=vb/wb,yb=ub.x/ub.y;if(xb<yb)return new ua(vb,Math.round(vb/yb));return new ua(Math.round(wb*yb),wb);};qb.prototype.getImageSizeInStage=function(rb,sb){"use strict";var tb=rb.x,ub=rb.y;if(tb>=sb.x||ub>=sb.y){var vb=sb.x/sb.y,wb=tb/ub;if(vb<wb){tb=sb.x;ub=Math.round(tb/wb);}else if(vb>wb){ub=sb.y;tb=Math.round(ub*wb);}else{tb=sb.x;ub=sb.y;}}return new ua(tb,ub);};qb.prototype.adjustStageSize=function(rb){"use strict";var sb=this.currentImageSize;if(rb){sb=rb;}else{var tb=this.stream&&this.stream.getCurrentImageData();if(tb)sb=this.getImageDimensions(tb);}if(!sb)return;this.currentImageSize=sb;var ub=0;if(this.shouldStretch&&!this.getVideoOnStage()&&sb.x>sb.y&&sb.x<=qb.TIMELINE_STRETCH_WIDTH&&sb.x>=qb.TIMELINE_STRETCH_MIN){sb.y=Math.round(sb.y*qb.TIMELINE_STRETCH_WIDTH/sb.x);sb.x=qb.TIMELINE_STRETCH_WIDTH;}else if(this.getVideoOnStage())ub=qb.VIDEO_BOTTOM_BAR_SPACE*2;var vb=this.getStageSize(sb,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new ua(0,0);this.currentMinSize=new ua(Math.max(vb.x,qb.STAGE_MIN.x,this.currentMinSize.x),Math.max(vb.y,qb.STAGE_MIN.y,this.currentMinSize.y));var wb=this.getImageSizeInStage(sb,this.currentMinSize),xb=this.currentMinSize.x-wb.x,yb=this.currentMinSize.y-wb.y;if(xb>0&&xb<qb.PADDING_MIN){this.currentMinSize.x-=xb;}else if(yb>0&&yb<qb.PADDING_MIN)this.currentMinSize.y-=yb;var zb=this.currentMinSize.x+qb.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)zb=this.currentMinSize.x;this.snowliftPopup.style.cssText='width:'+zb+'px;'+'height:'+this.currentMinSize.y+'px;';var ac=this.currentMinSize.y-ub+'px';if(ta.firefox()){var bc=oa.get(this.stageWrapper,'font-size');ac=((this.currentMinSize.y-ub)/parseFloat(bc))+'em';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+ac+';';this.image.style.cssText='width:'+wb.x+'px;'+'height:'+wb.y+'px;';var cc=this.getTagger();if(cc)cc.repositionTagger();this.adjustScrollerIfNecessary();};qb.prototype.adjustForNewData=function(){"use strict";if(!this.image)return;var rb=m.scry(this.stage,'div.tagsWrapper')[0],sb=ua.getElementDimensions(this.image);if(rb){oa.set(rb,'width',sb.x+'px');oa.set(rb,'height',sb.y+'px');}};qb.prototype.adsDisplayedCallback=function(rb,sb){"use strict";var tb=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&rb<qb.MIN_ADS_VISIBLE&&sb.length>=qb.MIN_ADS_VISIBLE;if(tb){this.inAdsDisplayedCallback=true;var ub=sb[qb.MIN_ADS_VISIBLE-1];this.adjustScroller(ub);this.inAdsDisplayedCallback=false;}};qb.prototype.setLoadingState=function(rb,sb){"use strict";switch(rb){case qb.STATE_IMAGE_PIXELS:k.conditionClass(this.root,'imagePixelsLoading',sb);break;case qb.STATE_IMAGE_DATA:this.loadingStates[rb]=sb;k.conditionClass(this.root,'imageLoading',sb);break;case qb.STATE_HTML:this.loadingStates[rb]=sb;k.conditionClass(this.root,'dataLoading',sb);this.rhc.setAttribute('aria-busy',sb?'true':'false');break;}};qb.prototype.destroy=function(){"use strict";this.stageHandlers.forEach(function(rb){rb.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(rb){rb.remove();});this.pageHandlers=null;}this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;};qb.prototype.checkState=function(rb){"use strict";if(rb!=qb.STATE_ERROR&&!this.loadingStates[rb])return;switch(rb){case qb.STATE_IMAGE_DATA:var sb=this.stream.getCurrentImageData();if(sb){var tb=this.getImageURL(sb);if(tb){this.switchImage(tb,null,true);}else if(sb.video)this.switchVideo(sb.video,true);this.setLoadingState(rb,false);}break;case qb.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(rb,false);}break;default:if(this.stream.errorInCurrent()){k.hide(this.image);k.show(this.errorBox);}break;}};qb.prototype.buttonListener=function(event){"use strict";var rb=event.getTarget(),sb=Date.now();if(z.byClass(rb,'fbPhotoTagApprovalBox'))return;if(sb-this.lastPage<350)return;if(z.byClass(rb,'fbPhotosPhotoLike')){this.likePhoto();}else if(z.byClass(rb,'tagApproveIgnore')){this.updateTagBox(event,rb);}else if(z.byClass(rb,"_5ge9")){this.hideMorePhotos();this.toggleSlideshow();return false;}else if(z.byClass(rb,"_5ymu")){if(!k.hasClass(this.stageWrapper,"_5ymv")){ga.logShowMorePhotos();var tb=this.stream.getCursor();if(tb)this.showMorePhotos(String(tb));}else{ga.logHideMorePhotos();this.hideMorePhotos();}return;}this.hideMorePhotos();};qb.prototype.toggleSlideshow=function(){"use strict";if(!this.slideshowGk)return;if(this._slideshowToken){this.stopSlideshow();}else this.startSlideshow();};qb.prototype.startSlideshow=function(){"use strict";this._slideshowToken=window.setInterval(this.page.bind(this,1,ta.chrome()&&p.isFullScreen()),qb.SLIDESHOW_TIME);k.addClass(this.root,'slideshowStarted');k.removeClass(this.root,'slideshowAvailable');};qb.prototype.stopSlideshow=function(){"use strict";this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;k.addClass(this.root,'slideshowAvailable');k.removeClass(this.root,'slideshowStarted');};qb.prototype.likePhoto=function(){"use strict";da.addButtonLike();var rb=xa('fbPhotoSnowliftFeedback'),sb=m.scry(rb,'button.like_link')[0];if(!sb)sb=m.scry(rb,'a.UFILikeLink')[0];var tb=sb.getAttribute('href');if(p.isFullScreen())if(ta.chrome())sb.setAttribute('href','javascript:;');sb.click();sb.setAttribute('href',tb);};qb.prototype.toggleLikeButton=function(){"use strict";var rb=m.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(rb){var sb=m.find(this.root,'.likeCount'),tb=m.find(sb,'.likeCountNum');if(sb)if(k.hasClass(rb,'viewerLikesThis')){m.setContent(tb,parseInt(tb.textContent,10)-1);}else m.setContent(tb,parseInt(tb.textContent,10)+1);k.toggleClass(rb,'viewerLikesThis');k.removeClass(rb,'viewerAlreadyLikedThis');}};qb.prototype.likePhotoWithKey=function(){"use strict";return u.like(this.likePhoto.bind(this),gb());};qb.prototype.updateTagBox=function(rb,sb){"use strict";this.unhiliteAllTags();var tb=fb(rb);if(!tb)return;k.addClass(tb,'tagBox');k.addClass(tb,'tagBoxPendingResponse');k.removeClass(tb,'tagBoxPending');k.hide(m.find(tb,'span.tagForm'));if(sb){k.show(m.find(tb,'span.tagApproved'));}else k.show(m.find(tb,'span.tagIgnored'));};qb.prototype.rotate=function(rb){"use strict";var sb=this.stream.getCursor();if(this.getVideoOnStage()){var tb=(rb=='left')?270:90;h.isTruthy(this.videoRotateURI,"Video rotate URI not set.");j.loadModules(["VideoRotate"],function(vb){new vb(sb,this.videoRotateURI).motionRotate(tb);}.bind(this));return;}var ub=ab({fbid:sb,opaquecursor:this.stream.getOpaqueCursor(sb),cs_ver:ca.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());ub[rb]=1;this.setLoadingState(qb.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);k.hide(this.image);new i('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(ub).setErrorHandler(this.rotationError.bind(this,sb)).setFinallyHandler(this.rotationComplete.bind(this,sb)).setMethod('POST').setReadOnly(false).send();};qb.prototype.rotationComplete=function(rb,sb){"use strict";if(rb==this.stream.getCursor()){this.setLoadingState(qb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}};qb.prototype.rotationError=function(rb,sb){"use strict";if(rb==this.stream.getCursor()){this.setLoadingState(qb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));j.loadModules(["AsyncResponse"],function(tb){tb.defaultErrorHandler(sb);});}};qb.prototype.saveTagsFromPayload=function(rb){"use strict";this.storeFromData(rb);if('data' in rb&&this.stream.getCursor() in rb.data)this.swapData();};qb.prototype.saveEdit=function(){"use strict";if(!k.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;j.loadModules(["PhotoInlineEditor","Form"],function(rb,sb){var tb=rb.getInstance(this.getViewerConst());tb&&sb.bootstrap(tb.getForm().controller);}.bind(this));};qb.prototype.mouseLeaveListener=function(event){"use strict";this.unhiliteAllTags();this.reHilitePendingTag();};qb.prototype.hilitePager=function(event){"use strict";var rb=ua.getEventPosition(event),sb=ua.getElementPosition(this.stage);if(x.isRTL()){var tb=ua.getElementDimensions(this.stage);this.stagePagerPrev=tb.x-(rb.x-sb.x)<qb.GOPREV_AREA;}else this.stagePagerPrev=rb.x-sb.x<qb.GOPREV_AREA;k.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);k.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var ub,vb=event.getTarget();if(!z.byClass(vb,'snowliftOverlay')&&!z.byClass(vb,'bottomBarActions')&&!z.byClass(vb,'snowliftPager'))ub=qb.PAGER_FADE;this.showPagers(ub);};qb.prototype.showPagers=function(rb){"use strict";clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(typeof rb!=='undefined')this.fadePagerTimer=setTimeout(this.hidePagers.bind(this),rb);};qb.prototype.hidePagers=function(){"use strict";var rb=m.scry(this.getRoot(),'.fbPhotosPhotoActionsMenu')[0];if(rb)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');};qb.prototype.getTagger=function(){"use strict";return (this.PhotoTagger&&this.PhotoTagger.getInstance(ca.VIEWER_SNOWLIFT));};qb.prototype.unhiliteAllTags=function(){"use strict";clearTimeout(this.unhiliteTimer);m.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(sb){k.removeClass(sb,'hover');});m.scry(this.stage,'div.tagsWrapper div.otherActive').forEach(function(sb){k.removeClass(sb,'otherActive');});this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!k.hasClass(this.root,'taggingMode')){var rb=this.getTagger();if(rb){rb.hideTagger();rb.setCurrentFacebox(null);}}};qb.prototype.switchHilitedTags=function(rb,sb){"use strict";if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();this.hiliteAllBoxes();var tb=fb(rb);if(tb){this.hilitedTag=rb;if(!k.hasClass(this.root,'taggingMode')&&ia.isFacebox(this.hilitedTag)){var ub=this.getTagger();if(ub){k.addClass(tb,'hover');var vb=ub.getFacebox(rb);ub.setCurrentFacebox(vb);if(vb)ub.addTagFromFacebox(vb);}}else k.addClass(tb,'hover');if(k.hasClass(tb,'tagBoxPending')&&!k.hasClass(tb,'showPendingTagName')&&sb===true){m.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(wb){k.removeClass(wb,'showPendingTagName');});k.addClass(tb,'showPendingTagName');}}};qb.prototype.reHilitePendingTag=function(){"use strict";var rb=fb(this.hilitedTag);if(rb&&k.hasClass(rb,'showPendingTagName'))return;var sb=m.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(sb)this.switchHilitedTags(sb.id);};qb.prototype.hiliteTagsOnMouseMove=function(event){"use strict";if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var rb=event.getTarget();if(z.byClass(rb,'snowliftOverlay')||z.byClass(rb,'fbPhotoSnowliftTagApproval')||z.byClass(rb,'tagPointer')||z.byClass(rb,'arrow')||z.byClass(rb,'faceboxSuggestion')||z.byClass(rb,'typeaheadWrapper')||z.byClass(rb,'photoTagTypeahead'))return;var sb=z.byClass(rb,'tagBoxPending'),tb=false;if(this.hilitedTag){var ub=fb(this.hilitedTag);tb=ub&&k.hasClass(ub,'tagBoxPending');}var vb=((!this.hilitedTag&&sb)||(!tb&&sb));if(vb){this.switchHilitedTags(sb.id);return;}if(sb&&(sb.id==this.hilitedTag))return;var wb=250,xb=15,yb=ua.getEventPosition(event);if(!this.startingMousePos)this.startingMousePos=yb;var zb=ia.absoluteToNormalizedPosition(this.image,yb);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(yb)<xb){return;}else this.haveLeftBufferRegion=true;if(this.currentTagHasPrecedence(zb))return;var ac=ia.getNearestBox(this.stream.getCurrentExtraData().tagRects,zb);if(!ac){if(!tb){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var bc=null;if(tb){var cc={};cc[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];bc=ia.getNearestBox(cc,zb);}if(bc!==null&&tb)return;if(this.hilitedTag!=ac)if(tb){this.switchTimer=setTimeout(this.switchHilitedTags.bind(this,ac),wb);}else{if(this._showHover&&!this._seenTags[ac]){this._seenTags[ac]=true;ga.logPivotImpression('snowlift',ac);}this.switchHilitedTags(ac);}};qb.prototype.currentTagHasPrecedence=function(rb){"use strict";if(!this.hilitedTag)return false;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===undefined){this.hilitedTag=null;return false;}var sb=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],tb=new la(sb.t+(sb.h()/2),sb.r,sb.b+(ia.isFacebox(this.hilitedTag)?10:0),sb.l,sb.domain);return tb.contains(rb);};qb.prototype.getVideoOnStage=function(){"use strict";var rb=this.stream&&this.stream.getCurrentImageData();return rb&&rb.video;};qb.prototype.shouldPageOnAction=function(rb,sb){"use strict";if(!this.isOpen||u.isShowingConfirmation())return false;var tb=m.isNode(sb)&&(z.byClass(sb,'snowliftPager')||z.byClass(sb,'stagePagers')||z.byClass(sb,'pivotPageColumn')),ub=m.isNode(sb)&&z.byClass(sb,'stage'),vb=k.hasClass(sb,'faceBox'),wb=(!k.hasClass(this.root,'taggingMode')&&vb&&!tb);if(wb){if(!this.showingTypeaheadSuggestions){this.getTagger().updateWithSuggestions();setTimeout((function(){m.find(this.getTagger().tagger,'input.textInput').focus();}).bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return false;}var xb=((ub&&k.hasClass(this.root,'taggingMode'))||z.byClass(sb,'tagBoxPending')||z.byClass(sb,'tagBoxPendingResponse')||z.byClass(sb,'fbPhotoTagApprovalBox')||z.byClass(sb,'tag')||(this.cropper&&this.cropper.croppingMode));if(xb)return false;return rb==s.LEFT||rb==s.RIGHT||rb==kb||rb==lb||tb||wb||ub;};qb.prototype.keyHandler=function(rb,event){"use strict";if(event.getModifiers().any||t.getTopmostLayer()!==this.spotlight)return true;switch(o.getKeyCode(event)){case s.LEFT:case s.RIGHT:case kb:case lb:this.pageListener(event);return false;case mb:return this.toggleFullScreen();case nb:return this.likePhotoWithKey();case s.SPACE:this.toggleSlideshow();this.showPagers(qb.PAGER_FADE);return false;}};qb.prototype.shouldHandlePendingTag=function(event){"use strict";var rb=this.getTagger();if(!rb||!rb.tags.length)return false;var sb=ia.absoluteToNormalizedPosition(this.getImage(),ua.getEventPosition(event)),tb=rb.findNearestTag(sb);if(!tb||!k.hasClass(tb.node,'tagBoxPending'))return false;g.inform('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',{id:tb.id,version:this.getVersionConst()});return true;};qb.prototype.pageListener=function(event){"use strict";var rb=o.getKeyCode(event),sb=event.getTarget();if(this._slideshowToken){this.stopSlideshow();return;}if(!this.shouldPageOnAction(rb,sb))return;if(this.shouldHandlePendingTag(event))return;var tb=0;if(rb==s.RIGHT||rb==lb){tb=1;da.setPagingAction('key_right');this._disableMouseOver=true;}else if(rb==s.LEFT||rb==kb){tb=-1;da.setPagingAction('key_left');this._disableMouseOver=true;}else if(z.byClass(sb,'next')){tb=1;da.setPagingAction('click_next');}else if(z.byClass(sb,'prev')){tb=-1;da.setPagingAction('click_prev');}else if(!this.stagePagerPrev){tb=1;da.setPagingAction('click_stage');}else{tb=-1;da.setPagingAction('click_stage_back');}var ub=m.scry(this.ufiForm,'input.mentionsHidden'),vb=false;for(var wb=0;wb<ub.length;wb++)if(!r.isEmpty(ub[wb])){vb=true;break;}if(vb||k.hasClass(this.root,'fbPhotoSnowliftEditMode')||(this.cropper&&this.cropper.croppingMode)){this.warnLeavePage(this.page.bind(this,tb));}else{this.page(tb,ta.chrome()&&p.isFullScreen());jb('snowlift',sb,event).uai(da.pagingAction);}};qb.prototype.warnLeavePage=function(rb){"use strict";new l().setTitle("Are you sure you want to leave this page?").setBody("You have unsaved changes that will be lost if you leave the page.").setButtons([{name:'leave_page',label:"Leave this Page",handler:rb},{name:'continue_editing',label:"Stay on this Page",className:'inputaux'}]).setModal(true).show();};qb.prototype.getUsesOpaqueCursor=function(){"use strict";return this.stream.getUsesOpaqueCursor();};qb.prototype.getOpaqueCursor=function(rb){"use strict";return this.stream.getOpaqueCursor(rb);};qb.prototype.setReachedLeftEnd=function(){"use strict";this.stream.setReachedLeftEnd();};qb.prototype.setReachedRightEnd=function(){"use strict";this.stream.setReachedRightEnd();};qb.prototype.page=function(rb,sb){"use strict";if(!this.stream.isValidMovement(rb)||!this.stream.nonCircularPhotoSetCanPage(rb)){this.showPagers(qb.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();this.startingMousePos=null;this.haveLeftBufferRegion=false;this._seenTags={};var tb=this.getVideoOnStage();if(tb)this.switchVideo(tb,false);if(this.pivots&&this.pivots.page(rb))return;g.inform('PhotoSnowlift.PAGE');pa.hide();this.recacheData();this.stream.moveCursor(rb);k.hide(this.image);if(this.stream.errorInCurrent()){this.setLoadingState(qb.STATE_HTML,true);k.show(this.errorBox);return;}var ub=this.stream.getCurrentImageData();if(ub){var vb=this.getImageURL(ub);if(vb){this.switchImage(vb,null,true);}else if(ub.video)this.switchVideo(ub.video,true);if(!sb){this.replaceUrl=true;hb(ub.info.permalink);}this.setLoadingState(qb.STATE_IMAGE_DATA,false);}else{this.setLoadingState(qb.STATE_IMAGE_PIXELS,true);this.setLoadingState(qb.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(qb.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer||this.stream.isInViewAsMode();this.loadAds();if(this.cropper)this.cropper.resetPhoto();this.setLeftAndRightPagersState();if(this._slideshowToken){k.addClass(this.root,'slideshowStarted');}else if(this.slideshowAvailable)k.addClass(this.root,'slideshowAvailable');if(this._showMorePhotos&&this._albumFBID){this._navCount+=rb;var wb=Math.abs(this._navCount);if(wb===this.stream.getLength()-1)ha.fetch(this._albumFBID,this.stream);if(wb===this.stream.getLength()){ga.logSuggestMorePhotos();this.showMorePhotos(this._albumFBID,true);this.showPagers();this._navCount=0;}else{this.hideMorePhotos();this.hidePagers();}}};qb.prototype.showMorePhotos=function(rb,sb){"use strict";if(!this.searchPivot)this.searchPivot=this.overlay.appendChild(document.createElement('div'));k.addClass(this.stageWrapper,"_5ymv");this.searchPivotComponent=ka.renderComponent(wa({fbid:rb,onclose:this.hideMorePhotos.bind(this),endofalbum:sb||false}),this.searchPivot);};qb.prototype.hideMorePhotos=function(){"use strict";if(this.searchPivotComponent&&k.hasClass(this.stageWrapper,"_5ymv")){k.removeClass(this.stageWrapper,"_5ymv");this.searchPivotComponent.setProps({fbid:null});}};qb.prototype.logImpressionDetailsForPhoto=function(){"use strict";var rb=[].concat(m.scry(xa('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),m.scry(xa('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(rb.length===0)return;var sb={};for(var tb=0;tb<rb.length;tb++)sb[rb[tb].name]=rb[tb].value;if(this.getVideoOnStage()){sb.width=0;sb.height=0;}else{var ub=this.getImageDimensions(this.stream.getCurrentImageData());sb.width=ub.x;sb.height=ub.y;}da.addDetailData(this.stream.getCursor(),sb);ea.setIsLogAdData(true);};qb.prototype.loadAds=function(){"use strict";if(this.disableAds)return;ea.loadAdsFromUserActivity();};qb.prototype.transitionHandler=function(rb){"use strict";if(rb.getQueryData().closeTheater||rb.getQueryData().permPage||rb.getQueryData().makeprofile||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(rb.getQualifiedURI().toString());y.transitionComplete(true);return true;}var sb=this._uriStack.length;if(sb>=2&&this._uriStack[sb-2]==rb.getQualifiedURI().toString())this._uriStack.pop();var tb=this.stream.getCursorForURI(rb.getUnqualifiedURI().toString());if(tb){var ub=this.stream.getRelativeMovement(tb);this.page(ub,true);y.transitionComplete(false);return true;}if(this.isOpen){y.transitionComplete(true);this.close();return true;}this.transitionHandlerRegistered=false;return false;};qb.prototype.recacheData=function(){"use strict";if(!this.loadingStates.html){var rb=this.stream.getCurrentHtml();for(var sb in rb){rb[sb]=bb(xa(sb).childNodes);m.empty(xa(sb));}}};qb.prototype.reloadIfTimeout=function(){"use strict";if(!q.hasLoaded(this.image)){var rb=this.makeNewImage(this.image.src,true);o.listen(rb,'load',this.useImage.bind(this,rb,null,true));this._log(rb.src);}};qb.prototype.useImage=function(rb,sb,tb){"use strict";if(tb&&q.hasLoaded(this.image))return;m.replace(this.image,rb);this.image=rb;this.adjustStageSize(sb);};qb.prototype.makeNewImage=function(rb,sb){"use strict";if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!sb)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),qb.LOADING_TIMEOUT);var tb=m.create('img',{className:'spotlight',alt:''});tb.setAttribute('aria-describedby','fbPhotosSnowliftCaption');tb.setAttribute('aria-busy','true');o.listen(tb,'load',ya(function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);setTimeout((function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this),0);}.bind(this),'photo_theater'));this._log(rb);tb.src=rb;return tb;};qb.prototype.switchImage=function(rb,sb,tb){"use strict";k.hide(this.image);k.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var ub=this.stream&&this.stream.getCurrentImageData();if(ub){da.addPhotoView(ub.info,this.shouldShowHiRes(ub),this.fullscreen&&p.isFullScreen());if(this._showHover){var vb=this.stream.getCurrentExtraData();if(vb)ga.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(vb.tagRects));}}this.useImage(this.makeNewImage(rb,false),sb,false);if(tb)this.stream.preloadImages(this.shouldShowHiRes.bind(this));if(this.cropper&&this.cropper.croppingMode)this.cropper.resetPhoto();g.inform('PhotoSnowlift.SWITCH_IMAGE');};qb.prototype.switchVideo=function(rb,sb){"use strict";var tb='swf_'+rb;if(sb){k.addClass(this.stageWrapper,'showVideo');var ub=m.create('div',{className:'videoStageContainer'});m.appendContent(this.videoStage,ub);ub.id=rb;if(window[tb]&&!fb(tb))window[tb].write(rb);var vb='video_warning_'+rb,wb=fb(rb);if(!this.videoWarnings)this.videoWarnings=[];if(wb&&this.videoWarnings[vb])m.setContent(wb,this.videoWarnings[vb]);setTimeout(this.adjustStageSizeForVideo.bind(this,tb),0);}else{window[tb]&&window[tb].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);m.empty(this.videoStage);k.removeClass(this.stageWrapper,'showVideo');}};qb.prototype.checkVideoStatus=function(rb){"use strict";if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var sb=this.getVideoOnStage();if(!sb){return;}else{var tb='swf_'+sb;if(rb!==tb)return;this.adjustStageSizeForVideo(rb);}};qb.prototype.adjustStageSizeForVideo=function(rb){"use strict";var sb=fb(rb);if(!sb){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,rb),200);}else this.adjustStageSize(new ua(sb.width,sb.height));};qb.prototype.handleServerError=function(rb,sb){"use strict";m.setContent(this.errorBox,rb);this.storeFromData(sb);};qb.prototype.swapData=function(){"use strict";var rb,sb=this.stream.getCurrentHtml();if(sb){this.setLoadingState(qb.STATE_HTML,false);for(var tb in sb){rb=fb(tb);rb&&m.setContent(rb,sb[tb]);}g.inform('PhotoSnowlift.DATA_CHANGE',this.stream.getCurrentImageData().info,g.BEHAVIOR_STATE);if(this.stream.getCurrentExtraData())g.inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),g.BEHAVIOR_STATE);}this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();};qb.prototype.updateTotalCount=function(rb,sb,tb){"use strict";var ub=this.stream.getCurrentHtml();if(ub){var vb=xa('fbPhotoSnowliftPositionAndCount');m.replace(vb,tb);vb=tb;k.show(vb);var wb='fbPhotoSnowliftPositionAndCount';ub[wb]=bb(vb.childNodes);}this.stream.setTotalCount(rb);this.stream.setFirstCursorIndex(sb);};qb.prototype.addPhotoFbids=function(rb,sb,tb,ub){"use strict";if(ub&&this.sessionID&&ub!=this.sessionID)return;var vb=this.stream.getCursor()===null;this.stream.attachToFbidsList(rb,sb,tb);if(tb&&vb)this.page(0,true);if(this.pivots&&tb)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');if(!this.slideshowAvailable&&this.stream.canPage()){this.slideshowAvailable=true;k.addClass(this.root,'slideshowAvailable');}this.setLeftAndRightPagersState();};qb.prototype.attachTagger=function(rb){"use strict";m.appendContent(this.stageActions,rb);};qb.prototype.storeFromData=function(rb){"use strict";if(!this.isOpen)return;if(rb.ssid&&this.sessionID&&this.sessionID!=rb.ssid)return;var sb=this.stream.storeToCache(rb);if('error' in sb){this.checkState(qb.STATE_ERROR);return;}if('init' in rb)this._albumFBID=rb.init.album_fbid;if('init' in sb){this.initDataFetched(sb.init);if(this.openExplicitly){this.replaceUrl=true;hb(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.setLeftAndRightPagersState();this.ua&&this.ua.add_event('ufi');}if('image' in sb)this.checkState(qb.STATE_IMAGE_DATA);if('data' in sb)this.checkState(qb.STATE_HTML);};qb.prototype.setLeftAndRightPagersState=function(){"use strict";if(this.stream.isNonCircularPhotoSet()){k.conditionClass(this.root,'disableLeft',!this.stream.nonCircularPhotoSetCanPage(-1));k.conditionClass(this.root,'disableRight',!this.stream.nonCircularPhotoSetCanPage(1));}};qb.prototype.setStagePagersState=function(rb){"use strict";switch(rb){case 'ready':k.addClass(this.root,'pagingReady');this.pagersShown=true;this.ua&&this.ua.add_event('arrows');return;case 'active':k.addClass(this.root,'pagingActivated');return;case 'inactive':k.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':k.removeClass(this.root,'pagingReady');return;}};qb.prototype.deletePhoto=function(rb){"use strict";this.closeRefresh();};qb.prototype.closeRefresh=function(){"use strict";this.refreshOnClose=true;this.spotlight.hide();};qb.prototype.onHiliteTag=function(rb,sb){"use strict";if(sb.version!=ca.VIEWER_SNOWLIFT)return;var tb=sb.tag;if(tb)this.switchHilitedTags(tb,true);};qb.prototype.onUpdateTagBox=function(rb,sb){"use strict";if(sb.version==ca.VIEWER_SNOWLIFT)this.updateTagBox(sb.id,sb.approve);};qb.prototype._log=function(rb){"use strict";if(this._shouldLog){this._logger&&this._logger.log(rb);return true;}return false;};qb.prototype._enableMouseOver=function(){"use strict";this._disableMouseOver=false;};qb.prototype._interceptMouseOver=function(event){"use strict";if(this._disableMouseOver)event.kill();};qb.getInstance=function(){"use strict";if(!qb._instance)qb._instance=new qb();return qb._instance;};qb.initWithSpotlight=function(rb,sb){"use strict";qb.getInstance().init(rb,sb);};qb.addPhotoFbids=function(rb,sb,tb,ub){"use strict";qb.getInstance().addPhotoFbids(rb,sb,tb,ub);};qb.setReachedLeftEnd=function(){"use strict";qb.getInstance().setReachedLeftEnd();};qb.setReachedRightEnd=function(){"use strict";qb.getInstance().setReachedRightEnd();};qb.attachFollowFlyout=function(rb){"use strict";m.insertAfter(xa('fbPhotoSnowliftSubscribe'),rb);};qb.attachSubscribeFlyout=function(rb){"use strict";m.insertAfter(xa('fbPhotoSnowliftSubscribe'),rb);};qb.attachTagger=function(rb){"use strict";qb.getInstance().attachTagger(rb);};qb.preload=function(rb,sb){"use strict";qb.getInstance().preload(rb,sb);};qb.bootstrap=function(rb,sb){"use strict";var tb=rb&&sa(rb).getQueryData();if(tb&&tb.hasOwnProperty('share_id')){j.loadModules(["SpotlightShareViewer"],function(ub){ub.bootstrap(rb,sb);});return;}if(tb&&tb.fbid&&tb.makeprofile&&tb.profile_id){d(['ProfilePicCropViewerInit'],function(ub){if(!ub.loadID(tb.fbid,tb.profile_id))qb.getInstance().bootstrap(rb,sb);});return;}qb.getInstance().bootstrap(rb,sb);};qb.closeRefresh=function(){"use strict";qb.getInstance().closeRefresh();};qb.deletePhoto=function(rb){"use strict";qb.getInstance().deletePhoto(rb);};qb.getImage=function(){"use strict";return qb.getInstance().getImage();};qb.getImageId=function(){"use strict";return qb.getInstance().getImageId();};qb.getLoadQuery=function(){"use strict";return qb.getInstance().getLoadQuery();};qb.getRHCBody=function(){"use strict";return qb.getInstance().getRHCBody();};qb.getRHCFooter=function(){"use strict";return qb.getInstance().getRHCFooter();};qb.getRHCHeader=function(){"use strict";return qb.getInstance().getRHCHeader();};qb.getRoot=function(){"use strict";return qb.getInstance().getRoot();};qb.likePhotoSkipConfirmation=function(rb){"use strict";qb.getInstance().likePhotoSkipConfirmation(rb);};qb.saveTagsFromPayload=function(rb){"use strict";qb.getInstance().saveTagsFromPayload(rb);};qb.saveTagsFromPayloadDelayed=function(rb){"use strict";setTimeout(qb.saveTagsFromPayload.bind(null,rb),2000);};qb.handleServerError=function(rb,sb){"use strict";qb.getInstance().handleServerError(rb,sb);};qb.setVideoWarning=function(rb,sb){"use strict";var tb=qb.getInstance(),ub='video_warning_'+rb;if(!tb.videoWarnings)tb.videoWarnings=[];tb.videoWarnings[ub]=sb;};qb.storeFromData=function(rb){"use strict";qb.getInstance().storeFromData(rb);};qb.swapData=function(){"use strict";qb.getInstance().swapData();};qb.updateTotalCount=function(rb,sb,tb){"use strict";qb.getInstance().updateTotalCount(rb,sb,tb);};qb.setVideoRotateURI=function(rb){"use strict";qb.getInstance().videoRotateURI=rb;};ab(qb,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},SIDEBAR_SIZE_MAX:360,STAGE_CHROME:{x:82,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,SLIDESHOW_TIME:3000,_instance:null,touch:eb,touchMarkup:eb});ab(qb.prototype,{switchTimer:null,imageRefreshTimer:null,imageLoadingTimer:null,lastPage:0,currentMinSize:null,currentImageSize:null,resetUriStack:true,thumbSrc:null,shouldStretch:false,stageMax:qb.STAGE_NORMAL_MAX,stageChrome:qb.STAGE_CHROME,stagePagerPrev:null,ua:null,PhotoTagger:null});e.exports=qb;},null);